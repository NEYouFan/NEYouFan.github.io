
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“ | ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="ç½‘æ˜“å‰ç«¯æŠ€æœ¯éƒ¨">
    

    
    <meta name="description" content="JavaScriptå¼•æ“èƒ½å¤Ÿè§£æå’Œæ‰§è¡ŒJSè„šæœ¬ï¼Œå¸®åŠ©ç§»åŠ¨ç«¯è¿›è¡Œè·¨å¹³å°å¼€å‘ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»å’Œè®¨è®ºJSå¼•æ“åœ¨Androidç³»ç»Ÿä¸Šçš„ä½¿ç”¨å’Œæ€§èƒ½æ¯”è¾ƒï¼Œå¹¶é’ˆå¯¹JSç»˜åˆ¶æœ¬åœ°åŒ–é—®é¢˜ç»™å‡ºäº†åŸºäºV8çš„å¼€å‘å®ä¾‹ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“">
<meta property="og:url" content="http://NEYouFan.github.io/2016/12/23/android/Android Jså¼•æ“/Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“/index.html">
<meta property="og:site_name" content="ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨">
<meta property="og:description" content="JavaScriptå¼•æ“èƒ½å¤Ÿè§£æå’Œæ‰§è¡ŒJSè„šæœ¬ï¼Œå¸®åŠ©ç§»åŠ¨ç«¯è¿›è¡Œè·¨å¹³å°å¼€å‘ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»å’Œè®¨è®ºJSå¼•æ“åœ¨Androidç³»ç»Ÿä¸Šçš„ä½¿ç”¨å’Œæ€§èƒ½æ¯”è¾ƒï¼Œå¹¶é’ˆå¯¹JSç»˜åˆ¶æœ¬åœ°åŒ–é—®é¢˜ç»™å‡ºäº†åŸºäºV8çš„å¼€å‘å®ä¾‹ã€‚">
<meta property="og:image" content="http://NEYouFan.github.io/Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“/web_shape.png">
<meta property="og:image" content="http://NEYouFan.github.io/Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“/android_shape.png">
<meta property="og:updated_time" content="2017-01-05T05:45:52.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“">
<meta name="twitter:description" content="JavaScriptå¼•æ“èƒ½å¤Ÿè§£æå’Œæ‰§è¡ŒJSè„šæœ¬ï¼Œå¸®åŠ©ç§»åŠ¨ç«¯è¿›è¡Œè·¨å¹³å°å¼€å‘ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»å’Œè®¨è®ºJSå¼•æ“åœ¨Androidç³»ç»Ÿä¸Šçš„ä½¿ç”¨å’Œæ€§èƒ½æ¯”è¾ƒï¼Œå¹¶é’ˆå¯¹JSç»˜åˆ¶æœ¬åœ°åŒ–é—®é¢˜ç»™å‡ºäº†åŸºäºV8çš„å¼€å‘å®ä¾‹ã€‚">
<meta name="twitter:image" content="http://NEYouFan.github.io/Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“/web_shape.png">

    
    <link rel="alternative" href="/atom.xml" title="ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨" title="ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨">ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="èœå•">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">ä¸»é¡µ</a></li>
					
						<li><a href="/archives">å½’æ¡£</a></li>
					
						<li><a href="/about">å…³äº</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="æœç´¢" />
						<input type="hidden" name="q" value="site:NEYouFan.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/12/23/android/Android Jså¼•æ“/Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“/" title="Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“" itemprop="url">Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“</a>
  </h1>
  <p class="article-author">By
       
		<span style="color: rgb(44, 166, 203);" >åˆ˜å®æ¶›</span>
		
  <p class="article-time">
    <time datetime="2016-12-22T16:00:00.000Z" itemprop="datePublished"> å‘è¡¨äº 2016-12-23</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">æ–‡ç« ç›®å½•</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-å‰è¨€"><span class="toc-text">1. å‰è¨€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-JSå¼•æ“ä»‹ç»"><span class="toc-text">2. JSå¼•æ“ä»‹ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-JavaScriptCore"><span class="toc-text">1. JavaScriptCore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-V8"><span class="toc-text">2. V8</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-SpiderMonkey"><span class="toc-text">3. SpiderMonkey</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-Rhino"><span class="toc-text">4. Rhino</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-Nashorn"><span class="toc-text">5. Nashorn</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-JSå¼•æ“æ€§èƒ½æ¯”è¾ƒ"><span class="toc-text">3. JSå¼•æ“æ€§èƒ½æ¯”è¾ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-åˆ›å»ºJSç¯å¢ƒ"><span class="toc-text">3.1 åˆ›å»ºJSç¯å¢ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-1-JSCore"><span class="toc-text">3.1.1 JSCore</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-2-J2V8"><span class="toc-text">3.1.2 J2V8</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-3-Rhino"><span class="toc-text">3.1.3 Rhino</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-å®éªŒã€‡ï¼šåŒ…çš„ä¾èµ–"><span class="toc-text">3.2 å®éªŒã€‡ï¼šåŒ…çš„ä¾èµ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-å®éªŒä¸€ï¼šç©ºå¾ªç¯"><span class="toc-text">3.3 å®éªŒä¸€ï¼šç©ºå¾ªç¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-å®éªŒäºŒï¼šJSè°ƒç”¨Javaæ–¹æ³•"><span class="toc-text">3.4 å®éªŒäºŒï¼šJSè°ƒç”¨Javaæ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-å®éªŒä¸‰ï¼šJSé€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘"><span class="toc-text">3.5 å®éªŒä¸‰ï¼šJSé€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-å®éªŒæ€»ç»“"><span class="toc-text">3.6 å®éªŒæ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-J2V8çš„Androidå¼€å‘å®ä¾‹"><span class="toc-text">4. J2V8çš„Androidå¼€å‘å®ä¾‹</span></a></li></ol>
		
		</div>
		
		<p>JavaScriptå¼•æ“èƒ½å¤Ÿè§£æå’Œæ‰§è¡ŒJSè„šæœ¬ï¼Œå¸®åŠ©ç§»åŠ¨ç«¯è¿›è¡Œè·¨å¹³å°å¼€å‘ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»å’Œè®¨è®ºJSå¼•æ“åœ¨Androidç³»ç»Ÿä¸Šçš„ä½¿ç”¨å’Œæ€§èƒ½æ¯”è¾ƒï¼Œå¹¶é’ˆå¯¹JSç»˜åˆ¶æœ¬åœ°åŒ–é—®é¢˜ç»™å‡ºäº†åŸºäºV8çš„å¼€å‘å®ä¾‹ã€‚<a id="more"></a></p>
<h3 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h3><p>è¿‘æœŸåœ¨äº§å“ä¸­é‡åˆ°äº†è¿™æ ·çš„ä¸€ä¸ªé—®é¢˜ï¼šWebç«¯å·²ç»å­˜åœ¨ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„JavaScriptåº“ï¼Œå¦‚æœå°†ç›¸å…³WebåµŒå…¥åˆ°Appä¸­ï¼Œåˆ™WebViewå°†å¸¦æ¥ä¸€å®šçš„æ€§èƒ½å½±å“ï¼›å¦‚æœAndroidç«¯æœ¬åœ°å¼€å‘ä¸€ä¸ªç›¸åŒçš„åº“ï¼Œåˆ™éœ€è¦æ¶ˆè€—å¤§é‡çš„èµ„æºã€‚è€ƒè™‘åˆ°ä»£ç å¤ç”¨å’Œè·¨å¹³å°å¼€å‘ï¼Œå›¢é˜Ÿè°ƒç ”äº†JSå¼•æ“åœ¨Androidä¸Šçš„ä½¿ç”¨ï¼Œå¸Œæœ›è§£å†³â€ä¸ç»è¿‡WebViewï¼Œè€Œå°†JSåº“æ‹¿åˆ°Androidç«¯è¿è¡Œï¼Œå¹¶å°†è¿è¡Œç»“æœäº¤ç»™æœ¬åœ°è¾“å‡ºâ€è¿™ä¸€éœ€æ±‚ã€‚</p>
<p>JSå¼•æ“èƒ½å¤Ÿè§£æJSè„šæœ¬ï¼Œé€šå¸¸è¢«ä¾é™„äºæµè§ˆå™¨ä¸­ï¼Œä¾‹å¦‚Safariæ‰€ä½¿ç”¨çš„<strong>JavaScriptCore</strong>ã€Google Chromeæ‰€ä½¿ç”¨çš„<strong>V8</strong>å’ŒFireFoxæ‰€ä½¿ç”¨çš„<strong>SpiderMonkey</strong>ç­‰ç­‰ã€‚ä¹Ÿè¢«ç”¨ä½œç§»åŠ¨ç«¯çš„è·¨å¹³å°å¼€å‘ï¼Œä¾‹å¦‚<a href="http://developer.telerik.com/featured/nativescript-works/" target="_blank" rel="external">NativeScript</a>åœ¨iOSç«¯å’ŒAndroidåˆ†åˆ«ä½¿ç”¨äº†JavaScriptCoreå’ŒV8ï¼Œ<a href="https://facebook.github.io/react-native/docs/javascript-environment.html" target="_blank" rel="external">ReactNative</a>åˆ™éƒ½ä½¿ç”¨äº†JavaScriptCoreã€‚</p>
<h3 id="2-JSå¼•æ“ä»‹ç»"><a href="#2-JSå¼•æ“ä»‹ç»" class="headerlink" title="2. JSå¼•æ“ä»‹ç»"></a>2. JSå¼•æ“ä»‹ç»</h3><p>åœ¨Androidç³»ç»Ÿä¸­èƒ½è¿è¡Œçš„JSå¼•æ“æœ‰å¦‚ä¸‹5ç§ï¼š</p>
<h4 id="1-JavaScriptCore"><a href="#1-JavaScriptCore" class="headerlink" title="1. JavaScriptCore"></a>1. <a href="https://trac.webkit.org/wiki/JavaScriptCore" target="_blank" rel="external">JavaScriptCore</a></h4><p>JavaScriptCoreæ˜¯ä¸€ä¸ªåœ¨WebKitä¸­æä¾›JSå¼•æ“çš„å¼€æºæ¡†æ¶ï¼Œæœ€è¿‘æ›´æ–°æ—¥æœŸæ˜¯2016å¹´9æœˆ26æ—¥ã€‚ç›®å‰è¯¥å¼•æ“ç”±Appleç»´æŠ¤ï¼Œä½¿ç”¨äºSafariæµè§ˆå™¨ï¼ŒiOS7åä¹Ÿé›†æˆåˆ°äº†iPhoneå¹³å°ã€‚</p>
<p>ç”±äºå…¶ä½¿ç”¨Cè¯­è¨€ç¼–å†™ï¼Œå› æ­¤åœ¨Androidå¼€å‘ä¸­å¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚Githubä¸Šçš„å¼€æºé¡¹ç›®<a href="https://github.com/ericwlange/AndroidJSCore" target="_blank" rel="external">AndroidJSCore</a>èƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…ç»è¿‡è°ƒç”¨Javaæ¥å£è€Œä½¿ç”¨JavaScriptCoreã€‚è¯¥é¡¹ç›®ç”±<strong>ericwlange</strong>ç»´æŠ¤ï¼Œæœ€æ–°ç‰ˆæœ¬3.0.1å‘å¸ƒäº2016å¹´7æœˆ31æ—¥ï¼Œæœ‰APIæ–‡æ¡£å’Œç¤ºä¾‹ä»£ç ï¼Œä½†ç¼ºå°‘ç›¸å…³æŠ€æœ¯æ–‡ç« ï¼Œå¹¶ä»å­˜åœ¨ä¸€äº›æ€§èƒ½é—®é¢˜ã€‚</p>
<h4 id="2-V8"><a href="#2-V8" class="headerlink" title="2. V8"></a>2. <a href="https://developers.google.com/v8/" target="_blank" rel="external">V8</a></h4><p>V8æ˜¯ç”±Googleå¼€å‘å¹¶ç»´æŠ¤çš„é«˜æ€§èƒ½å¼€æºJSå¼•æ“ï¼Œé‡‡ç”¨C++ç¼–å†™ï¼Œä½¿ç”¨äºGoogle Chromeæµè§ˆå™¨ã€‚æœ€æ–°ç‰ˆæœ¬ä¸ºV8 5.5 betaï¼Œæ›´æ–°äº2016å¹´10æœˆ24æ—¥ã€‚</p>
<p>åŒJavaScriptCoreä¸€æ ·ï¼Œåœ¨Androidå¼€å‘ä¸­ï¼Œç›¸å…³æ¥å£éœ€è¦é€šè¿‡ä¸€å±‚åŒ…è£…è¿›è¡Œè°ƒç”¨ã€‚Githubä¸Šçš„å¼€æºé¡¹ç›®<a href="https://github.com/eclipsesource/J2V8" target="_blank" rel="external">J2V8</a>ï¼Œç›¸å…³æ–‡ç« å¯åœ¨æ­¤å¤„<a href="http://eclipsesource.com/blogs/tag/j2v8/" target="_blank" rel="external">http://eclipsesource.com/blogs/tag/j2v8/</a>æŸ¥é˜…ï¼Œæœ€æ–°ç‰ˆæœ¬4.6.0å‘å¸ƒäº2016å¹´9æœˆ22æ—¥ã€‚</p>
<p>J2V8æ˜¯ä¸€å¥—é’ˆå¯¹V8çš„Javaç»‘å®šã€‚J2V8çš„å¼€å‘ä¸ºAndroidå¹³å°å¸¦æ¥äº†é«˜æ•ˆçš„Javascriptçš„æ‰§è¡Œç¯å¢ƒï¼Œå…¶ä»¥æ€§èƒ½ä¸å†…å­˜æ¶ˆè€—ä¸ºè®¾è®¡ç›®æ ‡ã€‚å®ƒé‡‡ç”¨äº†â€œåŸºæœ¬ç±»å‹ä¼˜å…ˆâ€åŸåˆ™ï¼Œæ„å‘³ç€ä¸€ä¸ªæ‰§è¡Œç»“æœæ˜¯åŸºæœ¬ç±»å‹ï¼Œé‚£ä¹ˆæ‰€è¿”å›çš„å€¼ä¹Ÿå°±æ˜¯è¯¥åŸºæœ¬ç±»å‹ã€‚å®ƒè¿˜é‡‡ç”¨äº†â€œæ‡’åŠ è½½â€æŠ€æœ¯ï¼Œåªæœ‰å½“JSæ‰§è¡Œç»“æœè¢«è®¿é—®æ—¶ï¼Œæ‰ä¼šé€šè¿‡JNIå¤åˆ¶åˆ°Javaä¸­ã€‚</p>
<p>æ­¤å¤–J2V8æä¾›äº†<code>release()</code>æ–¹æ³•ï¼Œå¼€å‘è€…åœ¨æŸä¸€å¯¹è±¡ä¸å†éœ€è¦æ—¶ä¸»åŠ¨è°ƒç”¨è¯¥æ–¹æ³•å»é‡Šæ”¾æœ¬åœ°å¯¹è±¡å¥æŸ„ï¼Œé‡Šæ”¾è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¦‚æœæ˜¯ç”±ä»£ç åˆ›å»ºçš„å¯¹è±¡ï¼Œé‚£ä¹ˆå¿…é¡»é‡Šæ”¾å®ƒï¼›å¦‚æœä¸€ä¸ªå¯¹è±¡æ˜¯é€šè¿‡è¿”å›è¯­å¥ä¼ å›æ¥çš„è¯ï¼Œç³»ç»Ÿä¼šæ›¿ä½ é‡Šæ”¾å®ƒï¼›</li>
<li>å¦‚æœæ˜¯ç”±ç³»ç»Ÿåˆ›å»ºçš„å¯¹è±¡ï¼Œåˆ™æ— éœ€æ‹…å¿ƒé‡Šæ”¾ï¼Œè€Œå¦‚æœå¯¹è±¡æ˜¯JSæ–¹æ³•çš„è¿”å›å€¼ï¼Œå°±å¿…é¡»æ‰‹åŠ¨çš„é‡Šæ”¾å®ƒã€‚</li>
</ul>
<h4 id="3-SpiderMonkey"><a href="#3-SpiderMonkey" class="headerlink" title="3. SpiderMonkey"></a>3. <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey" target="_blank" rel="external">SpiderMonkey</a></h4><p>å¼€æºJSå¼•æ“SpiderMonkeyæœ€åˆç”±Netscapeå¼€å‘ï¼Œå¦‚ä»Šç”±Mozillaå¼€å‘å¹¶ç»´æŠ¤ï¼Œä¸”è¢«å¹¿æ³›ç”¨äºMozillaäº§å“ï¼ˆå¦‚FireFoxï¼‰ã€‚æœ€æ–°ç‰ˆæœ¬ä¸ºSpiderMonkey 45ï¼Œæ›´æ–°äº2016å¹´4æœˆ14æ—¥ã€‚</p>
<p>SpiderMonkeyæä¾›äº†ä¸€äº›æ ¸å¿ƒçš„JavaScriptæ•°æ®ç±»å‹ï¼Œå¦‚æ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°ç»„ï¼Œå¯¹è±¡ç­‰ç­‰ï¼Œä»¥åŠä¸€äº›æ–¹æ³•å¦‚Array.pushã€‚å®ƒè¿˜ä½¿å¾—æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½å®¹æ˜“å°†å…¶è‡ªå·±çš„å¯¹è±¡å’Œæ–¹æ³•æš´éœ²ç»™JavaScriptä»£ç ã€‚åº”ç”¨å¼€å‘è€…å¯ä»¥å†³å®šåº”ç”¨å¦‚ä½•å°†ä¸æ‰€å†™è„šæœ¬ç›¸å…³çš„å¯¹è±¡æš´éœ²å‡ºæ¥ã€‚</p>
<h4 id="4-Rhino"><a href="#4-Rhino" class="headerlink" title="4. Rhino"></a>4. <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino" target="_blank" rel="external">Rhino</a></h4><p>Rhinoæ˜¯ç”±Mozillaå¼€å‘çš„å¼€æºJSå¼•æ“ã€‚é‡‡ç”¨Javaç¼–å†™ï¼Œå› æ­¤å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œåœ¨JDK 6ã€JDK 7ä¸­æ›´æ˜¯æ†ç»‘äº†è¯¥å¼•æ“ã€‚æœ€æ–°ç‰ˆæœ¬ä¸ºRhino 1.7.7.1ï¼Œæ›´æ–°äº2016å¹´2æœˆ1æ—¥ã€‚</p>
<p>å…¶æä¾›çš„ç‰¹æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li>JavaScript 1.7çš„å…¨éƒ¨ç‰¹æ€§</li>
<li>å¯ä»¥ç”¨è„šæœ¬æ–¹å¼è°ƒç”¨Java</li>
<li>ç”¨ä¸€ä¸ªJavaScript Shellæ¥æ‰§è¡ŒJavaScriptè„šæœ¬</li>
<li>ç”¨ä¸€ä¸ªJavaScriptç¼–è¯‘å™¨æ¥å°†JavaScriptè„šæœ¬æ–‡ä»¶è½¬æ¢æˆJavaç±»æ–‡ä»¶</li>
<li>ç”¨ä¸€ä¸ªJavaScriptè°ƒè¯•å™¨æ¥è°ƒè¯•Rhinoæ‰§è¡Œçš„è„šæœ¬</li>
</ul>
<h4 id="5-Nashorn"><a href="#5-Nashorn" class="headerlink" title="5. Nashorn"></a>5. <a href="http://openjdk.java.net/projects/nashorn/" target="_blank" rel="external">Nashorn</a></h4><p>Nashornç”±Oracleå¼€å‘å¹¶ç»´æŠ¤ï¼Œä»JDK 8å¼€å§‹ï¼ŒRhinoè¢«Nashornä»£æ›¿ï¼Œæˆä¸ºJDKé»˜è®¤JSå¼•æ“ã€‚NashornåŒJDK 8ä¸€åŒå‘å¸ƒå’Œå¼€æºï¼Œè¾ƒRhinoè€Œè¨€æ€§èƒ½æ›´å¥½ï¼Œä½†ä¸æ”¯æŒAndroid Dalvikè™šæ‹Ÿæœºã€‚</p>
<h3 id="3-JSå¼•æ“æ€§èƒ½æ¯”è¾ƒ"><a href="#3-JSå¼•æ“æ€§èƒ½æ¯”è¾ƒ" class="headerlink" title="3. JSå¼•æ“æ€§èƒ½æ¯”è¾ƒ"></a>3. JSå¼•æ“æ€§èƒ½æ¯”è¾ƒ</h3><p>ä»å¯ç”¨æ€§æ–¹é¢è€ƒè™‘ï¼Œé€‰å–äº†JavaScriptCore+AndroidJSCoreï¼ˆä¸‹æ–‡ç”±â€œJSCoreâ€æŒ‡ä»£ï¼‰ã€V8+J2V8ï¼ˆä¸‹æ–‡ç”±â€œJ2V8â€æŒ‡ä»£ï¼‰å’ŒRhinoä¸‰ç§æ–¹æ¡ˆè¿›è¡Œå®éªŒã€‚</p>
<h4 id="3-1-åˆ›å»ºJSç¯å¢ƒ"><a href="#3-1-åˆ›å»ºJSç¯å¢ƒ" class="headerlink" title="3.1 åˆ›å»ºJSç¯å¢ƒ"></a>3.1 åˆ›å»ºJSç¯å¢ƒ</h4><p>éƒ¨åˆ†å¼•æ“å¹¶ä¸æ”¯æŒç›´æ¥è¿è¡Œæ–‡ä»¶ï¼Œå› æ­¤å°†JSä»£ç ä½œä¸ºå­—ç¬¦ä¸²äº¤ç»™JSå¼•æ“æ‰§è¡Œï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥è°ƒç”¨å·²æ³¨å†Œåˆ°JSä¸Šä¸‹æ–‡çš„Javaæ–¹æ³•ã€‚</p>
<h5 id="3-1-1-JSCore"><a href="#3-1-1-JSCore" class="headerlink" title="3.1.1 JSCore"></a>3.1.1 JSCore</h5><pre><code>//åˆ›å»ºJSä¸Šä¸‹æ–‡
JSContext context = new JSContext();
//åˆ›å»ºJavaæ–¹æ³•
JSFunction func = new JSFunction(context, &quot;func&quot;) {
    public void func(String msg) {
        //ç›¸å…³å¤„ç†
    }
};
//å°†Javaæ–¹æ³•æ³¨å†Œåˆ°JSä¸Šä¸‹æ–‡
context.property(&quot;func&quot;, func);
//æ‰§è¡ŒJS
context.evaluateScript(/*JSä»£ç */);
</code></pre><h5 id="3-1-2-J2V8"><a href="#3-1-2-J2V8" class="headerlink" title="3.1.2 J2V8"></a>3.1.2 J2V8</h5><pre><code>//åˆ›å»ºJSä¸Šä¸‹æ–‡
V8 context = V8.createV8Runtime();
//åˆ›å»ºJavaæ–¹æ³•ï¼Œå¹¶æ³¨å†Œåˆ°JSä¸Šä¸‹æ–‡
context.registerJavaMethod(new JavaVoidCallback() {
    public void invoke(final V8Object receiver, final V8Array parameters) {
        //ç›¸å…³å¤„ç†
    }
}, &quot;func&quot;);
//æ‰§è¡ŒJS
context.executeScript(js);
//é‡Šæ”¾èµ„æº
context.release();
</code></pre><h5 id="3-1-3-Rhino"><a href="#3-1-3-Rhino" class="headerlink" title="3.1.3 Rhino"></a>3.1.3 Rhino</h5><pre><code>class Func {
    void func(String msg) {
        //ç›¸å…³å¤„ç†
    }
}

//åˆ›å»ºJSä¸Šä¸‹æ–‡
Context context = Context.enter();
context.setOptimizationLevel(-1);
Scriptable scope = context.initStandardObjects();
try {
    //æ‰§è¡ŒJS
    context.evaluateString(scope, js, &quot;RhinoUtil&quot;, 1, null);

    //å°†Javaæ–¹æ³•å°è£…åˆ°ç±»ä¸­ï¼Œå¹¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™JSæ–¹æ³•
    Function function = (Function) scope.get(&quot;rhinofunc&quot;, scope);
    function.call(context, scope, scope, new Object[]{new Func()});
} finally {
    Context.exit();
}
</code></pre><h4 id="3-2-å®éªŒã€‡ï¼šåŒ…çš„ä¾èµ–"><a href="#3-2-å®éªŒã€‡ï¼šåŒ…çš„ä¾èµ–" class="headerlink" title="3.2 å®éªŒã€‡ï¼šåŒ…çš„ä¾èµ–"></a>3.2 å®éªŒã€‡ï¼šåŒ…çš„ä¾èµ–</h4><p>æ¯”è¾ƒå„æ–¹æ¡ˆä¾èµ–åŒ…å¼•å…¥åï¼Œapkçš„ä½“ç§¯å¢é‡ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>ä¾èµ–åŒ…å ç”¨(MB)</th>
<th>ä¾èµ–æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>J2V8</td>
<td>8.2</td>
<td>compile â€˜com.eclipsesource.j2v8:j2v8:4.6.0@aarâ€™</td>
</tr>
<tr>
<td>JSCore</td>
<td>44.9ğŸ˜³</td>
<td>compile â€˜com.github.ericwlange:AndroidJSCore:3.0.1â€™</td>
</tr>
<tr>
<td>Rhino</td>
<td>0.6</td>
<td>å°†jaråŒ…æ”¾å…¥libsæ–‡ä»¶å¤¹ä¸‹</td>
</tr>
</tbody>
</table>
<ul>
<li>J2V8å¼•å…¥çš„æ˜¯å…¨å¹³å°åŒ…ï¼Œå®é™…ä¸Šå®ƒæœ‰é’ˆå¯¹Linuxã€Windowsã€MacOSã€Androidå„å¹³å°è¿›è¡Œæ‰“åŒ…ï¼Œè€ŒAndroidå¹³å°æœ€æ–°ç‰ˆæœ¬ä¸º3.0.5ï¼ˆçº¦4MBï¼‰ï¼Œå¹¶ä¸æ˜¯æœ€æ–°çš„4.6.0ç‰ˆæœ¬</li>
<li>å…·AndroidJsCoreä½œè€…å›ç­”ï¼Œç”±äºå¿…é¡»é’ˆå¯¹å„CPUæ¶æ„è¿›è¡Œæ‰“åŒ…ï¼Œè€Œæœ‰7ç§CPUæ¶æ„ï¼Œæ¯ç§æ¶æ„åŒ…çº¦6MBï¼Œå› æ­¤æ•´ä¸ªä¾èµ–åŒ…ä½“ç§¯ç›¸æ¯”ä¹‹ä¸‹æ˜¾å¾—åºå¤§ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡ABIs Splitsè¿›è¡Œæ‹†åˆ†ã€‚</li>
<li>Rhinoçš„jaråŒ…ä»…1.2Mï¼Œå› æ­¤apkå¢é‡å¹¶ä¸æ˜¾è‘—ã€‚</li>
</ul>
<h4 id="3-3-å®éªŒä¸€ï¼šç©ºå¾ªç¯"><a href="#3-3-å®éªŒä¸€ï¼šç©ºå¾ªç¯" class="headerlink" title="3.3 å®éªŒä¸€ï¼šç©ºå¾ªç¯"></a>3.3 å®éªŒä¸€ï¼šç©ºå¾ªç¯</h4><p>JSCoreå’ŒJ2V8æ‰§è¡ŒJSä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>var i = 0;
for (;i &lt; /*æ¬¡æ•°*/; i++) {
}
</code></pre><p>Rhinoæ‰§è¡ŒJSä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>function rhinofunc(f) {
    var i = 0;
    for (;i &lt; /*æ¬¡æ•°*/; i++) {
    }
}
</code></pre><p>å¾ªç¯æ¬¡æ•°åˆ†åˆ«è®¾ç½®ä¸º100ä¸‡ã€1000ä¸‡ã€1äº¿æ¬¡ï¼Œåœ¨Javaä»£ç ä¸­æ‰§è¡ŒJSå‰è¾“å‡ºå¼€å§‹æ—¶é—´ï¼Œåœ¨JSæ‰§è¡Œåè¾“å‡ºç»“æŸæ—¶é—´ï¼Œç›¸å‡å¾—å‡ºæ‰§è¡Œæ—¶é—´è®°å½•å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ‰§è¡Œæ—¶é—´(ms)</th>
<th>100ä¸‡æ¬¡</th>
<th>1000ä¸‡æ¬¡</th>
<th>1äº¿æ¬¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>J2V8</td>
<td>17.6</td>
<td>122.8</td>
<td>1116.6</td>
</tr>
<tr>
<td>JSCore</td>
<td>22</td>
<td>173.2</td>
<td>1551</td>
</tr>
<tr>
<td>Rhino</td>
<td>2078.4</td>
<td>22358.4</td>
<td>198600ğŸ˜³</td>
</tr>
</tbody>
</table>
<p>ç”±å®éªŒç»“æœå¯ä»¥çœ‹åˆ°ï¼šJ2V8å’ŒJSCoreç›¸æ¯”ï¼ŒJ2V8æ‰§è¡Œæ—¶é—´æ›´çŸ­ï¼Œä½†ä¸¤è€…æ—¶é—´éƒ½åœ¨åŒä¸€æ•°é‡çº§ä¸Šã€‚è€ŒRhinoæ‰§è¡Œæ—¶é—´è¿œå¤§äºå‰ä¸¤è€…ï¼Œæ ¹æœ¬åŸå› åœ¨äºJavaç¨‹åºè¿è¡Œè¾ƒC/C++æ…¢ã€‚</p>
<h4 id="3-4-å®éªŒäºŒï¼šJSè°ƒç”¨Javaæ–¹æ³•"><a href="#3-4-å®éªŒäºŒï¼šJSè°ƒç”¨Javaæ–¹æ³•" class="headerlink" title="3.4 å®éªŒäºŒï¼šJSè°ƒç”¨Javaæ–¹æ³•"></a>3.4 å®éªŒäºŒï¼šJSè°ƒç”¨Javaæ–¹æ³•</h4><p>JSCoreå’ŒJ2V8æ‰§è¡ŒJSä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>var i = 0;
for (;i &lt; /*æ¬¡æ•°*/; i++) {
    func();
}
</code></pre><p>Rhinoæ‰§è¡ŒJSä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>function rhinofunc(f) {
    var i = 0;
    for (;i &lt; /*æ¬¡æ•°*/; i++) {
        f.func();
    }
}
</code></pre><p>è°ƒç”¨æ¬¡æ•°åˆ†åˆ«è®¾ç½®ä¸º1ä¸‡ã€10ä¸‡ã€100ä¸‡æ¬¡ï¼Œè®°å½•æ‰§è¡Œæ—¶é—´å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ‰§è¡Œæ—¶é—´(ms)</th>
<th>1ä¸‡æ¬¡</th>
<th>10ä¸‡æ¬¡</th>
<th>100ä¸‡æ¬¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>J2V8</td>
<td>490.2</td>
<td>4855.8</td>
<td>47527</td>
</tr>
<tr>
<td>JSCore</td>
<td>1287.6</td>
<td>13448.2</td>
<td>121586.8ğŸ˜³</td>
</tr>
<tr>
<td>Rhino</td>
<td>408.2</td>
<td>4007.2</td>
<td>36752.4</td>
</tr>
</tbody>
</table>
<p>å¯åŠ¨Appæ—¶è®°å½•å ç”¨å†…å­˜ï¼ŒJSæ‰§è¡Œè¿‡ç¨‹ä¸­è®°å½•æœ€é«˜å ç”¨å†…å­˜ï¼Œç›¸å‡å¾—å‡ºå ç”¨å†…å­˜ã€‚</p>
<table>
<thead>
<tr>
<th>å ç”¨å†…å­˜(KB)</th>
<th>1ä¸‡æ¬¡</th>
<th>10ä¸‡æ¬¡</th>
<th>100ä¸‡æ¬¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>J2V8</td>
<td>7264</td>
<td>14004</td>
<td>17328</td>
</tr>
<tr>
<td>JSCore</td>
<td>15368</td>
<td>15140</td>
<td>16720</td>
</tr>
<tr>
<td>Rhino</td>
<td>2776</td>
<td>9084</td>
<td>9116</td>
</tr>
</tbody>
</table>
<p>åŒæ ·ä¹Ÿæ˜¯ç”±äºå¼€å‘è¯­è¨€çš„å·®å¼‚ï¼Œåœ¨JSè°ƒç”¨Javaä¸ŠRhinoæ€§èƒ½æ›´ä¼˜ã€‚æ‰§è¡Œæ—¶é—´æ–¹é¢ï¼ŒJ2V8æ¥è¿‘Rhinoï¼Œè€ŒJSCoreåˆ™è¿œè½åäºå‰ä¸¤ç§æ–¹æ¡ˆï¼Œè¿™å¯èƒ½ä¸å…¶Javaç»‘å®šå±‚æœ‰å¾ˆå¤§å…³ç³»ã€‚å¯¹äºJ2V8å’ŒJSCoreåˆ™éœ€è¦å…ˆç»è¿‡JNIåŒ…è£…å±‚æ‰èƒ½è°ƒç”¨åˆ°Javaæ–¹æ³•ï¼Œè€Œå¤§é‡çš„JNIè°ƒç”¨æ˜¯éå¸¸è€—æ—¶ã€è€—å†…å­˜çš„ã€‚</p>
<h4 id="3-5-å®éªŒä¸‰ï¼šJSé€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘"><a href="#3-5-å®éªŒä¸‰ï¼šJSé€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘" class="headerlink" title="3.5 å®éªŒä¸‰ï¼šJSé€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘"></a>3.5 å®éªŒä¸‰ï¼šJSé€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘</h4><p>JSä»£ç æ–æ³¢é‚£å¥‘å‡½æ•°å¦‚ä¸‹ï¼š</p>
<pre><code>function fibo(n) {
    if (n == 1 || n == 2) {
        return 1;
    }
    else {
        return fibo(n - 1) + fibo(n - 2);
    }
}
</code></pre><table>
<thead>
<tr>
<th>æ‰§è¡Œæ—¶é—´(ms)</th>
<th>fibo(20)</th>
<th>fibo(30)</th>
<th>fibo(40)</th>
</tr>
</thead>
<tbody>
<tr>
<td>J2V8</td>
<td>4</td>
<td>67.6</td>
<td>8158.6</td>
</tr>
<tr>
<td>JSCore</td>
<td>6.6</td>
<td>76.2</td>
<td>7884.4</td>
</tr>
<tr>
<td>Rhino</td>
<td>248.4</td>
<td>26898</td>
<td>???ğŸ˜³</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>å ç”¨å†…å­˜(KB)</th>
<th>fibo(20)</th>
<th>fibo(30)</th>
<th>fibo(40)</th>
</tr>
</thead>
<tbody>
<tr>
<td>J2V8</td>
<td>6148</td>
<td>6120</td>
<td>17328</td>
</tr>
<tr>
<td>JSCore</td>
<td>6204</td>
<td>6200</td>
<td>16720</td>
</tr>
<tr>
<td>Rhino</td>
<td>5284</td>
<td>9052</td>
<td>9116</td>
</tr>
</tbody>
</table>
<p>Rhinoè¿è¡ŒJSæ—¶é¢‘ç¹GCï¼Œè™½ç„¶ä½¿å…¶æ‰€å å†…å­˜è¾ƒå°‘ï¼Œä½†æ‰§è¡Œé€Ÿåº¦éå¸¸ç¼“æ…¢ï¼Œç›¸æ¯”ä¹‹ä¸‹J2V8å’ŒJSCoreæ–¹æ¡ˆæ•ˆç‡æ›´é«˜ã€‚</p>
<h4 id="3-6-å®éªŒæ€»ç»“"><a href="#3-6-å®éªŒæ€»ç»“" class="headerlink" title="3.6 å®éªŒæ€»ç»“"></a>3.6 å®éªŒæ€»ç»“</h4><p>å•ä»JSå¼•æ“æ¥è¯´ï¼šRhinoæ‰§è¡Œä¸éœ€è¦é€šè¿‡JNIä¸”å ç”¨æ›´å°‘çš„å†…å­˜ï¼Œä½†æ‰§è¡Œæ•ˆç‡å¾ˆä½ï¼›V8å’ŒJavaScriptCoreç­‰Cè¯­è¨€å¼€å‘çš„å¼•æ“è¿œèƒœäºRhinoç­‰Javaå¼€å‘çš„å¼•æ“ï¼Œä½†éœ€è¦ä¸€å±‚JavaåŒ…è£…å±‚ï¼Œå¹¶å­˜åœ¨JNIè°ƒç”¨æ€§èƒ½é—®é¢˜ã€‚å°±J2V8å’ŒAndroidJSCoreä¸¤ä¸ªåŒ…è£…å±‚è€Œè¨€ï¼šJ2V8çš„å¯ç”¨æ€§ã€å¯é æ€§ã€å¥å£®æ€§æ›´ä¼˜ï¼›AndroidJSCoreè¿˜å­˜åœ¨ç€ä¸å°‘çš„æ€§èƒ½é—®é¢˜ï¼Œåœ¨ä¸Šè¿°å®éªŒä¸­å‡ºç°è¾ƒå°‘ï¼Œä½†å®é™…å¼€å‘ä¸­è¿˜å­˜åœ¨å¾ˆå¤šå‘ã€‚</p>
<p>ä»¥ä¸Šä¸‰ç§å®ç°æ–¹æ¡ˆä¸­æ›´æ¨èJ2V8æ–¹æ¡ˆã€‚å¯¹äºå†…å­˜é—®é¢˜ï¼ŒJ2V8çš„å†…å­˜é‡Šæ”¾æœºåˆ¶è¾ƒä¸ºå®Œå–„ï¼Œåœ¨å®é™…å¼€å‘ä¸­å¯ä»¥é€šè¿‡ä¸»åŠ¨releaseæ¥é‡Šæ”¾å†…å­˜ï¼›å¯¹äºJNIè°ƒç”¨æ€§èƒ½é—®é¢˜ï¼ŒJ2V8å›¢é˜Ÿä¹Ÿåœ¨å°è¯•é€šè¿‡æ‰¹å¤„ç†å›è°ƒæ¥è¿›è¡Œä¼˜åŒ–ï¼Œåœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ä¼šå¾—åˆ°æ”¹å–„ã€‚</p>
<h3 id="4-J2V8çš„Androidå¼€å‘å®ä¾‹"><a href="#4-J2V8çš„Androidå¼€å‘å®ä¾‹" class="headerlink" title="4. J2V8çš„Androidå¼€å‘å®ä¾‹"></a>4. J2V8çš„Androidå¼€å‘å®ä¾‹</h3><p>æœ‰ä»¥ä¸‹ä¸€æ®µJSä»£ç ï¼Œå…¶ä¸­Canvasç»˜åˆ¶äº†ä¸€äº›ç®€å•çš„å›¾å½¢ï¼š</p>
<pre><code>var c=document.getElementById(&quot;myCanvas&quot;);
var ctx=c.getContext(&quot;2d&quot;);

ctx.beginPath();
ctx.arc(100, 100, 25, 0, 360, false);
ctx.moveTo(20,20);
ctx.lineTo(20,100);
ctx.lineTo(70,100);
ctx.moveTo(100, 100);
ctx.setLineWidth(15);
ctx.setStrokeColor(&quot;#188ffc&quot;);
ctx.stroke();

ctx.setFillColor(&quot;#188ffc&quot;);
ctx.fillText(&quot;Hello World!&quot;,150,50);
</code></pre><p>å…¶åœ¨Webç«¯ç»˜åˆ¶æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“/web_shape.png" alt="logo"></p>
<p>å®ä¾‹ä¸­ï¼Œå€ŸåŠ©J2V8åœ¨Androidç«¯è¿è¡ŒåŒæ ·ä¸€æ®µè„šæœ¬ï¼Œä½¿å›¾å½¢ç»˜åˆ¶åˆ°Android Canvasä¸­ã€‚ä¸‹é¢ç»™å‡ºç®€å•å®ç°ï¼Œä¸»è¦æ€è·¯ä¸ºè‡ªå®šä¹‰Viewï¼ŒJSä¸­å°†è¦ç»˜åˆ¶çš„å›¾å½¢å…ˆå­˜å‚¨åˆ°åœ¨Listä¸­ï¼Œå¾…æ•´ä¸ªJSè„šæœ¬æ‰§è¡Œå®Œæ¯•ï¼Œå†å°†æ‰€æœ‰å›¾å½¢åœ¨<code>View.onDraw(Canvas canvas)</code>ä¸­é€šè¿‡Android Canvasç»˜åˆ¶ã€‚</p>
<p>1) å°†ctxå°è£…ä¸ºV8Objectï¼Œå¹¶åœ¨å…¶ä¸­å¯¹åº”å®ç°JS Canvasçš„æ–¹æ³•</p>
<pre><code>public class JustContext {
    protected V8 mRuntime;
    protected V8Object mCtx;
    private ArrayList&lt;AbstractDraw&gt; mShapeList = new ArrayList&lt;&gt;();

    public JustContext(V8 v8Runtime) {
        mRuntime = v8Runtime;
        initCtx();
    }

    public V8Object getCtx() {
        return mCtx;
    }

    public ArrayList&lt;AbstractDraw&gt; getShapeList() {
        return mShapeList;
    }

    protected void initCtx() {
        mCtx = new V8Object(mRuntime);

        //å°†Javaæ–¹æ³•æ³¨å†Œåˆ°è¯¥V8Objectä¸­
        mCtx.registerJavaMethod(this, &quot;beginPath&quot;, &quot;beginPath&quot;, null);
        mCtx.registerJavaMethod(this, &quot;closePath&quot;, &quot;closePath&quot;, null);

        ...
    }

    public void clean() {
        mCtx.release();
    }

    public void beginPath() {...}

    public void closePath() {...}

    ...
}
</code></pre><p>2) è‡ªå®šä¹‰Viewï¼Œåœ¨Viewçš„<code>onDraw(Canvas canvas)</code>æ–¹æ³•ä¸­å°†ä¼ å…¥çš„å›¾å½¢Listç»˜åˆ¶å‡ºæ¥</p>
<pre><code>public class JustView extends View implements Serializable {
    ...

    private ArrayList&lt;AbstractDraw&gt; mShapeList = new ArrayList&lt;&gt;();

    public void setShapeList(ArrayList&lt;AbstractDraw&gt; shapeList) {
        this.mShapeList = shapeList;
    }

    @Override
    protected void onDraw(Canvas canvas) {
        super.onDraw(canvas);

        for (AbstractDraw abstractDraw : mShapeList) {
            abstractDraw.draw(canvas);
        }
    }

    ...
}
</code></pre><p>3) å°†ctxæ³¨å†Œåˆ°JSä¸Šä¸‹æ–‡ï¼Œå¹¶æ‰§è¡ŒJSä»£ç ï¼Œæ‰§è¡Œå®Œæ¯•åå°†ç»˜åˆ¶å›¾å½¢Listä¼ é€’ç»™View</p>
<pre><code>JustView mJustView;
...

public void runJs(String js) {
    V8 context = V8.createV8Runtime();
    JustContext ctx = new JustContext(context);
    context.add(&quot;ctx&quot;, ctx.getCtx());
    context.executeScript(js);

    //é‡Šæ”¾å†…å­˜
    ctx.clean();
    context.release();

    mJustView.setShapeList(ctx.getShapeList());
}

...
</code></pre><p>4) å› ä¸ºå·²å°†ctxæ³¨å†Œåˆ°JSä¸Šä¸‹æ–‡ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨<code>ctx</code>å˜é‡ï¼Œå¹¶è¿è¡Œå¦‚ä¸‹JSä»£ç </p>
<pre><code>    ctx.beginPath();
    ctx.arc(100, 100, 25, 0, 360, false);
    ctx.moveTo(20,20);
    ctx.lineTo(20,100);
    ctx.lineTo(70,100);
    ctx.moveTo(100, 100);
    ctx.setLineWidth(15);
    ctx.setStrokeColor(&quot;#188ffc&quot;);
    ctx.stroke();        
    ctx.setFillColor(&quot;#188ffc&quot;);
    ctx.fillText(&quot;Hello World!&quot;,150,50);

ç»˜åˆ¶ç»“æœå¦‚ä¸‹ï¼š
</code></pre><p><img src="Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“/android_shape.png" alt="android_shape"></p>
<p>ä»¥ä¸Šä»…æ˜¯è¯¥å®ä¾‹çš„ç®€å•å®ç°ï¼Œè¯¦ç»†çš„ä»£ç å’Œè®¾è®¡å¯ä»¥æ ¹æ®éœ€æ±‚çš„ä¸åŒè€Œè¿›è¡Œç»†åŒ–ï¼Œæ­¤å¤„<a href="https://github.com/LiuHongtao/JustDraw" target="_blank" rel="external">https://github.com/LiuHongtao/JustDraw</a>æä¾›ä¸€ä»½å…·ä½“å®ç°çš„å‚è€ƒã€‚ç”±äºæ¯æ‰§è¡Œä¸€ä¸ªCanvasæ–¹æ³•éƒ½å°†è°ƒç”¨ä¸€æ¬¡Javaæ–¹æ³•ï¼Œè¯¥æ–¹æ¡ˆå½“ç»˜åˆ¶é‡è¿‡å¤§çš„æ—¶å€™ä¼šå‡ºç°JNIè°ƒç”¨çš„æ€§èƒ½é—®é¢˜ï¼Œåœ¨æ€§èƒ½æ–¹é¢ä¹Ÿå­˜åœ¨ä¼˜åŒ–çš„ç©ºé—´ï¼Œåç»­å·¥ä½œä¸­å°†è¿›è¡Œè°ƒç”¨çš„ä¼˜åŒ–ï¼Œå‡å°‘JNIè°ƒç”¨æ¬¡æ•°ã€‚</p>
<p>J2V8çš„å›¢é˜Ÿå¼€å‘çš„ä¸€å¥—ç§»åŠ¨ç«¯è·¨å¹³å°æ¡†æ¶<a href="https://tabrisjs.com/" target="_blank" rel="external">Tabris.js</a>ï¼Œæ”¯æŒAndroidå’ŒiOSå¹³å°ï¼Œåˆäºè¿‘æœŸå®£å¸ƒæ”¯æŒWindows 10ã€‚è¯¥æ¡†æ¶æ—¨åœ¨ç¼–å†™ä¸€ä»½JavaScriptä»£ç ï¼Œè€Œèƒ½ç”ŸæˆAndroidå’ŒiOSä¸¤ä¸ªå¹³å°çš„æœ¬åœ°åº”ç”¨ã€‚å®ƒåœ¨Androidä¸Šä½¿ç”¨äº†J2V8ä½œä¸ºJSå¼•æ“æ–¹æ¡ˆï¼Œåœ¨iOSä¸Šä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„JSCoreã€‚</p>
<p>ä¸åŒäºReactNativeã€Weexä¹‹ç±»çš„æ¡†æ¶ï¼Œå®ƒçš„äº®ç‚¹åœ¨äºä¸é€šè¿‡WebViewï¼Œä½†å´èƒ½ä½¿ç”¨Web APIsï¼Œå¦‚Canvas 2d contextï¼ˆæ®äº†è§£ï¼ŒWeexä¹Ÿæ­£åœ¨æµ‹è¯•Canvasç»„ä»¶å¹¶å³å°†å¼€æºï¼‰ã€XMLHttpRequestã€localStorageã€‚è¯¥æ¡†æ¶é€šè¿‡æ‰¹å¤„ç†å›è°ƒå‡å°‘äº†JNIçš„è°ƒç”¨ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†JNIæ€§èƒ½é—®é¢˜ï¼Œä¾‹å¦‚å…¶Canvasç›¸å…³ä»£ç <code>tabris.CanvasContext</code>ä¸­ï¼Œå…ˆå°†æ¯æ¬¡è°ƒç”¨çš„Canvasæ–¹æ³•å’Œå‚æ•°å­˜å‚¨èµ·æ¥ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶å€™é€šè¿‡ä¸€æ¬¡JNIè°ƒç”¨æ¥ä¼ é€’è¦æ‰§è¡Œçš„Canvasæ–¹æ³•ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>defineMethod(&quot;fillText&quot;, 3, function(text, x, y /* , maxWidth */) {
    this._strings.push(text);
    this._booleans.push(false, false, false);
    this._doubles.push(x, y);
});

function defineMethod(name, reqArgCount, fn) {
    tabris.CanvasContext.prototype[name] = function() {
        if (reqArgCount &amp;&amp; arguments.length &lt; reqArgCount) {
            throw new Error(&quot;Not enough arguments to CanvasContext.&quot; + name);
        }
        this._pushOperation(name);
        if (fn) {
            fn.apply(this, arguments);
        }
    };
}

_pushOperation: function(operation) {
    if (this._opCodes.indexOf(operation) &lt; 0) {
        this._newOpCodes.push(operation);
        this._opCodes.push(operation);
    }
    this._operations.push(this._opCodes.indexOf(operation));
}

_flush: function() {
    if (this._operations.length &gt; 0) {
        this._gc._nativeCall(&quot;draw&quot;, {packedOperations: [
          this._newOpCodes,
          this._operations,
          this._doubles,
          this._booleans,
          this._strings,
          this._ints]});
        this._newOpCodes = [];
      this._operations = [];
      this._doubles = [];
      this._booleans = [];
      this._strings = [];
      this._ints = [];
    }
}
</code></pre><p>ä¹Ÿå°±æ˜¯è¯´Tabris.jsæ›´å®Œæ•´çš„çš„å®ç°äº†æœ¬èŠ‚ä¸­çš„æ–¹æ¡ˆï¼Œè¿™ä¹Ÿä½¿å¾—â€œå°†Webç«¯JSåº“ç›´æ¥æ‹¿åˆ°ç§»åŠ¨ç«¯æ‰§è¡Œï¼Œå¹¶ç”±æœ¬åœ°è¾“å‡ºç»“æœâ€å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p>
<p>ç›¸å…³æ–‡ç« </p>
<ul>
<li><p><a href="https://www.skyscanner.net/blogs/developing-mobile-cross-platform-library-part-3-javascript" target="_blank" rel="external">Developing a mobile cross-platform library - Part 3. JavaScript</a></p>
</li>
<li><p><a href="http://openaphid.github.io/blog/2013/01/17/part-i-how-to-choose-a-javascript-engine-for-ios-and-android-apps/" target="_blank" rel="external">Part I: How to Choose a JavaScript Engine for iOS and Android Development</a></p>
</li>
<li><p><a href="http://eclipsesource.com/blogs/getting-started-with-j2v8/" target="_blank" rel="external">Getting Started With J2V8</a></p>
</li>
<li><p><a href="https://www.eclipsecon.org/na2015/sites/default/files/slides/J2V8_0.pdf" target="_blank" rel="external">J2V8-A Highly Efficient JS Runtime For Java</a></p>
</li>
<li><p><a href="http://eclipsesource.com/blogs/2016/08/10/smile-deploying-a-mobile-app-has-never-been-so-easy/" target="_blank" rel="external">Smile: Deploying a mobile app has never been so easy</a></p>
</li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/android/">android</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Jså¼•æ“/">Jså¼•æ“</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://NEYouFan.github.io/2016/12/23/android/Android Jså¼•æ“/Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“/" data-title="Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“ | ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/12/29/ios/å…³äºLLVMè¿™äº›ä¸œè¥¿ä½ å¿…é¡»è¦çŸ¥é“ /" title="å…³äºLLVMï¼Œè¿™äº›ä¸œè¥¿ä½ å¿…é¡»è¦çŸ¥é“">
  <strong>ä¸Šä¸€ç¯‡ï¼š</strong><br/>
  <span>
  å…³äºLLVMï¼Œè¿™äº›ä¸œè¥¿ä½ å¿…é¡»è¦çŸ¥é“</span>
</a>
</div>


<div class="next">
<a href="/2016/12/16/ios/NeteaseAPM iOS SDKæŠ€æœ¯å®ç°/NeteaseAPM iOS SDKæŠ€æœ¯å®ç°/"  title="NeteaseAPM iOS SDKæŠ€æœ¯å®ç°">
 <strong>ä¸‹ä¸€ç¯‡ï¼š</strong><br/> 
 <span>NeteaseAPM iOS SDKæŠ€æœ¯å®ç°
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/12/23/android/Android Jså¼•æ“/Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“/" data-title="Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“" data-url="http://NEYouFan.github.io/2016/12/23/android/Android Jså¼•æ“/Androidå¹³å°ä¸Šçš„JavaScriptå¼•æ“/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="æ˜¾ç¤ºä¾§è¾¹æ "></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">1. å‰è¨€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-JSå¼•æ“ä»‹ç»"><span class="toc-number">2.</span> <span class="toc-text">2. JSå¼•æ“ä»‹ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-JavaScriptCore"><span class="toc-number">2.1.</span> <span class="toc-text">1. JavaScriptCore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-V8"><span class="toc-number">2.2.</span> <span class="toc-text">2. V8</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-SpiderMonkey"><span class="toc-number">2.3.</span> <span class="toc-text">3. SpiderMonkey</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-Rhino"><span class="toc-number">2.4.</span> <span class="toc-text">4. Rhino</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-Nashorn"><span class="toc-number">2.5.</span> <span class="toc-text">5. Nashorn</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-JSå¼•æ“æ€§èƒ½æ¯”è¾ƒ"><span class="toc-number">3.</span> <span class="toc-text">3. JSå¼•æ“æ€§èƒ½æ¯”è¾ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-åˆ›å»ºJSç¯å¢ƒ"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 åˆ›å»ºJSç¯å¢ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-1-JSCore"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 JSCore</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-2-J2V8"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2 J2V8</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-3-Rhino"><span class="toc-number">3.1.3.</span> <span class="toc-text">3.1.3 Rhino</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-å®éªŒã€‡ï¼šåŒ…çš„ä¾èµ–"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 å®éªŒã€‡ï¼šåŒ…çš„ä¾èµ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-å®éªŒä¸€ï¼šç©ºå¾ªç¯"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 å®éªŒä¸€ï¼šç©ºå¾ªç¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-å®éªŒäºŒï¼šJSè°ƒç”¨Javaæ–¹æ³•"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 å®éªŒäºŒï¼šJSè°ƒç”¨Javaæ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-å®éªŒä¸‰ï¼šJSé€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 å®éªŒä¸‰ï¼šJSé€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-å®éªŒæ€»ç»“"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 å®éªŒæ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-J2V8çš„Androidå¼€å‘å®ä¾‹"><span class="toc-number">4.</span> <span class="toc-text">4. J2V8çš„Androidå¼€å‘å®ä¾‹</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="éšè—ä¾§è¾¹æ "></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">åˆ†ç±»</p>
		<ul>
		
		  
			<li><a href="/categories/android/" title="android">android<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/ios/" title="ios">ios<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">æ ‡ç­¾</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Jenkins/" title="Jenkins">Jenkins<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ciå®¹å™¨/" title="ciå®¹å™¨">ciå®¹å™¨<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/androidå·¥ç¨‹æ¨¡æ¿/" title="androidå·¥ç¨‹æ¨¡æ¿">androidå·¥ç¨‹æ¨¡æ¿<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/LLVM/" title="LLVM">LLVM<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Jså¼•æ“/" title="Jså¼•æ“">Jså¼•æ“<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/NeteaseAPM/" title="NeteaseAPM">NeteaseAPM<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/æ··åˆå¼€å‘æ¡†æ¶/" title="æ··åˆå¼€å‘æ¡†æ¶">æ··åˆå¼€å‘æ¡†æ¶<sup>1</sup></a></li>
			
		
		</ul>
</div>


  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS è®¢é˜…</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">å¾®ä¿¡å…±ä¼—å·</p>
  <div class="barcode">
    <img src="/img/barcode.jpg" alt="">
  </div>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
		<p class="copyright">
		cpryright Â© 2017
		
		<a href="/about" target="_blank" title="ç½‘æ˜“å‰ç«¯æŠ€æœ¯éƒ¨">ç½‘æ˜“å‰ç«¯æŠ€æœ¯éƒ¨</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="å¾®ä¿¡"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="äººäºº"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="å¾®åš"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"neyoufan"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="è¿”å›é¡¶éƒ¨"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
