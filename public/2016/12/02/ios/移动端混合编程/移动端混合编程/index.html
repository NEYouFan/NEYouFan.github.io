
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>èŠèŠç§»åŠ¨ç«¯é‚£äº›æ··åˆå¼€å‘æ¡†æ¶ä»¬ | ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="ç½‘æ˜“å‰ç«¯æŠ€æœ¯éƒ¨">
    

    
    <meta name="description" content="æœ¬æ–‡ä¸»è¦ä»‹ç»ç¬”è€…å‰äº›æ—¥å­å¯¹å¸‚é¢ä¸Šä¸€äº›ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹æ–¹æ¡ˆçš„å®ç°æ–¹å¼ä¸Šçš„è°ƒç ”ï¼Œè¯»è€…å¯ä»¥æ®æ­¤äº†è§£ç§»åŠ¨ç«¯ç›®å‰å¸¸è§çš„ä¸€äº›æ··åˆå¼€å‘æ¡†æ¶çš„å®ç°åŸç†ï¼Œæ¬¢è¿è¯»è€…åœ¨æœ¬æ–‡åŸºç¡€ä¸Šåšæ›´æ·±å…¥çš„æ¢ç´¢å’Œè°ƒç ”ï¼Œå¦‚æœ‰çº°æ¼ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="èŠèŠç§»åŠ¨ç«¯é‚£äº›æ··åˆå¼€å‘æ¡†æ¶ä»¬">
<meta property="og:url" content="http://NEYouFan.github.io/2016/12/02/ios/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/index.html">
<meta property="og:site_name" content="ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨">
<meta property="og:description" content="æœ¬æ–‡ä¸»è¦ä»‹ç»ç¬”è€…å‰äº›æ—¥å­å¯¹å¸‚é¢ä¸Šä¸€äº›ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹æ–¹æ¡ˆçš„å®ç°æ–¹å¼ä¸Šçš„è°ƒç ”ï¼Œè¯»è€…å¯ä»¥æ®æ­¤äº†è§£ç§»åŠ¨ç«¯ç›®å‰å¸¸è§çš„ä¸€äº›æ··åˆå¼€å‘æ¡†æ¶çš„å®ç°åŸç†ï¼Œæ¬¢è¿è¯»è€…åœ¨æœ¬æ–‡åŸºç¡€ä¸Šåšæ›´æ·±å…¥çš„æ¢ç´¢å’Œè°ƒç ”ï¼Œå¦‚æœ‰çº°æ¼ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚">
<meta property="og:image" content="http://NEYouFan.github.io/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/Cordova.png">
<meta property="og:image" content="http://NEYouFan.github.io/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/superwebview.png">
<meta property="og:image" content="http://NEYouFan.github.io/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/superwebview.gif">
<meta property="og:image" content="http://NEYouFan.github.io/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/superwebview2.png">
<meta property="og:image" content="http://NEYouFan.github.io/./superwebview3.png">
<meta property="og:image" content="http://NEYouFan.github.io/5+.png">
<meta property="og:image" content="http://NEYouFan.github.io/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/reactnative.png">
<meta property="og:image" content="http://NEYouFan.github.io/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/reactnative2.png">
<meta property="og:image" content="http://NEYouFan.github.io/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/p-native.gif">
<meta property="og:image" content="http://NEYouFan.github.io/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/p-rn.gif">
<meta property="og:image" content="http://NEYouFan.github.io/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/reactnative-scrollview.png">
<meta property="og:updated_time" content="2017-01-05T05:42:25.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="èŠèŠç§»åŠ¨ç«¯é‚£äº›æ··åˆå¼€å‘æ¡†æ¶ä»¬">
<meta name="twitter:description" content="æœ¬æ–‡ä¸»è¦ä»‹ç»ç¬”è€…å‰äº›æ—¥å­å¯¹å¸‚é¢ä¸Šä¸€äº›ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹æ–¹æ¡ˆçš„å®ç°æ–¹å¼ä¸Šçš„è°ƒç ”ï¼Œè¯»è€…å¯ä»¥æ®æ­¤äº†è§£ç§»åŠ¨ç«¯ç›®å‰å¸¸è§çš„ä¸€äº›æ··åˆå¼€å‘æ¡†æ¶çš„å®ç°åŸç†ï¼Œæ¬¢è¿è¯»è€…åœ¨æœ¬æ–‡åŸºç¡€ä¸Šåšæ›´æ·±å…¥çš„æ¢ç´¢å’Œè°ƒç ”ï¼Œå¦‚æœ‰çº°æ¼ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚">
<meta name="twitter:image" content="http://NEYouFan.github.io/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/Cordova.png">

    
    <link rel="alternative" href="/atom.xml" title="ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨" title="ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨">ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="èœå•">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">ä¸»é¡µ</a></li>
					
						<li><a href="/archives">å½’æ¡£</a></li>
					
						<li><a href="/about">å…³äº</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="æœç´¢" />
						<input type="hidden" name="q" value="site:NEYouFan.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/12/02/ios/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/" title="èŠèŠç§»åŠ¨ç«¯é‚£äº›æ··åˆå¼€å‘æ¡†æ¶ä»¬" itemprop="url">èŠèŠç§»åŠ¨ç«¯é‚£äº›æ··åˆå¼€å‘æ¡†æ¶ä»¬</a>
  </h1>
  <p class="article-author">By
       
		<span style="color: rgb(44, 166, 203);" >å¼ å»ºä¼Ÿ</span>
		
  <p class="article-time">
    <time datetime="2016-12-01T16:00:00.000Z" itemprop="datePublished"> å‘è¡¨äº 2016-12-02</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">æ–‡ç« ç›®å½•</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web-amp-Native"><span class="toc-number">2.</span> <span class="toc-text">Web & Native</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#é‚£äº›æ··åˆç¼–ç¨‹ä»¬"><span class="toc-number">3.</span> <span class="toc-text">é‚£äº›æ··åˆç¼–ç¨‹ä»¬</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PhoneGap-Cordova"><span class="toc-number">3.1.</span> <span class="toc-text">PhoneGap/Cordova</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SuperWebView"><span class="toc-number">3.2.</span> <span class="toc-text">SuperWebView</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SuperWebViewä¸­JSä¸Nativeé€šä¿¡çš„å®ç°åŸç†"><span class="toc-number">3.2.1.</span> <span class="toc-text">SuperWebViewä¸­JSä¸Nativeé€šä¿¡çš„å®ç°åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å…³äºSuperWebViewæ‰€æŒ‡çš„æ··åˆæ¸²æŸ“çš„è¯´æ˜"><span class="toc-number">3.2.2.</span> <span class="toc-text">å…³äºSuperWebViewæ‰€æŒ‡çš„æ··åˆæ¸²æŸ“çš„è¯´æ˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Runtime-amp-Native-js"><span class="toc-number">3.3.</span> <span class="toc-text">5+Runtime & Native.js</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Native-jsé€šä¿¡æ–¹å¼å®ç°åˆ†æ"><span class="toc-number">3.3.1.</span> <span class="toc-text">Native.jsé€šä¿¡æ–¹å¼å®ç°åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Titanium"><span class="toc-number">3.4.</span> <span class="toc-text">Titanium</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-Native"><span class="toc-number">3.5.</span> <span class="toc-text">React Native</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#React-Nativeé€šä¿¡æœºåˆ¶æºç åˆ†æ"><span class="toc-number">3.5.1.</span> <span class="toc-text">React Nativeé€šä¿¡æœºåˆ¶æºç åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ€§èƒ½æµ‹è¯•"><span class="toc-number">3.5.2.</span> <span class="toc-text">æ€§èƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#samurai-native"><span class="toc-number">3.6.</span> <span class="toc-text">samurai-native</span></a></li></ol></li></ol>
		
		</div>
		
		<p>æœ¬æ–‡ä¸»è¦ä»‹ç»ç¬”è€…å‰äº›æ—¥å­å¯¹å¸‚é¢ä¸Šä¸€äº›ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹æ–¹æ¡ˆçš„å®ç°æ–¹å¼ä¸Šçš„è°ƒç ”ï¼Œè¯»è€…å¯ä»¥æ®æ­¤äº†è§£ç§»åŠ¨ç«¯ç›®å‰å¸¸è§çš„ä¸€äº›æ··åˆå¼€å‘æ¡†æ¶çš„å®ç°åŸç†ï¼Œæ¬¢è¿è¯»è€…åœ¨æœ¬æ–‡åŸºç¡€ä¸Šåšæ›´æ·±å…¥çš„æ¢ç´¢å’Œè°ƒç ”ï¼Œå¦‚æœ‰çº°æ¼ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚<a id="more"></a></p>
<p>æœ¬æ–‡ç¤ºä¾‹ä»£ç é“¾æ¥: <a href="https://github.com/jackwee/hybrid-demos" target="_blank" rel="external">https://github.com/jackwee/hybrid-demos</a></p>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><ul>
<li><p>2008å¹´ï¼ŒHTML5å‘å¸ƒé¦–ä¸ªç‰ˆæœ¬ã€‚</p>
</li>
<li><p>2011å¹´ï¼ŒFacebookå¼€å±•<a href="http://techcrunch.com/2011/06/15/facebook-project-spartan/" target="_blank" rel="external">Spartan</a>é¡¹ç›®ï¼Œä¼å›¾ç”¨HTML5çš„æ€æƒ³æ­¦è£…è‡ªå·±ï¼Œå é¢†iOSçš„æµè§ˆå™¨ï¼Œä»¥æ­¤æ¥ä¸è‹¹æœæŠ—è¡¡ã€‚å› ä¸ºæµè§ˆå™¨æ˜¯ç›¸å¯¹å¼€æ”¾çš„ï¼ŒAppleæ€»ä¸å¯èƒ½åœ¨æµè§ˆå™¨ç«¯è®¾ç½®ä¸€ä¸ªå¼€å…³å¯¹ç½‘é¡µå†…å®¹è¿›è¡Œé™åˆ¶ã€‚</p>
</li>
<li><p>2012å¹´ï¼ŒMark Zuckerberg:â€the biggest mistake that we made as a company is betting too much on HTML5 as opposed to native.â€Facebookæ”¾å¼ƒHTML5ï¼Œè½¬æŠ•Nativeã€‚</p>
</li>
<li>2015å¹´ï¼ŒFacebookå‘å¸ƒreact-nativeã€‚</li>
</ul>
<p>å¦‚ä»Šï¼Œæ··åˆå¼€å‘çš„å‘¼å£°è¶Šæ¥è¶Šé«˜ï¼Œä¸–é¢ä¸Šä¹Ÿæœ‰å¾ˆå¤šæ··åˆå¼€å‘æ¡†æ¶ï¼Œé‡‡ç”¨æ··åˆå¼€å‘çš„åº”ç”¨ä¹Ÿæ˜¯è¶Šæ¥è¶Šå¤šã€‚</p>
<p>ä»¥ä¸‹å°†ä»ä»€ä¹ˆæ˜¯æ··åˆå¼€å‘ã€ä¸ºä»€ä¹ˆè¦åšæ··åˆå¼€å‘ã€ç§»åŠ¨ç«¯éƒ½åœ¨æ€ä¹ˆåšæ··åˆå¼€å‘æ¥åšé€æ­¥ä»‹ç»ã€‚</p>
<hr>
<font color="#CC0033" size="6px">What?</font>

<p>ä¸¤ç§æˆ–ä¸¤ç§ä»¥ä¸Šçš„ç¨‹åºè®¾è®¡è¯­è¨€çš„é‚‚é€…ã€‚</p>
<ul>
<li>JNI:Javaä¸C/C++çš„æ··åˆå¼€å‘</li>
<li>iOSä¸­Objective-Cä¸Cã€Swiftä¸Cçš„æ··åˆå¼€å‘</li>
<li>ReactNativeä¸­JavaScriptä¸Nativeè¯­è¨€çš„æ··åˆå¼€å‘</li>
</ul>
<p>æœ¬æ–‡ä»‹ç»å’Œè°ƒç ”çš„ä¸»è¦æ˜¯ç§»åŠ¨å¹³å°ä¸ŠWEB(WebViewã€JavaScript)ä¸Nativeè¯­è¨€çš„æ··åˆå¼€å‘ã€‚</p>
<font color="#CC0033" size="6px">Why?</font>

<h1 id="Web-amp-Native"><a href="#Web-amp-Native" class="headerlink" title="Web &amp; Native"></a>Web &amp; Native</h1><table>
<thead>
<tr>
<th style="text-align:center">å¯¹æ¯”</th>
<th style="text-align:center">Web</th>
<th style="text-align:center">Native</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ä¼˜åŠ¿</td>
<td style="text-align:center">è·¨å¹³å°ã€å¼€å‘æ•ˆç‡é«˜ã€æ–¹ä¾¿è°ƒè¯•ã€æ–¹ä¾¿éƒ¨ç½²</td>
<td style="text-align:center">æ€§èƒ½ä½“éªŒå¥½ã€è®¿é—®Low APIã€å¼ºå¤§çš„IDEã€åŸç”Ÿçš„åŠ¨ç”»ã€ç³»ç»Ÿæ‰‹åŠ¿</td>
</tr>
<tr>
<td style="text-align:center">å­˜åœ¨é—®é¢˜</td>
<td style="text-align:center">æ€§èƒ½é—®é¢˜ã€æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ã€è®¿é—®Low APIå—é™ã€éœ€è¦æ¨¡æ‹ŸåŸç”ŸåŠ¨ç”»å’Œæ‰‹åŠ¿</td>
<td style="text-align:center">å¹³å°ä¾èµ–æ€§å¼ºã€è°ƒè¯•ä¸ä¾¿ã€åº”ç”¨æ›´æ–°å‘¨æœŸé•¿ã€å¼€å‘æ•ˆç‡ä½</td>
</tr>
</tbody>
</table>
<p>æ··åˆç¼–ç¨‹å°±æ˜¯ä¸ºäº†å°†ä¸¤è€…çš„ä¼˜ç‚¹ç»“åˆèµ·æ¥ï¼Œåšåˆ°â€œå…¼å¾—ğŸŸå’ŒğŸ»ğŸ‘â€ã€‚</p>
<font color="#CC0033" size="6px">How?</font>

<h1 id="é‚£äº›æ··åˆç¼–ç¨‹ä»¬"><a href="#é‚£äº›æ··åˆç¼–ç¨‹ä»¬" class="headerlink" title="é‚£äº›æ··åˆç¼–ç¨‹ä»¬"></a>é‚£äº›æ··åˆç¼–ç¨‹ä»¬</h1><p>ç›®å‰ç§»åŠ¨ç«¯ä¸»æµçš„æ··åˆå¼€å‘æœ‰ä¸¤ä¸ªæµæ´¾ï¼Œä¸€ä¸ªæ˜¯åŸºäºWebViewåšæ··åˆå¼€å‘çš„Hybridæµæ´¾ï¼Œä¸€ä¸ªæ˜¯åŸºäºè™šæ‹Ÿæœºåšæ··åˆå¼€å‘çš„â€™JavaSciptBridgeâ€™æµæ´¾ã€‚</p>
<ol>
<li>WebViewBridgeæµæ´¾(Hybridæµæ´¾):åŸºäºWebViewåšä¸Nativeè¯­è¨€çš„æ··åˆå¼€å‘<ul>
<li><a href="http://phonegap.com/" target="_blank" rel="external">PhoneGap</a> / <a href="https://cordova.apache.org" target="_blank" rel="external">Cordova</a></li>
<li><a href="http://www.apicloud.com/superwebview" target="_blank" rel="external">SuperWebView</a></li>
<li><a href="http://dcloud.io/runtime.html#toDownload" target="_blank" rel="external">5+Runtime &amp; Native.js</a></li>
</ul>
</li>
<li>â€˜JavaScipt Bridgeâ€™æµæ´¾(JSBinding,LuaBinding,è‡ªå®šä¹‰æ¶ˆæ¯ä¼ é€’):åŸºäºè„šæœ¬è¯­è¨€æœ¬èº«åšä¸Nativeè¯­è¨€çš„æ··åˆå¼€å‘<ul>
<li><a href="http://www.appcelerator.com/mobile-app-development-products/" target="_blank" rel="external">Titanium</a></li>
<li><a href="https://facebook.github.io/react-native/" target="_blank" rel="external">ReactNative</a></li>
<li><a href="https://github.com/hackers-painters/samurai-native" target="_blank" rel="external">samurai-native</a></li>
</ul>
</li>
</ol>
<p>å¦å¤–ï¼Œè¿˜æœ‰ç¿»è¯‘æµæ´¾ï¼Œå¦‚<a href="http://j2objc.org/" target="_blank" rel="external">J2ObjC</a>å°†Javaè¯­è¨€ç¿»è¯‘æˆObjective-Cï¼Œç¼–è¯‘æµæ´¾ï¼Œå¦‚<a href="http://xamarin.com/" target="_blank" rel="external">Xamarin</a>ç›´æ¥C#ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶æ¥å¼€å‘iOSåº”ç”¨ï¼Œè¿™ä¸¤ç§åšæ³•ç›¸å¯¹æ¯”è¾ƒå°ä¼—ï¼Œæœ¬æ–‡å¹¶ä¸åšæ¢è®¨ã€‚</p>
<h2 id="PhoneGap-Cordova"><a href="#PhoneGap-Cordova" class="headerlink" title="PhoneGap/Cordova"></a>PhoneGap/Cordova</h2><p><code>PhoneGap: &quot;Write Once, Run Anywhere&quot;ã€‚</code></p>
<p>ç›®æ ‡æ˜¯è®©ä½¿ç”¨è€…ç¼–å†™ä¸€å¥—ä»£ç æ¥å®ç°è·¨å¹³å°æ“ä½œï¼Œå®ƒæ˜¯HybridæŠ€æœ¯çš„ä¸€ç§å®ç°ï¼Œèµ‹äºˆWebViewè®¿é—®Native APIçš„èƒ½åŠ›ï¼Œå±è”½æ‰å¹³å°ç›¸å…³APIå®ç°è·¨å¹³å°å¼€å‘ã€‚</p>
<p><img src="ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/Cordova.png" alt=""></p>
<p>ä¸Šå›¾æ˜¯Cordovaçš„æ¶æ„å›¾ï¼Œå…¶ä¸­Web Appéƒ¨åˆ†æ˜¯å‰ç«¯å¼€å‘éƒ¨åˆ†ï¼Œåœ¨WebViewä¸Šæ‰§è¡Œã€‚Cordova Pluginsæ˜¯Cordovaæ‰€æä¾›çš„ç”¨äºè®¿é—®æœ¬åœ°ä»£ç çš„æ’ä»¶ï¼Œè¿™äº›æ’ä»¶å…·æœ‰æ“ä½œæœ¬åœ°èµ„æºçš„èƒ½åŠ›ï¼Œå¦‚å®šä½ã€é™€èºä»ªã€ç›¸æœºã€è”ç³»äººç­‰ç­‰ï¼Œæ­¤å¤–ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ’ä»¶ï¼Œjsä»£ç éƒ¨åˆ†å¯ä»¥é€šè¿‡Cordova Native APIsæ¥è®¿é—®è¿™äº›æ’ä»¶ã€‚é‚£ä¹ˆè¿™é‡Œå¯¹æ’ä»¶çš„è°ƒç”¨å®é™…æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</p>
<p>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„demoè¿›è¡Œæµ‹è¯•ã€‚</p>
<p>Nativeç«¯å®šä¹‰äº†è‡ªå®šä¹‰æ’ä»¶MyHybridPluginï¼Œå…¶ä¸­å®šä¹‰äº†addBookmarkæ–¹æ³•ï¼Œåœ¨htmlé¡µé¢ä¸Šç‚¹å‡»æŒ‰é’®ï¼Œæˆ‘ä»¬é€šè¿‡cordovaè°ƒç”¨addBookmarkã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">(1)html</div><div class="line">//é¡µé¢ä¸Šæ·»åŠ ç‚¹å‡»äº‹ä»¶å¤„ç†</div><div class="line">&lt;button id=&quot;bookmarkBtn&quot; onclick=&quot;app.addBookmark()&quot;&gt;Add a bookmark&lt;/button&gt;</div><div class="line"></div><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;cordova.js&quot;&gt;&lt;/script&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/index.js&quot;&gt;&lt;/script&gt;</div><div class="line"></div><div class="line">(2)JavaScript(index.js)</div><div class="line">var app = &#123;</div><div class="line">    addBookmark: function() &#123;</div><div class="line">        ...</div><div class="line">        cordova.exec(win, fail, &quot;MyHybridPlugin&quot;, &quot;addBookmark&quot;, [bookmark]);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;;</div><div class="line"></div><div class="line">(3)JavaScript(cordova.js)</div><div class="line">//æ·»åŠ æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—</div><div class="line">commandQueue.push(JSON.stringify(command));</div><div class="line"></div><div class="line">(4)JavaScript(cordova.js)</div><div class="line">//é€šè¿‡iframeé€šçŸ¥native</div><div class="line">pokeNativeViaIframe();</div><div class="line"></div><div class="line">===&gt;</div><div class="line">execIframe = document.createElement(&apos;iframe&apos;);</div><div class="line">execIframe.style.display = &apos;none&apos;;</div><div class="line">execIframe.src = &apos;gap://ready&apos;;</div><div class="line">document.body.appendChild(execIframe);   </div><div class="line"></div><div class="line">(5)Objective-C</div><div class="line">//ä»jsæ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ¶ˆæ¯å†…å®¹</div><div class="line">webView:shouldStartLoadWithRequest:navigationType:</div><div class="line">[_commandQueue fetchCommandsFromJs];</div><div class="line"></div><div class="line">(6)JavaScript(cordova.js)</div><div class="line">//ä»¥jsonæ–¹å¼è¿”å›æ¶ˆæ¯å†…å®¹ï¼ŒåŒ…æ‹¬callbackId</div><div class="line">nativeFetchMessages();</div><div class="line"> </div><div class="line">(7)Objective-C</div><div class="line">//æ ¹æ®jsonå†…å®¹æŸ¥æ‰¾å¯¹åº”çš„classå’Œselectorï¼Œå¹¶æ‰§è¡Œç›¸åº”æ–¹æ³•</div><div class="line">- (BOOL)execute:(CDVInvokedUrlCommand*)command</div><div class="line"></div><div class="line">(8)Objective-C</div><div class="line">//å›è°ƒæ‰§è¡Œç»“æœï¼Œå¸¦ä¸ŠcallbackId</div><div class="line">sendPluginResult:callbackId:</div><div class="line"></div><div class="line">(9)JavaScript(cordova.js)</div><div class="line">//æ ¹æ®callbackIdå›è°ƒæ‰§è¡Œç»“æœ</div><div class="line">iOSExec.nativeCallback();</div></pre></td></tr></table></figure>
<p>é€šè¿‡è°ƒè¯•å‘ç°ï¼Œcordovaæ˜¯é€šè¿‡å°†jså¯¹nativeçš„æ–¹æ³•è°ƒç”¨ä¿¡æ¯ï¼Œå°è£…æˆä¸€ä¸ªUILï¼Œå¹¶é€šè¿‡iframeçš„å½¢å¼åŠ è½½è¯¥urlã€‚nativeç«¯é€šè¿‡UIWebViewDelegateçš„ä»£ç†æ–¹æ³•<code>webView:shouldStartLoadWithRequest:navigationType:</code>æ‹¦æˆªurlï¼Œå¹¶è§£æå‡ºå…¶ä¸­çš„å‡½æ•°ç­¾åä¿¡æ¯ï¼Œé€šè¿‡ocçš„runtimeæŸ¥æ‰¾å¯¹åº”çš„ç±»å’Œæ–¹æ³•ï¼Œå®ç°äº†æœ¬åœ°æ–¹æ³•è°ƒç”¨ï¼Œå¹¶è¿”å›æœ¬æ¬¡è°ƒç”¨å¯¹åº”çš„callbackIdï¼Œcordovaä¼šæ ¹æ®è¯¥idæŸ¥æ‰¾åˆ°å¯¹åº”çš„jså›è°ƒæ–¹æ³•ï¼Œå®ç°å›è°ƒç»™jsã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>è·¨å¹³å°</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>æ€§èƒ½é—®é¢˜ï¼šä»ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹å‡ºjsåˆ°nativeçš„è°ƒç”¨æµç¨‹æ¯”è¾ƒç¹ç</li>
<li>å¯¹nativeå·¥ç¨‹å¸ˆçš„ä¾èµ–ï¼šå‰ç«¯å·¥ç¨‹å¸ˆéœ€è¦nativeå¼€å‘æ¥æä¾›æ‰€éœ€æ’ä»¶</li>
</ul>
<h2 id="SuperWebView"><a href="#SuperWebView" class="headerlink" title="SuperWebView"></a>SuperWebView</h2><p><code>SuperWebView:èƒ½å¤Ÿå¸®åŠ©åŸç”ŸAPPå›¢é˜Ÿè§£å†³â€œå¦‚ä½•åœ¨çŸ­æ—¶é—´å†…å¼€å‘å‡ºä½“éªŒå¥½ã€åŠŸèƒ½å¼ºçš„HTML5é¡µé¢â€çš„é—®é¢˜</code></p>
<p>SuperWebViewä¸ºwebç¨‹åºå‘˜å¼€å‘Appæä¾›ä¸€å¥—æ•´ä½“çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥SDKçš„æ–¹å¼æä¾›ä½¿ç”¨ï¼ˆä¸å¼€æºï¼‰ï¼Œæ€»ç»“ä¸€ä¸‹ä¸»è¦åŒ…æ‹¬ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ç®¡ç†å¹³å°æä¾›ä¸Šç™¾ç§æ¨¡å—ï¼Œå¹³å°å¯ä»¥æ ¹æ®ç”¨æˆ·é€‰å–ç»„åˆçš„æ¨¡å—æ„å»ºç”ŸæˆSDKï¼Œå¼€å‘è€…ä¸‹è½½ä½¿ç”¨æ”¾åˆ°é¡¹ç›®ä¸­ä½¿ç”¨</li>
<li>æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ¨¡å—ï¼Œå¯¼å‡ºç»™jsä½¿ç”¨ï¼Œéœ€è¦æ„å»ºé™æ€åº“ï¼Œå¹¶æ‰“åŒ…æˆzipä¸Šä¼ åˆ°ç®¡ç†å¹³å°ï¼Œç”±å¹³å°ç¼–è¯‘ç”Ÿæˆsdk</li>
<li>åˆ©ç”¨ç®¡ç†å¹³å°ï¼Œå¯ä»¥è¿›è¡Œèµ„æºåŒ…çš„çƒ­æ›´æ–°</li>
<li>ç³»ç»ŸAPIå¯¹è±¡æä¾›çš„JSæ¥å£ï¼Œå¯ä»¥åœ¨ä½¿ç”¨JSè¿›è¡Œä»¥ä¸‹æ“ä½œï¼šè·å–ç³»ç»Ÿå±æ€§ã€ç³»ç»Ÿäº‹ä»¶ã€ä½¿ç”¨è¿›è¡Œå°è£…äº†çš„æ¥å£</li>
<li>æä¾›äº‘APIæ¥è¿›è¡Œï¼šæ“ä½œäº‘ç«¯æ•°æ®ã€ç»Ÿè®¡ã€æ¨é€ã€çŸ­ä¿¡éªŒè¯ç­‰åŠŸèƒ½</li>
<li>æä¾›ä¸è…¾è®¯X5æµè§ˆå™¨çš„é›†æˆï¼ˆAndroidï¼‰</li>
</ul>
<p>ä¸‹é¢æ˜¯SuperWebViewçš„æ¶æ„å›¾ï¼š</p>
<p><img src="ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/superwebview.png" alt=""></p>
<p>å…ˆçœ‹å³ä¾§éƒ¨åˆ†ï¼Œä¸Šé¢æ˜¯SuperWebViewæä¾›çš„é¡µé¢ç»„ç»‡ç»“æ„ï¼Œç”¨æˆ·å¯ä»¥åˆ©ç”¨APIå¯¹è±¡æä¾›çš„æ¥å£åˆ›å»ºç•Œé¢ï¼Œç”¨æˆ·å¯ä»¥åˆ›å»ºwindowï¼ˆæ•´ä¸ªç•Œé¢ï¼‰ï¼Œframeï¼ˆç•Œé¢ä¸­çš„æ¨¡å—ç•Œé¢ï¼‰ï¼ŒframeGroupï¼ˆä¸€ç»„å¯ä»¥å·¦å³æ»‘åŠ¨æµè§ˆçš„ç•Œé¢ï¼‰ï¼ŒUIModuleï¼ˆnativeè‡ªå®šä¹‰è§†å›¾ï¼‰ï¼›å³ä¾§ä¸‹é¢éƒ¨åˆ†æ˜¯SuperWebViewæä¾›çš„åŸºç¡€æœåŠ¡ï¼Œå¹¶æä¾›äº†ä¸Nativeé€šä¿¡çš„æœºåˆ¶ï¼›å·¦ä¾§éƒ¨åˆ†æ˜¯SuperWebViewå¹³å°å·²æ¨¡å—çš„å½¢å¼æä¾›çš„å¯ä»¥ä¾›JSä½¿ç”¨çš„Nativeæ¨¡å—å•å…ƒï¼Œå®˜ç½‘ä¸Šæœ‰æ¨¡å—ç®¡ç†å¹³å°æä¾›äº†æ¨¡å—å¯ä»¥ä¾›å¼€å‘è€…ä½¿ç”¨ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥æ ¹æ®å¹³å°æ ‡å‡†è‡ªå®šä¹‰æ¨¡å—ã€‚</p>
<p>ä¸‹é¢æ˜¯ä½¿ç”¨SuperWebViewå®ç°çš„æ¨¡æ‹Ÿç½‘æ˜“äº‘éŸ³ä¹çš„ä¸€ä¸ªdemoç¤ºä¾‹ï¼š</p>
<p><img src="ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/superwebview.gif" alt=""></p>
<p>ä¸»é¡µé¢çš„å±‚çº§ç»“æ„ï¼š</p>
<p><img src="ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/superwebview2.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåº”ç”¨ç•Œé¢å¯ä»¥ç”±å¤šä¸ªAPIWebViewä¸UIViewï¼ˆæˆ–å…¶å­ç±»ï¼‰ç»„åˆè€Œæ¥ï¼Œä½†æ˜¯è¿™äº›ç»„åˆå…³ç³»å¹¶ä¸éœ€è¦webç«¯å¼€å‘è€…æ¥æ“å¿ƒï¼Œå¯ä»¥å€ŸåŠ©å¹³å°apiå¯¹è±¡å¼€æ”¾çš„æ¥å£è°ƒç”¨ï¼Œå¹³å°æ¥å£ä¼šæ„å»ºå‡ºç›¸åº”ç•Œé¢çš„çš„ç»„åˆï¼Œä¾‹å¦‚,å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™æ ·çš„æ–¹å¼æ‰“å¼€ä¸€ä¸ªå¯ä»¥å·¦å³æ»‘åŠ¨çš„å¤šä¸ªé¡µé¢ç»„åˆè€Œæˆçš„é¡µé¢ï¼Œå…¶æ„å»ºçš„ç•Œé¢ç»“æœå°±æ˜¯UIScrollViewä¸­æ¨ªå‘æ”¾ç½®äº†å››ä¸ªé¡µé¢ï¼Œå¯ä»¥å·¦å³æ»‘åŠ¨ç¿»é¡µæµè§ˆã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">api.openFrameGroup(&#123;</div><div class="line">        name: &apos;framegroup01&apos;,</div><div class="line">        background: &apos;#FFF&apos;,</div><div class="line">        scrollEnabled: true,</div><div class="line">        rect: &#123;</div><div class="line">            x: 0,</div><div class="line">            y: firstHeaderOffset.h + firstHeaderIndexHeight,</div><div class="line">            w: &quot;auto&quot;,</div><div class="line">            h: api.frameHeight - firstHeaderOffset.h - firstHeaderIndexHeight - footerPos.h</div><div class="line">        &#125;,</div><div class="line">        index: 0,</div><div class="line">        frames: [&#123;</div><div class="line">            name: &apos;frame01_recommand&apos;,</div><div class="line">            url: &apos;./html/first_frame/frame01_recommand.html&apos;,</div><div class="line">            bounces: false,</div><div class="line">        &#125;, &#123;</div><div class="line">            name: &apos;frame01_list&apos;,</div><div class="line">            url: &apos;./html/first_frame/frame01_list.html&apos;,</div><div class="line">            bounces: true,</div><div class="line">        &#125;, &#123;</div><div class="line">            name: &apos;frame01_radio&apos;,</div><div class="line">            url: &apos;./html/first_frame/frame01_radio.html&apos;,</div><div class="line">            bounces: false,</div><div class="line">        &#125;, &#123;</div><div class="line">            name: &apos;frame01_rank&apos;,</div><div class="line">            url: &apos;./html/first_frame/frame01_rank.html&apos;,</div><div class="line">            bounces: false,</div><div class="line">        &#125;]</div><div class="line">    &#125;, function(ret) &#123;</div><div class="line">        setFrameGroupStatus(ret.index);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹APIWebViewçš„çœŸé¢ç›®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@interface APIWebView : UZWebView</div><div class="line">@interface UZWebView : UIWebView</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒAPIWebViewå®é™…æ˜¯UIWebViewçš„å­ç±»ï¼Œæ•´ä¸ªé¡µé¢ç»“æ„ä½¿ç”¨APIWebViewåµŒå¥—çš„æ–¹å¼æ„å»ºã€‚</p>
<ul>
<li>é€šè¿‡Instrumentsåœ¨iPhone5sä¸Šè¿›è¡Œå†…å­˜æµ‹è¯•ï¼Œå¯¹å‰é¢äº‘éŸ³ä¹demoåå¤æ“ä½œï¼Œç´¯è®¡åˆ›å»º11ä¸ªAPIWebViewï¼Œå†…å­˜å¼€é”€åœ¨35Må·¦å³(åˆ›å»º11ä¸ªUIWebViewï¼Œå¹¶åŠ è½½æœ¬åœ°ç±»ä¼¼é™æ€é¡µé¢å†…å­˜å¼€é”€åœ¨24Må·¦å³)ã€‚</li>
<li>é€šè¿‡å¯¹APIWebViewçš„æ„é€ æ–¹æ³•initWithFrame:å’Œdeallocæ–¹æ³•è¿›è¡Œæ‹¦æˆªï¼Œå‘ç°åœ¨æ‰“å¼€æ–°é¡µé¢æ˜¯é€šè¿‡[UZWebViewController loadWindow]å’Œ[UZWebViewController openFrame:]åˆ›å»ºå¤šä¸ªAPIWebViewï¼Œå†ç»“åˆNativeæ§ä»¶ï¼Œæ„å»ºå‡ºé¡µé¢ã€‚</li>
</ul>
<p>SuperWebViewçš„ç”¨æˆ·é€šè¿‡å¯¹é¡µé¢ç»“æ„è¿›è¡Œæ‹†åˆ†ï¼Œåˆ©ç”¨SuperWebViewæä¾›çš„APIæ¥æ„å»ºé¡µé¢ï¼ŒSuperWebViewæ‰€æä¾›çš„APIä¼šæ„å»ºå‡ºç›¸åº”çš„é¡µé¢ç»“æ„ï¼Œä¾‹å¦‚ä¸Šé¢äº‘éŸ³ä¹demoä¸­çš„é¦–é¡µé¢ï¼Œå°±æ˜¯ç”±2ä¸ªAPIWebViewå’Œä¸€ä¸ªUIScrollViewåµŒå¥—ç»„åˆè€Œæˆã€‚è‡³äºç•Œé¢çš„æ ·å¼ï¼Œéœ€è¦ç”¨æˆ·ç”¨HTML+CSSè¿›è¡Œæè¿°ã€‚</p>
<h3 id="SuperWebViewä¸­JSä¸Nativeé€šä¿¡çš„å®ç°åŸç†"><a href="#SuperWebViewä¸­JSä¸Nativeé€šä¿¡çš„å®ç°åŸç†" class="headerlink" title="SuperWebViewä¸­JSä¸Nativeé€šä¿¡çš„å®ç°åŸç†"></a>SuperWebViewä¸­JSä¸Nativeé€šä¿¡çš„å®ç°åŸç†</h3><p>ä¸‹é¢åˆ†æä¸‹SuperWebViewçš„å®ç°JSä¸Nativeçš„é€šä¿¡æœºåˆ¶ã€‚</p>
<p>æµ‹è¯•ç¯å¢ƒï¼šiPhone5S,iOS8.3å’ŒiPhone4S,iOS7.1.1</p>
<p>æˆ‘ä»¬åœ¨JSç«¯è°ƒç”¨<code>alert(&quot;alert from js&quot;);</code>æ¥å£ï¼Œåˆ©ç”¨è¿œç¨‹è°ƒè¯•è¿›è¡Œæ–­ç‚¹è·Ÿè¸ªã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//alertçš„å®ç°</div><div class="line">function (msg) &#123;</div><div class="line">	!function(msg)&#123;</div><div class="line">		if(msg===null)&#123;</div><div class="line">			msg=&apos;null&apos;</div><div class="line">		&#125;;</div><div class="line">		if(msg===undefined)&#123;</div><div class="line">			msg=&apos;undefined&apos;</div><div class="line">		&#125;;</div><div class="line">		msg=msg.toString();</div><div class="line">		api.alert(&#123;title:&apos;index.html&apos;,msg:msg,buttons:[&apos;å¥½&apos;]&#125;);</div><div class="line">	&#125;(msg);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//api.alertçš„å®ç°</div><div class="line">function () &#123;</div><div class="line">	return uz$e(&apos;UZAPI&apos;,&apos;alert&apos;,arguments,false,&apos;api&apos;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">///uz$eçš„å®ç°</div><div class="line">function uz$e(c, m, p, isSync, module) &#123;</div><div class="line">    var param = &#123;&#125;;</div><div class="line">    </div><div class="line">    //(1)</div><div class="line">    if (p.length === 1) &#123;</div><div class="line">        var p0 = p[0];</div><div class="line">       //(1.1)</div><div class="line">		if (Object.prototype.toString.call(p0) === &quot;[object Object]&quot;) &#123;</div><div class="line">            param = p0;</div><div class="line">        &#125; else if (typeof p0 === &quot;function&quot;) &#123;</div><div class="line">            param.cbId = uz$cb.id++;</div><div class="line">            uz$cb.fn[param.cbId] = p0;</div><div class="line">        &#125;</div><div class="line">    &#125; else if (p.length === 2) &#123;</div><div class="line">    	//(1.2)</div><div class="line">        var p0 = p[0];</div><div class="line">        var p1 = p[1];</div><div class="line">        if (Object.prototype.toString.call(p0) === &quot;[object Object]&quot;) &#123;</div><div class="line">            param = p0;</div><div class="line">        &#125;</div><div class="line">        if (typeof p1 === &quot;function&quot;) &#123;</div><div class="line">            param.cbId = uz$cb.id++;</div><div class="line">            uz$cb.fn[param.cbId] = p1;</div><div class="line">        &#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	//ï¼ˆ2ï¼‰</div><div class="line">    if (typeof(_apiBridgeMethod)===&apos;function&apos;)&#123;</div><div class="line">    	 //(2.1)	</div><div class="line">        return _apiBridgeMethod(c, m, param, isSync, module);</div><div class="line">    &#125; else if (api.useWKWebView) &#123;</div><div class="line">    	 //(2.2)	</div><div class="line">        var message = &#123;&#125;;</div><div class="line">        message.class = c;</div><div class="line">        message.method = m;</div><div class="line">        message.param = param;</div><div class="line">        message.isSync = false;</div><div class="line">        message.module = module;</div><div class="line">        window.webkit.messageHandlers.api.postMessage(message);</div><div class="line">    &#125; else &#123;</div><div class="line">    	 //(2.3)	</div><div class="line">        uz$q.c.push(module+&apos;.&apos;+c+&apos;.&apos;+m+&apos;/?&apos;+encodeURIComponent(JSON.stringify(param)));</div><div class="line">        uz$r();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯¹è¿™æ®µä»£ç è¿›è¡Œåˆ†æï¼š</p>
<p>ï¼ˆ1ï¼‰å¯¹å‚æ•°è¿›è¡Œå¤„ç†</p>
<p>(1.1) åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¯¹è°ƒç”¨å‚æ•°æˆ–è€…å›è°ƒå‡½æ•°åˆ†åˆ«å¤„ç†</p>
<p>(1.2) æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå¯¹è°ƒç”¨å‚æ•°å’Œå›è°ƒå‡½æ•°åˆ†åˆ«å¤„ç†</p>
<p>ï¼ˆ2ï¼‰æ‰§è¡Œå‡½æ•°è°ƒç”¨</p>
<p>(2.1) è°ƒç”¨_apiBridgeMethodæ–¹æ³•ï¼Œåœ¨å½“å‰æµ‹è¯•ç¯å¢ƒä¸‹ï¼Œä¼šèµ°2.1çš„é€»è¾‘ï¼Œå…¶å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">function () &#123;</div><div class="line">    [native code]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°_apiBridgeMethodçš„æ–¹æ³•ä½“æ˜¯native codeï¼Œé‚£ä¹ˆæ˜¯å¦‚ä½•å°†native codeæ³¨å†Œç»™WebViewçš„JSè§£é‡Šå™¨çš„å‘¢ï¼Ÿ</p>
<p>å°†APICloud.aä¸­çš„UZWebView.oåç¼–è¯‘å‡ºæ¥ä¼ªä»£ç çœ‹åˆ°å¦‚ä¸‹å®ç°:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div></pre></td><td class="code"><pre><div class="line">// UZWebView - (void)initJavaScriptCoreBridgeMethod</div><div class="line">void __cdecl -[UZWebView initJavaScriptCoreBridgeMethod](struct UZWebView *self, SEL a2)</div><div class="line">&#123;</div><div class="line">  struct UZWebView *v7; // r8@1</div><div class="line">  void *v8; // r0@1</div><div class="line">  void *v9; // r5@1</div><div class="line">  void *v10; // r0@1</div><div class="line">  void *v11; // r6@1</div><div class="line">  void *v13; // r0@2</div><div class="line">  void *v14; // r6@2</div><div class="line">  void *v15; // r0@2</div><div class="line">  int v16; // r4@2</div><div class="line">  void *v17; // r0@2</div><div class="line">  void *v18; // r5@2</div><div class="line">  int *v19; // r4@3</div><div class="line">  int v23; // [sp+0h] [bp-78h]@1</div><div class="line">  void *v24; // [sp+4h] [bp-74h]@3</div><div class="line">  void *v25; // [sp+8h] [bp-70h]@3</div><div class="line">  void *v26; // [sp+Ch] [bp-6Ch]@3</div><div class="line">  int v27; // [sp+10h] [bp-68h]@3</div><div class="line">  int v28; // [sp+14h] [bp-64h]@3</div><div class="line">  int (__fastcall *v29)(__block_literal_3 *, Foundation::NSString::NSString *, Foundation::NSString::NSString *, Foundation::NSDictionary::NSDictionary *, Foundation::NSString::NSString *, int); // [sp+18h] [bp-60h]@3</div><div class="line">  void *v30; // [sp+1Ch] [bp-5Ch]@3</div><div class="line">  int v31; // [sp+20h] [bp-58h]@1</div><div class="line">  char v32; // [sp+24h] [bp-54h]@3</div><div class="line">  int *v33; // [sp+28h] [bp-50h]@3</div><div class="line">  char v34; // [sp+2Ch] [bp-4Ch]@1</div><div class="line">  int v35; // [sp+30h] [bp-48h]@2</div><div class="line">  void *v36; // [sp+44h] [bp-34h]@1</div><div class="line">  void *v37; // [sp+48h] [bp-30h]@1</div><div class="line">  __int64 *v38; // [sp+4Ch] [bp-2Ch]@1</div><div class="line">  unsigned int v39; // [sp+50h] [bp-28h]@1</div><div class="line">  int *v40; // [sp+54h] [bp-24h]@1</div><div class="line">  char v41; // [sp+60h] [bp-18h]@5</div><div class="line">  __int64 savedregs; // [sp+78h] [bp+0h]@1</div><div class="line"></div><div class="line">  _R4 = (unsigned int)&amp;v31 &amp; 0xFFFFFFF0;</div><div class="line">  __asm</div><div class="line">  &#123;</div><div class="line">    VST1.64         &#123;D8-D11&#125;, [R4@128]!</div><div class="line">    VST1.64         &#123;D12-D15&#125;, [R4@128]</div><div class="line">  &#125;</div><div class="line">  v7 = self;</div><div class="line">  v8 = objc_msgSend(&amp;OBJC_CLASS___UIDevice, &quot;currentDevice&quot;);</div><div class="line">  v9 = (void *)objc_retainAutoreleasedReturnValue(v8);</div><div class="line">  v10 = objc_msgSend(v9, &quot;systemVersion&quot;);</div><div class="line">  v11 = (void *)objc_retainAutoreleasedReturnValue(v10);</div><div class="line">  _R4 = objc_msgSend(v11, &quot;floatValue&quot;);</div><div class="line">  objc_release(v11);</div><div class="line">  objc_release(v9);</div><div class="line">  v36 = &amp;__objc_personality_v0;</div><div class="line">  v37 = &amp;GCC_except_table117;</div><div class="line">  v38 = &amp;savedregs;</div><div class="line">  v40 = &amp;v23;</div><div class="line">  v39 = (((unsigned int)&amp;loc_13E + 2) | 1) + 42164;</div><div class="line">  _Unwind_SjLj_Register(&amp;v34);</div><div class="line">  __asm</div><div class="line">  &#123;</div><div class="line">    VMOV.F32        D0, #7.0</div><div class="line">    VMOV            D1, R4, R4</div><div class="line">    VCMPE.F32       S2, S0</div><div class="line">    VMRS            APSR_nzcv, FPSCR</div><div class="line">  &#125;</div><div class="line">  if ( !(_NF ^ _VF) )</div><div class="line">  &#123;</div><div class="line">    v35 = -1;</div><div class="line">    v13 = objc_msgSend(v7, &quot;webView&quot;);</div><div class="line">    v35 = -1;</div><div class="line">    v14 = (void *)objc_retainAutoreleasedReturnValue(v13);</div><div class="line">    v35 = -1;</div><div class="line">    v15 = objc_msgSend(v7, &quot;jsContextKeyPath&quot;);</div><div class="line">    v35 = -1;</div><div class="line">    v16 = objc_retainAutoreleasedReturnValue(v15);</div><div class="line">    v35 = -1;</div><div class="line">    v17 = objc_msgSend(v14, &quot;valueForKeyPath:&quot;, v16);</div><div class="line">    v35 = -1;</div><div class="line">    v18 = (void *)objc_retainAutoreleasedReturnValue(v17);</div><div class="line">    objc_release(v16);</div><div class="line">    if ( v18 )</div><div class="line">    &#123;</div><div class="line">      v25 = v14;</div><div class="line">      objc_initWeak(&amp;v32, v7);</div><div class="line">      v26 = &amp;_NSConcreteStackBlock;</div><div class="line">      v27 = -1040187392;</div><div class="line">      v28 = 0;</div><div class="line">      v29 = _43__UZWebView_initJavaScriptCoreBridgeMethod__block_invoke;</div><div class="line">      v33 = &amp;v31;</div><div class="line">      v30 = &amp;__block_descriptor_tmp_1135;</div><div class="line">      objc_copyWeak(&amp;v31, &amp;v32);</div><div class="line">      v23 = objc_retainBlock(&amp;v26);</div><div class="line">      v35 = 1;</div><div class="line">      v24 = v18;</div><div class="line">      objc_msgSend(v18, &quot;setObject:forKeyedSubscript:&quot;);</div><div class="line">      v19 = v33;</div><div class="line">      objc_release(v23);</div><div class="line">      objc_destroyWeak(v19);</div><div class="line">      objc_destroyWeak(&amp;v32);</div><div class="line">      v14 = v25;</div><div class="line">      v18 = v24;</div><div class="line">    &#125;</div><div class="line">    objc_release(v18);</div><div class="line">    objc_release(v14);</div><div class="line">  &#125;</div><div class="line">  _Unwind_SjLj_Unregister(&amp;v34);</div><div class="line">  _R4 = &amp;v41;</div><div class="line">  __asm</div><div class="line">  &#123;</div><div class="line">    VLD1.64         &#123;D8-D11&#125;, [R4@128]!</div><div class="line">    VLD1.64         &#123;D12-D15&#125;, [R4@128]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆæ˜¯åˆ©ç”¨KVCä»UZWebViewè·å¾—JSContextï¼Œç„¶åsetObject:forKeyedSubscript:è®¾ç½®_apiBridgeMethodçš„å€¼ä¸º<code>_43__UZWebView_initJavaScriptCoreBridgeMethod__block_invoke</code>ï¼Œå®ƒçš„å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">int __fastcall _43__UZWebView_initJavaScriptCoreBridgeMethod__block_invoke(</div><div class="line">__block_literal_3 *.block_descriptor, </div><div class="line">Foundation::NSString::NSString *a2, </div><div class="line">Foundation::NSString::NSString *method, </div><div class="line">Foundation::NSDictionary::NSDictionary *param, </div><div class="line">Foundation::NSString::NSString *module, </div><div class="line">int a6)</div><div class="line">&#123;</div><div class="line">  Foundation::NSDictionary::NSDictionary *v7; // r5@1</div><div class="line">  Foundation::NSString::NSString *v8; // r4@1</div><div class="line">  int v9; // r10@1</div><div class="line">  int v10; // r4@1</div><div class="line">  void *v11; // r8@1</div><div class="line">  int v12; // r11@1</div><div class="line">  void *v13; // r2@1</div><div class="line">  int v14; // r0@2</div><div class="line">  void *v15; // r0@3</div><div class="line">  void *v16; // ST04_4@4</div><div class="line">  int v17; // r5@4</div><div class="line">  void *v18; // r0@4</div><div class="line">  void *v19; // r8@4</div><div class="line">  void *v20; // r4@4</div><div class="line">  void *v21; // r0@4</div><div class="line">  int v22; // r6@4</div><div class="line">  __block_literal_3 *v24; // [sp+8h] [bp-20h]@1</div><div class="line"></div><div class="line">  v24 = .block_descriptor;</div><div class="line">  v7 = param;</div><div class="line">  v8 = method;</div><div class="line">  v9 = objc_retain(a2);</div><div class="line">  v10 = objc_retain(v8);</div><div class="line">  v11 = (void *)objc_retain(v7);</div><div class="line">  v12 = objc_retain(a6);</div><div class="line">  v13 = objc_msgSend(&amp;OBJC_CLASS___NSDictionary, &quot;class&quot;);</div><div class="line">  if ( (unsigned int)objc_msgSend(v11, &quot;isKindOfClass:&quot;, v13) &amp; 0xFF )</div><div class="line">  &#123;</div><div class="line">    v14 = objc_retain(v11);</div><div class="line">  &#125;</div><div class="line">  else</div><div class="line">  &#123;</div><div class="line">    v15 = objc_msgSend(&amp;OBJC_CLASS___NSDictionary, &quot;dictionaryWithObjects:forKeys:count:&quot;);</div><div class="line">    v14 = objc_retainAutoreleasedReturnValue(v15);</div><div class="line">  &#125;</div><div class="line">  v16 = v11;</div><div class="line">  v17 = v14;</div><div class="line">  v18 = objc_msgSend(&amp;OBJC_CLASS___UZCommand, &quot;alloc&quot;);</div><div class="line">  v19 = objc_msgSend(v18, &quot;initWithClassName:methodName:param:&quot;, v9, v10, v17);</div><div class="line">  objc_release(v10);</div><div class="line">  objc_release(v9);</div><div class="line">  objc_msgSend(v19, &quot;setIsSyncMethod:&quot;, module);</div><div class="line">  objc_msgSend(v19, &quot;setModule:&quot;, v12);</div><div class="line">  objc_release(v12);</div><div class="line">  v20 = (void *)objc_loadWeakRetained(&amp;v24-&gt;weakSelf);</div><div class="line">  v21 = objc_msgSend(v20, &quot;execute:&quot;, v19);</div><div class="line">  v22 = objc_retainAutoreleasedReturnValue(v21);</div><div class="line">  objc_release(v20);</div><div class="line">  objc_release(v19);</div><div class="line">  objc_release(v17);</div><div class="line">  objc_release(v16);</div><div class="line">  return objc_autoreleaseReturnValue(v22);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¤§æ¦‚æ„æ€æ˜¯ï¼Œè¯»å–è°ƒç”¨ä¿¡æ¯ï¼Œæ ¹æ®ä¿¡æ¯åˆ›å»ºä¸€ä¸ªUZCommandå¯¹è±¡ï¼Œå†å»æ‰§è¡ŒUZCommandï¼Œå†çœ‹executeçš„å®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div></pre></td><td class="code"><pre><div class="line">// UZWebView - (id)execute:(id) </div><div class="line">id __cdecl -[UZWebView execute:](struct UZWebView *self, SEL a2, id a3)</div><div class="line">&#123;</div><div class="line">  struct UZWebView *v3; // r11@1</div><div class="line">  void *v4; // r6@1</div><div class="line">  int v5; // r5@2</div><div class="line">  void *v6; // r0@3</div><div class="line">  int v7; // r10@3</div><div class="line">  void *v8; // r0@3</div><div class="line">  void *v9; // r8@3</div><div class="line">  void *v10; // r0@3</div><div class="line">  void *v11; // r0@3</div><div class="line">  void *v12; // r4@3</div><div class="line">  void *v13; // r0@3</div><div class="line">  int v14; // r5@3</div><div class="line">  void *v15; // r0@3</div><div class="line">  int v16; // r0@3</div><div class="line">  void *v17; // r6@3</div><div class="line">  void *v18; // r0@3</div><div class="line">  void *v19; // r5@3</div><div class="line">  int v20; // r10@4</div><div class="line">  void *v21; // r0@5</div><div class="line">  void *v22; // r4@5</div><div class="line">  void *v23; // r0@5</div><div class="line">  void *v24; // r0@5</div><div class="line">  void *v25; // r6@5</div><div class="line">  void *v26; // r0@5</div><div class="line">  void *v27; // r10@5</div><div class="line">  void *v28; // ST10_4@5</div><div class="line">  void *v29; // r4@5</div><div class="line">  void *v30; // r0@5</div><div class="line">  void *v31; // r0@5</div><div class="line">  int v32; // r4@5</div><div class="line">  void *v33; // r2@6</div><div class="line">  void *v34; // r0@7</div><div class="line">  void *v35; // r0@10</div><div class="line">  int v36; // r8@10</div><div class="line">  int v37; // r6@10</div><div class="line">  int v38; // r11@11</div><div class="line">  void *v39; // r0@12</div><div class="line">  void *v40; // r4@12</div><div class="line">  void *v41; // r0@13</div><div class="line">  int v42; // r4@13</div><div class="line">  void *v43; // r0@16</div><div class="line">  int v44; // r4@16</div><div class="line">  int v46; // [sp+18h] [bp-28h]@4</div><div class="line">  void *v47; // [sp+1Ch] [bp-24h]@10</div><div class="line">  int v48; // [sp+20h] [bp-20h]@3</div><div class="line">  void *v49; // [sp+24h] [bp-1Ch]@3</div><div class="line"></div><div class="line">  v3 = self;</div><div class="line">  v4 = (void *)objc_retain(a3);</div><div class="line">  if ( !((unsigned int)objc_msgSend(v3, &quot;shouldClosed&quot;) &amp; 0xFF) )</div><div class="line">  &#123;</div><div class="line">    v6 = objc_msgSend(v4, &quot;methodName&quot;);</div><div class="line">    v7 = objc_retainAutoreleasedReturnValue(v6);</div><div class="line">    v8 = objc_msgSend(v4, &quot;className&quot;);</div><div class="line">    v9 = (void *)objc_retainAutoreleasedReturnValue(v8);</div><div class="line">    v10 = objc_msgSend(v4, &quot;paramDict&quot;);</div><div class="line">    v48 = objc_retainAutoreleasedReturnValue(v10);</div><div class="line">    v11 = objc_msgSend(v3, &quot;request&quot;);</div><div class="line">    v12 = (void *)objc_retainAutoreleasedReturnValue(v11);</div><div class="line">    v13 = objc_msgSend(v12, &quot;URL&quot;);</div><div class="line">    v14 = objc_retainAutoreleasedReturnValue(v13);</div><div class="line">    v49 = v4;</div><div class="line">    v15 = objc_msgSend(v4, &quot;module&quot;);</div><div class="line">    v16 = objc_retainAutoreleasedReturnValue(v15);</div><div class="line">    objc_release(v16);</div><div class="line">    v17 = v9;</div><div class="line">    objc_release(v14);</div><div class="line">    objc_release(v12);</div><div class="line">    v18 = objc_msgSend((void *)v3-&gt;_moduleDict, &quot;objectForKey:&quot;, v9);</div><div class="line">    v19 = (void *)objc_retainAutoreleasedReturnValue(v18);</div><div class="line">    if ( !v19 )</div><div class="line">    &#123;</div><div class="line">      v46 = v7;</div><div class="line">      v20 = NSClassFromString(v9);</div><div class="line">      if ( v20</div><div class="line">        || (v21 = objc_msgSend(&amp;OBJC_CLASS___NSBundle, &quot;mainBundle&quot;),</div><div class="line">            v22 = (void *)objc_retainAutoreleasedReturnValue(v21),</div><div class="line">            v23 = objc_msgSend(v22, &quot;infoDictionary&quot;),</div><div class="line">            v24 = (void *)objc_retainAutoreleasedReturnValue(v23),</div><div class="line">            v25 = v24,</div><div class="line">            v26 = objc_msgSend(v24, &quot;stringValueForKey:defaultValue:&quot;, CFSTR(&quot;CFBundleExecutable&quot;), &amp;stru_12864),</div><div class="line">            v27 = (void *)objc_retainAutoreleasedReturnValue(v26),</div><div class="line">            v28 = v27,</div><div class="line">            objc_release(v25),</div><div class="line">            objc_release(v22),</div><div class="line">            v29 = objc_msgSend(v27, &quot;length&quot;),</div><div class="line">            v17 = v9,</div><div class="line">            v19 = 0,</div><div class="line">            v30 = objc_msgSend(v9, &quot;length&quot;),</div><div class="line">            v31 = objc_msgSend(&amp;OBJC_CLASS___NSString, &quot;stringWithFormat:&quot;, CFSTR(&quot;_TtC%lu%@%lu%@&quot;), v29, v27, v30, v9),</div><div class="line">            v32 = objc_retainAutoreleasedReturnValue(v31),</div><div class="line">            v20 = NSClassFromString(v32),</div><div class="line">            objc_release(v32),</div><div class="line">            objc_release(v28),</div><div class="line">            v20) )</div><div class="line">      &#123;</div><div class="line">        v33 = objc_msgSend(&amp;OBJC_CLASS___UZModule, &quot;class&quot;);</div><div class="line">        if ( (unsigned int)objc_msgSend((void *)v20, &quot;isSubclassOfClass:&quot;, v33) &amp; 0xFF )</div><div class="line">        &#123;</div><div class="line">          v34 = objc_msgSend((void *)v20, &quot;alloc&quot;);</div><div class="line">          v19 = objc_msgSend(v34, &quot;initWithUZWebView:&quot;, v3);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      if ( !v19 )</div><div class="line">      &#123;</div><div class="line">        v43 = objc_msgSend(&amp;OBJC_CLASS___NSString, &quot;stringWithFormat:&quot;, CFSTR(&quot;ERROR: Module &apos;%@&apos; not found&quot;), v17);</div><div class="line">        v44 = objc_retainAutoreleasedReturnValue(v43);</div><div class="line">        objc_msgSend(v3, &quot;sendErrorEvent:&quot;, v44);</div><div class="line">        NSLog(CFSTR(&quot;%@&quot;), v44);</div><div class="line">        objc_release(v44);</div><div class="line">        v5 = 0;</div><div class="line">        v7 = v46;</div><div class="line">        v38 = v48;</div><div class="line">        goto LABEL_17;</div><div class="line">      &#125;</div><div class="line">      objc_msgSend((void *)v3-&gt;_moduleDict, &quot;setObject:forKey:&quot;, v19, v17);</div><div class="line">      v7 = v46;</div><div class="line">    &#125;</div><div class="line">    v47 = v17;</div><div class="line">    v35 = objc_msgSend(&amp;OBJC_CLASS___NSString, &quot;stringWithFormat:&quot;, CFSTR(&quot;%@:&quot;), v7);</div><div class="line">    v36 = objc_retainAutoreleasedReturnValue(v35);</div><div class="line">    v37 = NSSelectorFromString();</div><div class="line">    if ( (unsigned int)objc_msgSend(v19, &quot;respondsToSelector:&quot;, v37) &amp; 0xFF )</div><div class="line">    &#123;</div><div class="line">      v38 = v48;</div><div class="line">      if ( (unsigned int)objc_msgSend(v49, &quot;isSyncMethod&quot;) &amp; 0xFF )</div><div class="line">      &#123;</div><div class="line">        v39 = objc_msgSend(v19, &quot;performSelector:withObject:&quot;, v37, v48);</div><div class="line">        v40 = v19;</div><div class="line">        v5 = objc_retainAutoreleasedReturnValue(v39);</div><div class="line">        objc_release(v36);</div><div class="line">        objc_release(v40);</div><div class="line">        v17 = v47;</div><div class="line">LABEL_17:</div><div class="line">        objc_release(v38);</div><div class="line">        objc_release(v17);</div><div class="line">        objc_release(v7);</div><div class="line">        v4 = v49;</div><div class="line">        goto LABEL_18;</div><div class="line">      &#125;</div><div class="line">      objc_msgSend(v19, &quot;performSelectorOnMainThread:withObject:waitUntilDone:&quot;, v37, v48, 0);</div><div class="line">      v17 = v47;</div><div class="line">    &#125;</div><div class="line">    else</div><div class="line">    &#123;</div><div class="line">      v17 = v47;</div><div class="line">      v41 = objc_msgSend(</div><div class="line">              &amp;OBJC_CLASS___NSString,</div><div class="line">              &quot;stringWithFormat:&quot;,</div><div class="line">              CFSTR(&quot;ERROR: Method &apos;%@&apos; not defined in Module &apos;%@&apos;&quot;),</div><div class="line">              v7,</div><div class="line">              v47);</div><div class="line">      v42 = objc_retainAutoreleasedReturnValue(v41);</div><div class="line">      objc_msgSend(v3, &quot;sendErrorEvent:&quot;, v42);</div><div class="line">      NSLog(CFSTR(&quot;%@&quot;), v42);</div><div class="line">      objc_release(v42);</div><div class="line">      v38 = v48;</div><div class="line">    &#125;</div><div class="line">    objc_release(v36);</div><div class="line">    objc_release(v19);</div><div class="line">    v5 = 0;</div><div class="line">    goto LABEL_17;</div><div class="line">  &#125;</div><div class="line">  v5 = 0;</div><div class="line">LABEL_18:</div><div class="line">  objc_release(v4);</div><div class="line">  return (id)objc_autoreleaseReturnValue(v5);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸»è¦æµç¨‹æ˜¯ä»UZCommandä¸­è¯»å‡ºæ¨¡å—ï¼Œæ–¹æ³•ï¼Œå‚æ•°ç­‰ä¿¡æ¯ï¼Œæ ¹æ®ç±»ååˆ›å»ºäº†å®ä¾‹ï¼Œç„¶åè°ƒç”¨åˆå§‹åŒ–æ„é€ å‡½æ•°initWithUZWebViewï¼ˆè¿™é‡Œå’Œå®˜ç½‘ä»‹ç»<a href="http://docs.apicloud.com/APICloud/%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/module-dev-guide-for-ios" target="_blank" rel="external">å¦‚ä½•è‡ªå®šä¹‰æ¨¡å—</a>ä¸­çš„è¯´æ˜æ˜¯ä¸€è‡´çš„ï¼‰,ç„¶åä¼šåˆ¤æ–­æ˜¯åŒæ­¥è°ƒç”¨è¿˜æ˜¯å¼‚æ­¥è°ƒç”¨ï¼ŒåŒæ­¥è°ƒç”¨åˆ™ç›´æ¥æ‰§è¡Œ<code>performSelector:withObject:</code>ï¼Œå¼‚æ­¥è°ƒç”¨æ‰§è¡Œ<code>performSelectorOnMainThread:withObject:waitUntilDone:</code>ï¼Œè‡³æ­¤ï¼Œå®Œæˆäº†JSåˆ°nativeæ–¹æ³•çš„è°ƒç”¨ã€‚</p>
<p>(2.2)å¦‚æœä½¿ç”¨äº†WKWebViewï¼Œåˆ™é€šè¿‡å‘é€ä¿¡æ¯çš„æ–¹å¼å°†è°ƒç”¨ä¿¡æ¯å‘ç»™Nativeç«¯ã€‚</p>
<p>ä¸è¿‡ï¼Œç›®å‰SuperWebViewæš‚æœªæ”¯æŒWKWebViewï¼Œæ²¡æœ‰å¼€æ”¾apiå’Œæ–‡æ¡£å‡ºæ¥ã€‚</p>
<p>(2.3)uz$qå’Œuz$rçš„å®ç°å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//uz$q</div><div class="line">&#123;c: Array[0], flag: true&#125;</div><div class="line"></div><div class="line">//uz$r</div><div class="line">function uz$r() &#123;</div><div class="line">    if(uz$q.flag &amp;&amp; uz$q.c.length&gt;0)&#123;</div><div class="line">        uz$q.flag = false;</div><div class="line">        window.location = &apos;uz://&apos; + uz$q.c[0];</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯å°†è°ƒç”¨ä¿¡æ¯æ‹¼æ¥æˆä¸€ä¸ªURLï¼Œschemeé‡‡ç”¨uz:ï¼Œèµ‹å€¼ç»™window.locationèµ‹å€¼å¯¹å½“å‰é¡µé¢é‡å®šå‘ï¼Œè¿™é‡Œåº”è¯¥æ˜¯é‡‡ç”¨UIWebViewçš„ä»£ç†æ–¹å¼å®ç°ä¸Nativeç«¯é€šä¿¡ï¼Œä¼šè°ƒç”¨åˆ°<code>webView:shouldStartLoadWithRequest:navigationType:</code>ä»£ç†æ–¹æ³•ä¸­å»ï¼Œè¿™ç§å°±æ˜¯JSBridgeçš„æ–¹å¼äº†ã€‚</p>
<p>è¡¥å……è¯´æ˜ä¸€ç‚¹ï¼Œä»Nativeå›è°ƒåˆ°JSç«¯çš„æ–¹å¼æ˜¯ï¼Œé€šè¿‡<code>stringByEvaluatingJavaScriptFromString:</code>çš„æ–¹å¼ï¼Œé€šçŸ¥jsç«¯ï¼Œå¹¶æŠŠcallbackIDä½œä¸ºå‚æ•°å›ä¼ è¿‡å»ã€‚</p>
<h3 id="å…³äºSuperWebViewæ‰€æŒ‡çš„æ··åˆæ¸²æŸ“çš„è¯´æ˜"><a href="#å…³äºSuperWebViewæ‰€æŒ‡çš„æ··åˆæ¸²æŸ“çš„è¯´æ˜" class="headerlink" title="å…³äºSuperWebViewæ‰€æŒ‡çš„æ··åˆæ¸²æŸ“çš„è¯´æ˜"></a>å…³äºSuperWebViewæ‰€æŒ‡çš„æ··åˆæ¸²æŸ“çš„è¯´æ˜</h3><p>çœ‹åˆ°æ··åˆæ¸²æŸ“ï¼Œç¬¬ä¸€ç†è§£æ˜¯ï¼ŒSuperWebViewæ”¯æŒå°†Nativeçš„Viewç›´æ¥fixåœ¨UIWebViewå†…éƒ¨åšæ¸²æŸ“ï¼Œè¿™æ ·åšå°±éœ€è¦ä¿®æ”¹webviewçš„æ¸²æŸ“æœºåˆ¶ï¼Œå¹¶ä¸”è¿˜è¦æ”¯æŒå°†cssçš„è§£ææ˜ å°„åˆ°native viewä¸­å»ï¼Œé€šè¿‡å®˜æ–¹æ–‡æ¡£å’Œä½¿ç”¨æ•™ç¨‹ï¼Œå¹¶æ²¡æœ‰çœ‹åˆ°ç›¸å…³ä»‹ç»ã€‚ç›®å‰æˆ‘çš„ç†è§£æ˜¯ï¼Œå°†Nativeçš„Viewä½œä¸ºå­Viewæ·»åŠ åˆ°UIWebViewä¸­å»ã€‚ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨å®˜ç½‘æä¾›ä¸ªUISlideræ¨¡å—æ¥å†™ç¤ºä¾‹ä»£ç ï¼Œåœ¨JSä¸­ä½¿ç”¨å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">var uislider = api.require(&apos;UISlider&apos;);</div><div class="line">            uislider.open(&#123;</div><div class="line">                animation: true,</div><div class="line">                orientation: &apos;horizontal&apos;,</div><div class="line">                rect: &#123;</div><div class="line">                    x: 10,</div><div class="line">                    y: 100,</div><div class="line">                    size: 300</div><div class="line">                &#125;,</div><div class="line">                bubble: &#123;</div><div class="line">                    direction: &apos;top&apos;,</div><div class="line">                    state: &apos;always&apos;,</div><div class="line">                    w: 80,</div><div class="line">                    h: 30,</div><div class="line">                    size: 14,</div><div class="line">                    color: &apos;#888&apos;,</div><div class="line">                    bg: &apos;widget://res/slider/bubble.png&apos;,</div><div class="line">                    prefix: &apos;æ¸©åº¦ï¼š&apos;,</div><div class="line">                    suffix: &apos;æ‘„æ°åº¦&apos;</div><div class="line">                &#125;,</div><div class="line">                handler: &#123;</div><div class="line">                    w: 10,</div><div class="line">                    h: 8,</div><div class="line">                    bg: &apos;widget://res/slider/handler.png&apos;</div><div class="line">                &#125;,</div><div class="line">                bar: &#123;</div><div class="line">                    h: 4,</div><div class="line">                    bg: &apos;widget://res/slider/background.png&apos;,</div><div class="line">                    active: &apos;widget://res/slider/bar-active.png&apos;</div><div class="line">                &#125;,</div><div class="line">                value: &#123;</div><div class="line">                    min: 16,</div><div class="line">                    max: 32,</div><div class="line">                    step: 0.5,</div><div class="line">                    init: 26</div><div class="line">                &#125;,</div><div class="line">                fixedOn: api.frameName,</div><div class="line">                fixed: false</div><div class="line">            &#125;, function(ret, err) &#123;</div><div class="line">                if (ret) &#123;</div><div class="line">                    alert(JSON.stringify(ret));</div><div class="line">                &#125; else &#123;</div><div class="line">                    alert(JSON.stringify(err));</div><div class="line">                &#125;</div><div class="line">            &#125;);</div></pre></td></tr></table></figure>
<p>æ‰“å¼€çš„è§†å›¾æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="./superwebview3.png" alt=""></p>
<p>æˆ‘ä»¬çœ‹åˆ°UISlideræ˜¯æ‚¬æµ®åœ¨WebViewä¹‹ä¸Šçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œå…¶æ˜¯é€šè¿‡åœ¨nativeæ„å»ºå¹¶æ·»åŠ åˆ°WebViewä¸Šçš„ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡åç¼–è¯‘äº†UISliderçš„ç›®æ ‡æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°openæ–¹æ³•çš„å®ç°é‡Œé¢å¤šæ¬¡è°ƒç”¨äº†addSubViewæ–¹æ³•ã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ€§èƒ½å¥½</li>
<li>æä¾›æ–¹ä¾¿çš„apiè¿›è¡Œé¡µé¢ç»„åˆ</li>
<li>æ¨¡å—åŒ–å¹³å°ï¼Œè®©æ›´å¤šçš„äººä¸ºå‰ç«¯å·¥ç¨‹å¸ˆæœåŠ¡</li>
<li>ç®¡ç†å¹³å°ï¼šçƒ­æ›´æ–°ï¼Œäº‘æ•°æ®ç­‰</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>æ ·å¼éœ€è¦å‰ç«¯å¼€å‘è€…å»æ¨¡æ‹Ÿnativeçš„æ ·å¼</li>
<li>æœ‰äº›ç³»ç»Ÿçº§çš„åŠ¨ç”»æš‚ä¸æ”¯æŒï¼Œå¦‚å¯¼èˆªæ æ¸å˜åŠ¨ç”»</li>
</ul>
<h2 id="5-Runtime-amp-Native-js"><a href="#5-Runtime-amp-Native-js" class="headerlink" title="5+Runtime &amp; Native.js"></a>5+Runtime &amp; Native.js</h2><ul>
<li>5+Runtimeæ˜¯å¯¹HTML5+è§„èŒƒçš„å®ç°ï¼Œé™¤äº†æ”¯æŒæ ‡å‡†HTML5å¤–ï¼Œè¿˜æ‰©å±•äº†JavaScriptå¯¹è±¡plusï¼Œä½¿å¾—jså¯ä»¥è°ƒç”¨å„ç§æµè§ˆå™¨æ— æ³•å®ç°æˆ–å®ç°ä¸ä½³çš„ç³»ç»Ÿèƒ½åŠ›ï¼Œè®¾å¤‡èƒ½åŠ›å¦‚æ‘„åƒå¤´ã€é™€èºä»ªã€æ–‡ä»¶ç³»ç»Ÿç­‰ï¼Œä¸šåŠ¡èƒ½åŠ›å¦‚ä¸Šä¼ ä¸‹è½½ã€äºŒç»´ç ã€åœ°å›¾ã€æ”¯ä»˜ã€è¯­éŸ³è¾“å…¥ã€æ¶ˆæ¯æ¨é€ç­‰ã€‚ç¼–å†™ä¸€æ¬¡ï¼Œå¯è·¨å¹³å°è¿è¡Œã€‚</li>
<li>å¤§é‡çš„æ‰‹æœºOSçš„åŸç”ŸAPIæ— æ³•è¢«HTML5ä½¿ç”¨ï¼ŒNative.jsæŠŠåŸç”ŸAPIå°è£…æˆäº†jså¯¹è±¡ï¼Œé€šè¿‡jså¯ä»¥ç›´æ¥è°ƒioså’Œandroidçš„åŸç”ŸAPIã€‚è¿™éƒ¨åˆ†å°±ä¸å†è·¨å¹³å°ï¼Œå†™æ³•åˆ†åˆ«æ˜¯plus.ioså’Œplus.androidã€‚</li>
<li>Native.jsä¸æ˜¯ä¸€ä¸ªjsåº“ï¼Œä¸éœ€è¦ä¸‹è½½å¼•å…¥åˆ°é¡µé¢çš„scriptä¸­ï¼Œä¹Ÿä¸åƒnodejsé‚£æ ·æœ‰å•ç‹¬çš„è¿è¡Œç¯å¢ƒï¼ŒNative.jsçš„è¿è¡Œç¯å¢ƒæ˜¯é›†æˆåœ¨5+runtimeé‡Œçš„ã€‚</li>
</ul>
<p>ä½¿ç”¨æ–¹å¼ï¼š</p>
<ul>
<li>å¯¹äºwebç«¯å¼€å‘è€…ï¼Œä½¿ç”¨HBuilder IDEï¼Œå®ƒé›†æˆäº†5+Runtimeå’ŒNative.jsï¼Œå¯ä»¥åˆ›å»ºç§»åŠ¨é¡¹ç›®æ¥å¼€å‘App</li>
<li>å¯¹äºNativeç«¯å¼€å‘è€…ï¼Œå¯ä»¥ä»å¹³å°ä¸‹è½½SDKé›†æˆåˆ°é¡¹ç›®ä¸­ä½¿ç”¨</li>
</ul>
<p>çœ‹åˆ°5+runtimeè¯´æ˜¯<a href="http://weibo.com/p/1001603806548597059383" target="_blank" rel="external">å¼€æº</a>äº†,ä¸è¿‡åœ¨<a href="https://github.com/dcloudio/H5P.Core" target="_blank" rel="external">å¼€æºé¡¹ç›®</a>ä¸­å¹¶æœªæ‰¾åˆ°iOS nativeçš„ä»£ç å®ç°ï¼Œå…¶ä¸­è¿˜æ˜¯ä»¥é™æ€åº“çš„å½¢å¼æä¾›ï¼Œä¸è¿‡åœ¨pdr.jsæ–‡ä»¶ä¸­ï¼Œçœ‹åˆ°äº†plus.toolså’Œplus.bridgeçš„å®ç°ï¼Œè¿™ä¸¤ä¸ªå®ç°åœ¨åæ–‡ä¸­ä¼šä½¿ç”¨åˆ°ã€‚</p>
<h3 id="Native-jsé€šä¿¡æ–¹å¼å®ç°åˆ†æ"><a href="#Native-jsé€šä¿¡æ–¹å¼å®ç°åˆ†æ" class="headerlink" title="Native.jsé€šä¿¡æ–¹å¼å®ç°åˆ†æ"></a>Native.jsé€šä¿¡æ–¹å¼å®ç°åˆ†æ</h3><p>ä¸‹é¢ä»¥ä½¿ç”¨iOSä¸­çš„UIAlertViewä¸ºç¤ºä¾‹ã€‚</p>
<p>iOSç«¯ä½¿ç”¨UIAlertViewçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line">//...</div><div class="line">// åˆ›å»ºUIAlertViewç±»çš„å®ä¾‹å¯¹è±¡</div><div class="line">UIAlertView *view = [UIAlertView alloc];</div><div class="line">// è®¾ç½®æç¤ºå¯¹è¯ä¸Šçš„å†…å®¹</div><div class="line">[view initWithTitle:@&quot;è‡ªå®šä¹‰æ ‡é¢˜&quot; // æç¤ºæ¡†æ ‡é¢˜</div><div class="line">    message:@&quot;ä½¿ç”¨NJSçš„åŸç”Ÿå¼¹å‡ºæ¡†ï¼Œå¯è‡ªå®šä¹‰å¼¹å‡ºæ¡†çš„æ ‡é¢˜ã€æŒ‰é’®&quot; // æç¤ºæ¡†ä¸Šæ˜¾ç¤ºçš„å†…å®¹</div><div class="line">    delegate:nil // ç‚¹å‡»æç¤ºæ¡†åçš„é€šçŸ¥ä»£ç†å¯¹è±¡ï¼Œnilç±»ä¼¼jsçš„nullï¼Œæ„ä¸ºä¸è®¾ç½®</div><div class="line">    cancelButtonTitle:@&quot;ç¡®å®š(æˆ–è€…å…¶ä»–å­—ç¬¦)&quot; // æç¤ºæ¡†ä¸Šå–æ¶ˆæŒ‰é’®çš„æ–‡å­—</div><div class="line">    otherButtonTitles:nil]; // æç¤ºæ¡†ä¸Šå…¶å®ƒæŒ‰é’®çš„æ–‡å­—ï¼Œè®¾ç½®ä¸ºnilè¡¨ç¤ºä¸æ˜¾ç¤º</div><div class="line">// è°ƒç”¨showæ–¹æ³•æ˜¾ç¤ºæç¤ºå¯¹è¯æ¡†ï¼Œåœ¨OCä¸­ä½¿ç”¨[]è¯­æ³•è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•</div><div class="line">[view show];</div></pre></td></tr></table></figure>
<p>JSç«¯ä½¿ç”¨UIAlertViewçš„æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// åˆ›å»ºUIAlertViewç±»çš„å®ä¾‹å¯¹è±¡</div><div class="line">var view = new UIAlertView();</div><div class="line">// è®¾ç½®æç¤ºå¯¹è¯ä¸Šçš„å†…å®¹</div><div class="line">view.initWithTitlemessagedelegatecancelButtonTitleotherButtonTitles(&quot;è‡ªå®šä¹‰æ ‡é¢˜&quot; // æç¤ºæ¡†æ ‡é¢˜</div><div class="line">	, &quot;ä½¿ç”¨NJSçš„åŸç”Ÿå¼¹å‡ºæ¡†ï¼Œå¯è‡ªå®šä¹‰å¼¹å‡ºæ¡†çš„æ ‡é¢˜ã€æŒ‰é’®&quot; // æç¤ºæ¡†ä¸Šæ˜¾ç¤ºçš„å†…å®¹</div><div class="line">	, null // æ“ä½œæç¤ºæ¡†åçš„é€šçŸ¥ä»£ç†å¯¹è±¡ï¼Œæš‚ä¸è®¾ç½®</div><div class="line">	, &quot;ç¡®å®š(æˆ–è€…å…¶ä»–å­—ç¬¦)&quot; // æç¤ºæ¡†ä¸Šå–æ¶ˆæŒ‰é’®çš„æ–‡å­—</div><div class="line">	, null ); // æç¤ºæ¡†ä¸Šå…¶å®ƒæŒ‰é’®çš„æ–‡å­—ï¼Œè®¾ç½®ä¸ºnullè¡¨ç¤ºä¸æ˜¾ç¤º</div><div class="line">// è°ƒç”¨showæ–¹æ³•æ˜¾ç¤ºæç¤ºå¯¹è¯æ¡†</div><div class="line">view.show();</div></pre></td></tr></table></figure>
<p>å…¶ä¸­UIAlertViewã€initWithTitlemessagedelegatecancelButtonTitleotherButtonTitleså’Œshowçš„å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">window.plus.ios.UIAlertView = function(create) &#123;</div><div class="line">        this.__UUID__ = window.plus.tools.UUID(&apos;JSB&apos;);</div><div class="line">        this.__TYPE__ = &apos;JSBObject&apos;;</div><div class="line">        var args = window.plus.ios.__Tool.process(arguments);</div><div class="line">        if ( create &amp;&amp; plus.tools.IOS == plus.tools.platform ) &#123;</div><div class="line">        </div><div class="line">        &#125; else &#123;</div><div class="line">            window.plus.bridge.execSync(&apos;Invocation&apos;, &apos;__Instance&apos;, [this.__UUID__, &apos;UIAlertView&apos;, args]);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">plus.ios.UIAlertView.prototype.initWithTitlemessagedelegatedefaultButtoncancelButtonotherButtons = function () &#123;</div><div class="line">        var ret = null;</div><div class="line">        try &#123;</div><div class="line">            var args = window.plus.ios.__Tool.process(arguments);</div><div class="line">            ret = window.plus.bridge.execSync(&apos;Invocation&apos;, &apos;__exec&apos;, [this.__UUID__, &apos;initWithTitle:message:delegate:defaultButton:cancelButton:otherButtons:&apos;, args]);</div><div class="line">            ret = plus.ios.__Tool.New(ret, false);</div><div class="line">        &#125; catch (e) &#123;</div><div class="line">            throw e;</div><div class="line">        &#125;</div><div class="line">        return ret;</div><div class="line">    &#125;;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">plus.ios.UIAlertView.prototype.show = function () &#123;</div><div class="line">        var ret = null;</div><div class="line">        try &#123;</div><div class="line">            var args = window.plus.ios.__Tool.process(arguments);</div><div class="line">            ret = window.plus.bridge.execSync(&apos;Invocation&apos;, &apos;__exec&apos;, [this.__UUID__, &apos;show&apos;, args]);</div><div class="line">            ret = plus.ios.__Tool.New(ret, false);</div><div class="line">        &#125; catch (e) &#123;</div><div class="line">            throw e;</div><div class="line">        &#125;</div><div class="line">        return ret;</div><div class="line">    &#125;;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åˆ›å»ºçš„UIAlertViewæ˜¯ä¸€ä¸ªJSå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨<code>UIAlertView = plus.ios.importClass(&quot;UIAlertView&quot;);</code>æ—¶åŠ¨æ€åˆ›å»ºçš„JSå¯¹è±¡ï¼Œä¸Nativeçš„UIAlertViewç›¸å¯¹åº”ï¼Œæˆ‘ä»¬ç§°è¯¥JSå¯¹è±¡ä¸ºNJSå¯¹è±¡ã€‚æˆ‘ä»¬å¯¹NJSå¯¹è±¡UIAlertViewè¿›è¡Œçš„æ–¹æ³•è°ƒç”¨ï¼Œæœ€ç»ˆä¼šæ‰§è¡Œ<code>window.plus.bridge.execSync</code>ï¼Œæˆ‘ä»¬éœ€è¦çœ‹ä¸‹å®ƒçš„å®ç°ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œå…³äºé€šè¿‡NJSå¯¹è±¡è®¿é—®Nativeå¯¹è±¡ï¼Œå…ˆåšä¸€äº›è¯´æ˜ã€‚</p>
<ul>
<li>é¦–æ¬¡å¯¼å…¥Nativeç±»å¯¹è±¡æ—¶ï¼ŒNative.jsä¼šåŠ¨æ€åˆ›å»ºä¸€ä¸ªJSå¯¹è±¡ä¸ä¹‹ç›¸å¯¹åº”ï¼ŒJSå¯¹è±¡åŒ…æ‹¬ç›¸åº”çš„æ„é€ å‡½æ•°ã€æ–¹æ³•ã€çˆ¶ç±»(prototype)ç­‰ä¿¡æ¯ã€‚</li>
<li>ç”±äºæ˜¯åŠ¨æ€åˆ›å»ºå¯¹åº”çš„JSå¯¹è±¡ï¼Œè¿™é‡Œæœ‰ä¸€å®šçš„æ€§èƒ½æŸè€—ï¼Œ<a href="http://ask.dcloud.net.cn/docs/#http://ask.dcloud.net.cn/article/88" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ä¸­æ€§èƒ½ä¼˜åŒ–ä¸€èŠ‚å»ºè®®é¡µé¢æ‰“å¼€åè§¦å‘çš„â€œplusreadyâ€äº‹ä»¶ä¸­è¿›è¡Œç±»å¯¹è±¡çš„å¯¼å…¥æ“ä½œï¼Œè¿™æ ·æå‰å¯¼å…¥äº†æˆ‘ä»¬éœ€è¦å¯¼å…¥çš„ç±»å¯¹è±¡ï¼Œæ˜¯æˆ‘ä»¬åœ¨åé¢é€»è¾‘ä¸­ä½¿ç”¨æ—¶ä¿è¯å…¶å·²ç»å¯¼å…¥ï¼Œè¿™ç§æ–¹å¼åªæ˜¯å°†å¯¼å…¥æ—¶æœºæå‰ï¼Œå¹¶ä¸æ˜¯æ¶ˆé™¤äº†å¯¼å…¥å¸¦æ¥çš„æŸè€—ã€‚æ‰€ä»¥å®˜æ–¹ä¹Ÿä¸å»ºè®®æˆ‘ä»¬åœ¨ä¸€ä¸ªé¡µé¢ä¸­å¯¼å…¥è¿‡å¤šçš„ç±»å¯¹è±¡ï¼Œè¿™æ ·ä¼šå½±å“æ€§èƒ½ã€‚</li>
<li>æ•°æ®ç±»å‹è½¬æ¢ï¼šåœ¨NJSä¸­è°ƒç”¨Native APIæˆ–ä»Native APIè¿”å›æ•°æ®åˆ°NJSæ—¶ä¼šè‡ªåŠ¨è½¬æ¢æ•°æ®ç±»å‹ã€‚</li>
<li>Nativeç±»å¯¹è±¡çš„æ–¹æ³•ä¼šåœ¨JSå¯¹è±¡ä¸­æœ‰ä»½æ˜ å°„ï¼Œæ–¹æ³•åæ˜¯nativeæ–¹æ³•åå»æ‰â€˜å†’å·â€™ä¹‹åçš„åç§°ï¼ˆå­—æ¯å¤§å°å†™ä¸å˜ï¼‰ã€‚</li>
<li>å¯¹äºæ˜ å°„çš„JSå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡â€œ.â€è°ƒç”¨æ–¹å¼æ¥è®¿é—®nativeå¯¹è±¡çš„å±æ€§ï¼Œä½†è¿™ç§æ–¹å¼è·å¾—çš„å€¼æ˜¯Nativeå±‚å¯¹è±¡è¢«æ˜ å°„ä¸ºNJSå¯¹è±¡é‚£ä¸€åˆ»çš„å±æ€§å€¼ï¼Œå¦‚æœéœ€è¦å®æ—¶è·å–å’Œè®¾ç½®nativeå¯¹è±¡å±æ€§å€¼ï¼Œéœ€è¦ä½¿ç”¨plusGetAttributeå’ŒplusSetAttributeæ–¹æ³•ï¼Œä½†è¿™ç§æ–¹å¼æ•ˆç‡æ¯”è¾ƒä½ã€‚</li>
<li>Objective-Cå’ŒJavaä¸­ç±»å¦‚æœå­˜åœ¨ç»§æ‰¿è‡ªåŸºç±»ï¼Œåœ¨NJSä¸­å¯¹åº”çš„å¯¹è±¡ä¼šæ ¹æ®ç»§æ‰¿å…³ç³»é€’å½’å°†æ‰€æœ‰åŸºç±»çš„å…¬æœ‰æ–¹æ³•ä¸€ä¸€æ¢æˆNJSå¯¹è±¡çš„æ–¹æ³•ï¼Œæ‰€æœ‰åŸºç±»çš„å…¬æœ‰å±æ€§ä¹Ÿå¯ä»¥é€šè¿‡å…¶plusGetAttributeã€plusSetAttributeæ–¹æ³•è®¿é—®ã€‚</li>
<li>ç”±äºObjective-Cä¸­ç±»æ²¡æœ‰é™æ€å˜é‡ï¼Œè€Œæ˜¯é€šè¿‡å®šä¹‰å…¨å±€å˜é‡æ¥å®ç°ï¼Œç›®å‰NJSä¸­æ— æ³•è®¿é—®å…¨å±€å˜é‡çš„å€¼ã€‚å¯¹äºå…¨å±€å¸¸é‡ï¼Œåœ¨NJSä¸­ä¹Ÿæ— æ³•è®¿é—®ã€‚</li>
</ul>
<p>ç»§ç»­ä¹‹å‰çš„window.plus.bridge.execSyncæ–¹æ³•è°ƒç”¨ï¼Œå…¶æ–¹æ³•å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">function (service,action,args,fn)&#123;</div><div class="line">    var json,sync,ret;</div><div class="line">    if(T.IOS==T.platform)&#123;</div><div class="line">        try&#123;</div><div class="line">            if(json=T.stringify([[window.__HtMl_Id__,service,action,null,args]]),</div><div class="line">                sync=B.synExecXhr,</div><div class="line">                sync.open(&quot;post&quot;,&quot;http://localhost:13131/cmds&quot;,!1),</div><div class="line">                sync.setRequestHeader(&quot;Content-Type&quot;,&quot;multipart/form-data&quot;),</div><div class="line">                sync.send(json),</div><div class="line">                fn)</div><div class="line">                return fn(sync.responseText)</div><div class="line">        &#125;catch(e)&#123;</div><div class="line">            console.log(&quot;sf:&quot;+action+&quot;-&quot;+service)</div><div class="line">        &#125;</div><div class="line">        return window.eval(sync.responseText)</div><div class="line">    &#125;</div><div class="line">    return T.ANDROID==T.platform?</div><div class="line">        (ret=window.prompt(T.stringify(args),&quot;pdr:&quot;+T.stringify([service,action,!1])),fn?fn(ret):eval(ret))</div><div class="line">        :void 0</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">T=plus.tools,</div><div class="line">B=plus.bridge</div></pre></td></tr></table></figure>
<p>synExecXhrçš„å…¨ç§°æ˜¯â€œåŒæ­¥è°ƒç”¨XML HTTP Requestâ€ï¼Œå‰é¢æˆ‘ä»¬æåˆ°äº†plus.bridgeçš„å®ç°ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">synExecXhr: new XMLHttpRequest()</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒsynExecXhå®é™…æ˜¯ä¸€ä¸ªXMLHttpRequestå¯¹è±¡ï¼Œé€šè¿‡å®ƒæœ€åå°†è°ƒç”¨ä¿¡æ¯ä»¥httpè¯·æ±‚çš„æ–¹å¼å‘å‡ºå»ã€‚æˆ‘ä»¬åœ¨Nativeç«¯åˆ©ç”¨oc-runtime hookä½UIAlertViewçš„æ„é€ å‡½æ•°ï¼Œæ·»åŠ æ–­ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨æ ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="5+.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒJSè°ƒç”¨åˆ°Nativeç«¯é€šè¿‡DCAsycSocketä»¥è¿™ç§è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼æ¥å®ç°ï¼Œå¹¶ä¸”åœ¨éä¸»çº¿ç¨‹å®Œæˆã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œnative.jsä¸­jsä¸nativeç«¯çš„é€šä¿¡æ˜¯é€šè¿‡æœ¬åœ°socketåŒæ­¥é€šä¿¡çš„æ–¹å¼å®Œæˆçš„ï¼Œå®Œæˆè°ƒç”¨ä¹‹åï¼Œè°ƒç”¨ç»“æœä¼šä»¥å­—ç¬¦ä¸²çš„å½¢å¼ä¿å­˜åœ¨<code>sync.responseText</code>ä¸­ï¼Œjsç«¯å†é€šè¿‡evaluateå…¶ä¸­çš„å­—ç¬¦ä¸²æ¥å¾—åˆ°è¿”å›ç»“æœã€‚</p>
<p>å°ç»“ï¼š5+runtimeè¿˜æ˜¯åŸºäºWebViewæ¥åšäº‹ï¼Œå±äºhybridæµæ´¾ï¼Œé€šè¿‡æœ¬åœ°socketé€šä¿¡æ–¹å¼æ¥å®ç°JSä¸Nativeçš„æ··åˆè°ƒç”¨ï¼Œæ”¯æŒåŠ¨æ€å¯¼å…¥nativeç±»å¯¹è±¡ï¼Œè¿›è¡Œå®ä¾‹åŒ–ã€æ–¹æ³•è°ƒç”¨ã€å±æ€§è®¿é—®ç­‰æ“ä½œï¼Œä¸ä¸€èˆ¬çš„hybridæŠ€æœ¯ä¸åŒçš„æ˜¯ï¼Œä¸éœ€è¦nativeå·¥ç¨‹å¸ˆæ¥æä¾›æ¨¡å—æˆ–è€…æ’ä»¶æ¥æ”¯æŒæ‰©å±•jsçš„èƒ½åŠ›ï¼Œwebå·¥ç¨‹æ˜¯å¯ä»¥å‚è€ƒnativeçš„æ–¹æ³•è°ƒç”¨ç±»ä¼¼çš„æ–¹å¼ï¼ˆåªéœ€è¦ç®€å•çš„ä¿®æ”¹ï¼‰ï¼Œå®ç°å¯¹nativeå¯¹è±¡çš„è®¿é—®ã€‚åŒæ—¶5+runtimeè¿˜æä¾›äº†ä¸€äº›è·¨å¹³å°çš„é€šç”¨ç»„ä»¶ï¼Œå¦‚æ‘„åƒå¤´ã€é™€èºä»ªã€æ–‡ä»¶ç³»ç»Ÿç­‰ã€‚ä½¿ç”¨native.jsæŠ€æœ¯æ‰€éœ€è¦æ³¨æ„çš„é—®é¢˜å°±æ˜¯æ€§èƒ½é—®é¢˜ï¼ŒåŠ¨æ€å¯¼å…¥å’Œè®¿é—®nativeå¯¹è±¡ä»¥åŠæ•°æ®ç±»å‹è½¬åŒ–éœ€è¦ä»˜å‡ºä¸€å®šçš„æ€§èƒ½æŸè€—ä»£ä»·ï¼Œå®˜æ–¹ç»™å‡ºäº†ä¸€äº›å»ºè®®æ¥è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚å¦å¤–ï¼Œå€¼å¾—ä¸€æçš„æ˜¯DCloudå…¬å¸è¿˜ç”¨HTML5åšäº†ä¸€å¥—æ¨¡æ‹ŸNative UIçš„å¼€æºé¡¹ç›®MUIï¼Œæœ‰å…´è¶£å¯ä»¥å‚è€ƒ<a href="https://github.com/dcloudio/mui" target="_blank" rel="external">è¿™é‡Œ</a>.</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>webç«¯å¯ä»¥ç›´æ¥è®¿é—®nativeçš„apiï¼Œè°ƒç”¨æ¥å£å‚è€ƒ</li>
<li><p>æä¾›ä¸€å¥—nativeæ ·å¼åº“ï¼šMUI</p>
<p>ç¼ºç‚¹ï¼š</p>
</li>
<li><p>ä¸nativeäº¤äº’æ€§èƒ½æœ‰ç‚¹å¼±</p>
</li>
</ul>
<h2 id="Titanium"><a href="#Titanium" class="headerlink" title="Titanium"></a>Titanium</h2><p>Titanium:â€Write in JavaScript, run native everywhereâ€.</p>
<p>Titaniumä¸PhoneGapä¸åŒï¼Œå¹¶ä¸æ˜¯åŸºäºWebViewæ¥åšè·¨å¹³å°å¼€å‘ï¼Œå±äºJavaSciptBridgeæµæ´¾ï¼Œå…³äºå®ƒä¸PhoneGapçš„å¯¹æ¯”å¯ä»¥å‚è€ƒ<a href="http://www.appcelerator.com/blog/2012/05/comparing-titanium-and-phonegap/" target="_blank" rel="external">è¿™ç¯‡æ–‡ç« </a>ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒTitaniumçš„ä¸Šå±‚è¯­è¨€å¹¶æ²¡æœ‰é‡‡ç”¨HTML+CSS+ JavaScriptï¼Œè€Œæ˜¯XML+JSON+JavaScriptï¼Œè¿™å¢åŠ äº†ä¸€å®šçš„å­¦ä¹ æˆæœ¬ã€‚</p>
<h2 id="React-Native"><a href="#React-Native" class="headerlink" title="React Native"></a>React Native</h2><p>ReactNative:â€learn onceï¼Œwrite anywhereâ€.</p>
<p>ReactNativeå’ŒTitaniumçš„æ€è·¯å¾ˆåƒï¼Œä¹ŸæŠ›å¼ƒäº†WebViewï¼Œå±äºJavaSciptBridgeæµæ´¾ã€‚ReactNativeç”¨JavaScriptç¼–å†™ç¨‹åºï¼Œæ¸²æŸ“çš„ç•Œé¢å…¨éƒ¨éƒ½æ˜¯Natvieçš„ã€‚<a href="https://facebook.github.io/react/" target="_blank" rel="external">React</a>æ˜¯å‰ç«¯çš„çŸ¥åå¼€å‘åº“ï¼Œç¨‹åºä»£ç é€šè¿‡æ“ä½œVirturl DOMæ¥ç¼–å†™ç¨‹åºï¼ŒReact runtimeè´Ÿè´£æ“ä½œå’Œæ›´æ–°çœŸæ­£çš„DOMèŠ‚ç‚¹ï¼Œè€Œè¿™ä¸ªæ›´æ–°æ˜¯é€šè¿‡diffåšå¢é‡æ›´æ–°ï¼Œè¿™æé«˜æ€§èƒ½ï¼ŒReactNativeæ²¿ç”¨äº†Reactçš„ç¼–ç¨‹æ¨¡å‹å’Œæ›´æ–°æ¨¡å‹ã€‚</p>
<p>ReactNativeçš„JSè¿è¡Œåœ¨ä¸åº”ç”¨ä¸»çº¿ç¨‹ç‹¬ç«‹çš„çº¿ç¨‹ï¼Œé€šè¿‡å¼‚æ­¥æ“ä½œä¸Natvieæ¥å£é€šä¿¡ï¼Œçº¿ç¨‹æ¨¡å‹å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š</p>
<p><img src="ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/reactnative.png" alt=""></p>
<p>JSè§£é‡Šå™¨å¯ä»¥è¿è¡Œäºæ‰‹æœºä¸­çš„ç‹¬ç«‹çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥è¿œç¨‹è°ƒè¯•æ—¶è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œå¦å¤–ï¼ŒI/Oæ“ä½œã€å›¾ç‰‡è§£ç ã€å¸ƒå±€ä¿¡æ¯è®¡ç®—ç­‰å…¶ä»–ä¸€äº›æ¶ˆè€—CPUçš„æ“ä½œä¹Ÿå¯ä»¥æ”¾åˆ°ç‹¬ç«‹çº¿ç¨‹ä¸­ï¼ŒiOSåº”ç”¨ä¸»çº¿ç¨‹ç”¨æ¥æ“ä½œUIæ§ä»¶å’ŒNative APIè®¿é—®ï¼ŒJSçº¿ç¨‹ä¸UIä¸»çº¿ç¨‹ä¹‹é—´é€šè¿‡ReactNativeæ¡¥æ¥è¿›è¡Œå¼‚æ­¥é€šä¿¡ï¼Œå®ç°JSä¸Objective-Cä¹‹é—´çš„ç›¸äº’è°ƒç”¨ã€‚</p>
<p><img src="ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/reactnative2.png" alt=""></p>
<h3 id="React-Nativeé€šä¿¡æœºåˆ¶æºç åˆ†æ"><a href="#React-Nativeé€šä¿¡æœºåˆ¶æºç åˆ†æ" class="headerlink" title="React Nativeé€šä¿¡æœºåˆ¶æºç åˆ†æ"></a>React Nativeé€šä¿¡æœºåˆ¶æºç åˆ†æ</h3><p>æºç åˆ†æåŸºäºReact Native v0.23.1,ä¸è¿‡ä¸‹è½½äº†ç›®å‰çš„æœ€æ–°ç‰ˆ0.38.0è°ƒè¯•äº†ï¼Œå®ç°æ–¹å¼å¤§åŒå°å¼‚ã€‚</p>
<p>React Native çš„æ€è·¯å°±æ˜¯å°†Nativeæ–¹æ³•å¯¼å‡ºç»™JSç”¨ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥ç”¨JSç¼–å†™ç¨‹åºï¼Œè€Œé‡‡ç”¨åŸç”Ÿæ§ä»¶æ„å»ºæ„å»ºåº”ç”¨ã€‚<br>React Native å¯¼å‡ºä»¥æ¨¡å—ï¼ˆModuleï¼‰ä¸ºå•ä½ï¼Œåœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒåŠ è½½éœ€è¦æ³¨å†Œåˆ°jsä¸­çš„moduleï¼ŒæŒ‚åˆ°jsè§£é‡Šå™¨çš„__fbBatchedBridgeConfigå˜é‡ä¸Šï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;&quot;remoteModuleConfig&quot;:[</div><div class="line"></div><div class="line">[&quot;RCTStatusBarManager&quot;,</div><div class="line">	[&quot;getHeight&quot;,&quot;setStyle&quot;,&quot;setHidden&quot;,&quot;setNetworkActivityIndicatorVisible&quot;]],</div><div class="line">[&quot;RCTSourceCode&quot;,</div><div class="line">	&#123;&quot;scriptURL&quot;:&quot;http:\/\/localhost:8081\/index.ios.bundle?platform=ios&amp;dev=true&amp;hot=true&quot;&#125;,</div><div class="line">	[&quot;getScriptText&quot;],[0]]</div><div class="line">]</div></pre></td></tr></table></figure>
<p>React Nativeè¿˜åœ¨ä¸æ–­çš„è¿­ä»£å¼€å‘ä¸­ï¼Œä¸åŒç‰ˆæœ¬çš„å®ç°æ–¹å¼å¯èƒ½ä¸åŒï¼Œä¾‹å¦‚ï¼Œåœ¨<a href="http://blog.cnbang.net/tech/2698/" target="_blank" rel="external">React Nativeé€šä¿¡æœºåˆ¶è¯¦è§£</a>ä¸€æ–‡ä¸­ä»‹ç»ï¼ŒNatvieæ¨¡å—çš„æ³¨å†Œæ–¹å¼æ˜¯é€šè¿‡åœ¨åˆ©ç”¨ç¼–è¯‘æŒ‡ä»¤å°†éœ€è¦å¯¼å‡ºçš„æ¨¡å—å­˜å‚¨åˆ°æ‰§è¡Œæ–‡ä»¶çš„äºŒè¿›åˆ¶DATAç«¯ï¼Œç¨‹åºå¯åŠ¨æ—¶å†ä»ä¸­è¯»å–å¯¼å‡ºçš„æ¨¡å—ä¿¡æ¯ï¼Œæˆ‘ä½¿ç”¨çš„æºç æ˜¯v0.23.1ç‰ˆæœ¬ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œéœ€è¦bridgeçš„æ¨¡å—éœ€è¦ä½¿ç”¨<code>RCTRegisterModule</code>å®ï¼Œå…¶å±•å¼€å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#define RCT_EXPORT_MODULE(js_name) \</div><div class="line">RCT_EXTERN void RCTRegisterModule(Class); \</div><div class="line">+ (NSString *)moduleName &#123; return @#js_name; &#125; \</div><div class="line">+ (void)load &#123; RCTRegisterModule(self); &#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œbridgeçš„æ¨¡å—åœ¨loadæ–¹æ³•ä¸­è¿›è¡Œæ³¨å†Œï¼Œæ³¨å†Œçš„æ¨¡å—ä¿å­˜åœ¨RCTBridge.mçš„<code>static NSMutableArray&lt;Class&gt; *RCTModuleClasses;</code>å…¨å±€é™æ€å˜é‡ä¸­ã€‚æ¨¡å—ä¸­éœ€è¦bridgeçš„æ–¹æ³•ä½¿ç”¨<code>RCT_EXPORT_METHOD</code>å®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨OCæ–¹æ³•çš„ç¬¬ä¸€ä¸ªåˆ†å·ä¹‹å‰çš„éƒ¨åˆ†ä½œä¸ºJSä¸­çš„è°ƒç”¨åç§°ï¼Œä¾‹å¦‚æ¨¡å—ModuleNameä¸­ï¼Œéœ€è¦å¯¼å‡ºçš„æ–¹æ³•<code>- (void)doSomething:(NSString *)aString withA:(NSInteger)a andB:(NSInteger)b</code>ï¼Œéœ€è¦å†™æˆ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">RCT_EXPORT_METHOD(doSomething:(NSString *)aString</div><div class="line">                   withA:(NSInteger)a</div><div class="line">                   andB:(NSInteger)b)</div><div class="line"> &#123; ... &#125;</div></pre></td></tr></table></figure>
<p>æœ€ç»ˆJSçš„è°ƒç”¨å½¢å¼æ˜¯<code>NativeModules.ModuleName.doSomething</code>ã€‚</p>
<p>åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªCADisplayLinkæ·»åŠ åˆ°çº¿ç¨‹ï¼ˆçœŸæœºä¸Šæ˜¯JSçº¿ç¨‹ï¼Œæ¨¡æ‹Ÿå™¨ä¸Šæ˜¯ä¸»çº¿ç¨‹ï¼‰çš„runloopä¸­ï¼Œå‘¨æœŸæ€§çš„è°ƒç”¨JSçš„callFunctionReturnFlushedQueueæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯ä»ä¸€ä¸ªMessageQueueä¸­å–å‡ºæ¶ˆæ¯å†…å®¹ã€‚JSè°ƒç”¨OCæ–¹æ³•ï¼Œä¼šå°†è°ƒç”¨çš„ä¿¡æ¯ï¼ˆmoduleIDã€methodIDã€paramsï¼‰ä¿å­˜åœ¨è¿™ä¸ªMessageQueueä¸­ã€‚</p>
<p>è¿™é‡Œéœ€è¦è¯´æ˜ä¸€ä¸‹ï¼šæµ‹è¯•å‘ç°ï¼Œåœ¨æ¨¡æ‹Ÿå™¨ä¸­ï¼ŒJSçº¿ç¨‹ä¸Nativeç«¯ä½¿ç”¨RCTSRWebSocketExecutoræ¥è¿›è¡Œé€šä¿¡ï¼Œåœ¨çœŸæœºä¸Šï¼Œä½¿ç”¨RCTJSCExecutoræ¥æ‰§è¡Œjsè„šæœ¬ï¼Œåœ¨RCTJSCExecutorä¸­å¯ä»¥çœ‹åˆ°å¯¹å®ƒçš„è¯´æ˜<strong>Uses a JavaScriptCore context as the execution engine.</strong>ã€‚</p>
<p>å›åˆ°åˆšæ‰çš„è¯é¢˜ï¼Œè°ƒç”¨callFunctionReturnFlushedQueueä¹‹åï¼Œä¼šä»MessageQueueå–å‡ºè°ƒç”¨ä¿¡æ¯ï¼Œå·²jsonå­—ç¬¦ä¸²çš„å½¢å¼è¿”å›ç»™nativeç«¯ï¼Œnativeç«¯é€šè¿‡RCTJSONParseæ¥å£parseå‡ºè°ƒç”¨ä¿¡æ¯ï¼Œä¿¡æ¯åŒ…æ‹¬æ¨¡å—id,æ–¹æ³•id,å‚æ•°,ä»¥åŠå¯èƒ½çš„å›è°ƒidï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">&lt;__NSCFArray 0x7f8bd1610e60&gt;(</div><div class="line"></div><div class="line">//moduleIDs</div><div class="line">&lt;__NSCFArray 0x7f8bd16c4ae0&gt;(</div><div class="line">56,</div><div class="line">33,</div><div class="line">33,</div><div class="line">34</div><div class="line">)</div><div class="line">,</div><div class="line"></div><div class="line">//methodIDs</div><div class="line">&lt;__NSCFArray 0x7f8bd16f0400&gt;(</div><div class="line">1,</div><div class="line">5,</div><div class="line">4,</div><div class="line">0</div><div class="line">)</div><div class="line">,</div><div class="line"></div><div class="line">//params</div><div class="line">&lt;__NSCFArray 0x7f8bd16396c0&gt;(</div><div class="line">&lt;__NSCFArray 0x7f8bd16f7d60&gt;(</div><div class="line">ws://localhost:8097/devtools,</div><div class="line">&lt;null&gt;,</div><div class="line">&lt;null&gt;,</div><div class="line">280</div><div class="line">)</div><div class="line">,</div><div class="line">&lt;__NSCFArray 0x7f8bd163d350&gt;(</div><div class="line">29,</div><div class="line">RCTView,</div><div class="line">1,</div><div class="line">&lt;null&gt;</div><div class="line">)</div><div class="line">,</div><div class="line">&lt;__NSCFArray 0x7f8bd162e670&gt;(</div><div class="line">7,</div><div class="line">&lt;null&gt;,</div><div class="line">&lt;null&gt;,</div><div class="line">&lt;__NSCFArray 0x7f8bd16e4c90&gt;(</div><div class="line">29</div><div class="line">)</div><div class="line">,</div><div class="line">&lt;__NSCFArray 0x7f8bd16f0d90&gt;(</div><div class="line">5</div><div class="line">)</div><div class="line">,</div><div class="line">&lt;__NSCFArray 0x7f8bd1621a10&gt;(</div><div class="line">5</div><div class="line">)</div><div class="line">)</div><div class="line">,</div><div class="line">&lt;__NSCFArray 0x7f8bd16c7670&gt;(</div><div class="line">5,</div><div class="line">2,</div><div class="line">3</div><div class="line">)</div><div class="line"></div><div class="line">)</div><div class="line">,</div><div class="line">//callID</div><div class="line">1171</div><div class="line">)</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹JSéƒ¨åˆ†æ˜¯å¦‚ä½•åˆ›å»ºè¿™ä¸ªé˜Ÿåˆ—ä»¥åŠå°†è¿™äº›æ¶ˆæ¯è°ƒç”¨ä¿¡æ¯ä¿å­˜åœ¨é˜Ÿåˆ—ä¸­çš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//BatchedBridge.js</div><div class="line">const BatchedBridge = new MessageQueue(</div><div class="line">  __fbBatchedBridgeConfig.remoteModuleConfig,</div><div class="line">  __fbBatchedBridgeConfig.localModulesConfig,</div><div class="line">);</div></pre></td></tr></table></figure>
<p>å‰é¢æåˆ°è¿‡<strong>fbBatchedBridgeConfig.remoteModuleConfigæ˜¯Nativeç«¯æ³¨å†Œçš„æ¨¡å—ï¼Œ</strong>fbBatchedBridgeConfig.localModulesConfigæ˜¯JSæœ¬åœ°æ¨¡å—ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">//MessageQueue.js</div><div class="line">constructor(remoteModules, localModules) &#123;</div><div class="line">    this.RemoteModules = &#123;&#125;;</div><div class="line"></div><div class="line">    this._callableModules = &#123;&#125;;</div><div class="line">    this._queue = [[], [], [], 0];</div><div class="line">    this._moduleTable = &#123;&#125;;</div><div class="line">    this._methodTable = &#123;&#125;;</div><div class="line">    this._callbacks = [];</div><div class="line">    this._callbackID = 0;</div><div class="line">    this._callID = 0;</div><div class="line">    this._lastFlush = 0;</div><div class="line">    this._eventLoopStartTime = new Date().getTime();</div><div class="line"></div><div class="line">    [</div><div class="line">      &apos;invokeCallbackAndReturnFlushedQueue&apos;,</div><div class="line">      &apos;callFunctionReturnFlushedQueue&apos;,</div><div class="line">      &apos;flushedQueue&apos;,</div><div class="line">    ].forEach((fn) =&gt; this[fn] = this[fn].bind(this));</div><div class="line"></div><div class="line">    let modulesConfig = this._genModulesConfig(remoteModules);</div><div class="line">    </div><div class="line">    //æ„å»ºæ¨¡å—ä¿¡æ¯</div><div class="line">    this._genModules(modulesConfig);</div><div class="line">    localModules &amp;&amp; this._genLookupTables(</div><div class="line">      this._genModulesConfig(localModules),this._moduleTable, this._methodTable</div><div class="line">    );</div><div class="line"></div><div class="line">    this._debugInfo = &#123;&#125;;</div><div class="line">    this._remoteModuleTable = &#123;&#125;;</div><div class="line">    this._remoteMethodTable = &#123;&#125;;</div><div class="line">    this._genLookupTables(</div><div class="line">      modulesConfig, this._remoteModuleTable, this._remoteMethodTable</div><div class="line">    );</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>é‡Œé¢è°ƒç”¨this._genModules(modulesConfig);ï¼Œæœ€åä¼šè°ƒåˆ°_genModuleã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">//configæ˜¯moduleä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¨¡å—åï¼Œå¯¼å‡ºæ–¹æ³•ååˆ—è¡¨ç­‰ï¼ŒmoduleIDæ¨¡å—å¯¹åº”çš„idï¼ˆè¿™ä¸ªIDå°±æ˜¯æ¨¡å—åœ¨remoteModulesæ•°ç»„ä¸­çš„ç´¢å¼•ï¼‰</div><div class="line">_genModule(config, moduleID) &#123;</div><div class="line">    if (!config) &#123;</div><div class="line">      return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    let moduleName, constants, methods, asyncMethods;</div><div class="line">    if (moduleHasConstants(config)) &#123;</div><div class="line">      [moduleName, constants, methods, asyncMethods] = config;</div><div class="line">    &#125; else &#123;</div><div class="line">      [moduleName, methods, asyncMethods] = config;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    let module = &#123;&#125;;</div><div class="line">    methods &amp;&amp; methods.forEach((methodName, methodID) =&gt; &#123;</div><div class="line">      const methodType =</div><div class="line">        asyncMethods &amp;&amp; arrayContains(asyncMethods, methodID) ?</div><div class="line">          MethodTypes.remoteAsync : MethodTypes.remote;</div><div class="line">      //æ„å»ºæ–¹æ³•ä¿¡æ¯</div><div class="line">      module[methodName] = this._genMethod(moduleID, methodID, methodType);</div><div class="line">    &#125;);</div><div class="line">    Object.assign(module, constants);</div><div class="line"></div><div class="line">    if (!constants &amp;&amp; !methods &amp;&amp; !asyncMethods) &#123;</div><div class="line">      module.moduleID = moduleID;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	//æ„å»ºçš„moduleä¿¡æ¯ä¿å­˜åœ¨RemoteModulesä¸­</div><div class="line">    this.RemoteModules[moduleName] = module;</div><div class="line">    return module;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>è°ƒç”¨this._genMethodæ„å»ºæ–¹æ³•ä¿¡æ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">//moduleï¼šæ¨¡å—ID,methodï¼šæ–¹æ³•IDï¼ˆæ˜¯æ–¹æ³•åœ¨æ–¹æ³•ååˆ—è¡¨ä¸­çš„ç´¢å¼•ï¼‰ï¼Œtypeï¼š&quot;remoteï¼ŒremoteAsync&quot;ï¼ŒåŒºåˆ†æ˜¯åŒæ­¥è°ƒç”¨è¿˜æ˜¯å¼‚æ­¥è°ƒç”¨ï¼Œå¼‚æ­¥è°ƒç”¨ç”¨Promiseå®ç°</div><div class="line">  _genMethod(module, method, type) &#123;</div><div class="line">    let fn = null;</div><div class="line">    let self = this;</div><div class="line">    if (type === MethodTypes.remoteAsync) &#123;</div><div class="line">      fn = function(...args) &#123;</div><div class="line">        return new Promise((resolve, reject) =&gt; &#123;</div><div class="line">          self.__nativeCall(</div><div class="line">            module,</div><div class="line">            method,</div><div class="line">            args,</div><div class="line">            (data) =&gt; &#123;</div><div class="line">              resolve(data);</div><div class="line">            &#125;,</div><div class="line">            (errorData) =&gt; &#123;</div><div class="line">              var error = createErrorFromErrorData(errorData);</div><div class="line">              reject(error);</div><div class="line">            &#125;);</div><div class="line">        &#125;);</div><div class="line">      &#125;;</div><div class="line">    &#125; else &#123;</div><div class="line">      fn = function(...args) &#123;</div><div class="line">        let lastArg = args.length &gt; 0 ? args[args.length - 1] : null;</div><div class="line">        let secondLastArg = args.length &gt; 1 ? args[args.length - 2] : null;</div><div class="line">        let hasSuccCB = typeof lastArg === &apos;function&apos;;</div><div class="line">        let hasErrorCB = typeof secondLastArg === &apos;function&apos;;</div><div class="line">        hasErrorCB &amp;&amp; invariant(</div><div class="line">          hasSuccCB,</div><div class="line">          &apos;Cannot have a non-function arg after a function arg.&apos;</div><div class="line">        );</div><div class="line">        let numCBs = hasSuccCB + hasErrorCB;</div><div class="line">        let onSucc = hasSuccCB ? lastArg : null;</div><div class="line">        let onFail = hasErrorCB ? secondLastArg : null;</div><div class="line">        args = args.slice(0, args.length - numCBs);</div><div class="line">        return self.__nativeCall(module, method, args, onFail, onSucc);</div><div class="line">      &#125;;</div><div class="line">    &#125;</div><div class="line">    fn.type = type;</div><div class="line">    return fn;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ__nativeCallçš„è°ƒç”¨è¢«åŒ…è£…åœ¨ä¸€ä¸ªfunctionä¸­ï¼Œè¿™ä¸ªfunctionä½œä¸ºfirst-classed Valueè¢«è¿”å›ï¼Œå·²<key,value>çš„å½¢å¼ä¿å­˜åœ¨moduleä¿¡æ¯ä¸­ã€‚æˆ‘ä»¬å¼€çœ‹åˆ°ï¼Œnativeè°ƒç”¨çš„æˆåŠŸå’Œå¤±è´¥å›è°ƒå‡½æ•°ä¹Ÿæ˜¯åœ¨è¿™é‡Œä¼ å…¥ã€‚</key,value></p>
<p>è‡³æ­¤ï¼ŒNativeæ–¹æ³•çš„è°ƒç”¨æ˜ å°„è¡¨æ„å»ºå®Œæˆã€‚ä¸‹é¢æ˜¯JSç«¯ç½‘ç»œæ¥å£çš„ä¾‹å­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">var RCTNetworkingNative = require(&apos;NativeModules&apos;).Networking;</div><div class="line"></div><div class="line">/**</div><div class="line"> * This class is a wrapper around the native RCTNetworking module.</div><div class="line"> */</div><div class="line">class RCTNetworking &#123;</div><div class="line"></div><div class="line">  static sendRequest(query, callback) &#123;</div><div class="line">    RCTNetworkingNative.sendRequest(query, callback);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  static abortRequest(requestId) &#123;</div><div class="line">    RCTNetworkingNative.cancelRequest(requestId);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">module.exports = RCTNetworking;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒRCTNetworkingæœ€ç»ˆè°ƒç”¨çš„æ˜¯Nativeæ˜ å°„è¡¨ä¸­çš„æœ¬åœ°æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬ç»§ç»­æ¥çœ‹__nativeCallçš„å®ç°ï¼Œè¿™é‡Œå¾ˆé‡è¦ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"> __nativeCall(module, method, params, onFail, onSucc) &#123;</div><div class="line"> </div><div class="line"> 	//(1)</div><div class="line">   if (onFail || onSucc) &#123;</div><div class="line">     // eventually delete old debug info</div><div class="line">     (this._callbackID &gt; (1 &lt;&lt; 5)) &amp;&amp;</div><div class="line">       (this._debugInfo[this._callbackID &gt;&gt; 5] = null);</div><div class="line"></div><div class="line">     this._debugInfo[this._callbackID &gt;&gt; 1] = [module, method];</div><div class="line">     onFail &amp;&amp; params.push(this._callbackID);</div><div class="line">     this._callbacks[this._callbackID++] = onFail;</div><div class="line">     onSucc &amp;&amp; params.push(this._callbackID);</div><div class="line">     this._callbacks[this._callbackID++] = onSucc;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   global.nativeTraceBeginAsyncFlow &amp;&amp;</div><div class="line">     global.nativeTraceBeginAsyncFlow(TRACE_TAG_REACT_APPS, &apos;native&apos;, this._callID);</div><div class="line">   this._callID++;</div><div class="line"></div><div class="line">//ï¼ˆ2ï¼‰</div><div class="line">   this._queue[MODULE_IDS].push(module);</div><div class="line">   this._queue[METHOD_IDS].push(method);</div><div class="line">   this._queue[PARAMS].push(params);</div><div class="line"></div><div class="line">//(3)</div><div class="line">   var now = new Date().getTime();</div><div class="line">   if (global.nativeFlushQueueImmediate &amp;&amp;</div><div class="line">       now - this._lastFlush &gt;= MIN_TIME_BETWEEN_FLUSHES_MS) &#123;</div><div class="line">     global.nativeFlushQueueImmediate(this._queue);</div><div class="line">     this._queue = [[], [], [], this._callID];</div><div class="line">     this._lastFlush = now;</div><div class="line">   &#125;</div><div class="line">   Systrace.counterEvent(&apos;pending_js_to_native_queue&apos;, this._queue[0].length);</div><div class="line">   if (__DEV__ &amp;&amp; SPY_MODE &amp;&amp; isFinite(module)) &#123;</div><div class="line">     console.log(&apos;JS-&gt;N : &apos; + this._remoteModuleTable[module] + &apos;.&apos; +</div><div class="line">       this._remoteMethodTable[module][method] + &apos;(&apos; + JSON.stringify(params) + &apos;)&apos;);</div><div class="line">   &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>ä»£ç è¯´æ˜ï¼š<br>ï¼ˆ1ï¼‰å¾€paramsä¸­æ·»åŠ å›è°ƒå›è°ƒæ–¹æ³•å¯¹åº”çš„idï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå›è°ƒidä¿å­˜åœ¨paramsæ•°ç»„æœ€åï¼Œè¿˜ä¼šè®°å½•debugä¿¡æ¯ã€‚<br>ï¼ˆ2ï¼‰å°†nativeè°ƒç”¨ä¿¡æ¯æ·»åŠ åˆ°MessageQueueï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒMessageQueueçš„æ ¼å¼æ˜¯<code>this._queue = [[], [], [], this._callID];</code>ï¼ŒmoduleIDã€methodIDå’Œparamsåˆ†åˆ«è¢«åŠ å…¥åˆ°MessageQueueä¸­ä¸åŒæ•°ç»„ä¸­ï¼Œæ‰€ä»¥å°±çœ‹åˆ°äº†å‰é¢æˆ‘ä»¬æ‰“å°å‡ºæ¥çš„Nativeç«¯æ”¶åˆ°çš„æ•°æ®æ ¼å¼ã€‚<br>ï¼ˆ3ï¼‰å¦‚æœæ˜¯è¦æ±‚ç«‹å³è°ƒç”¨å¹¶ä¸”è¶…æ—¶ï¼Œåˆ™ä¼šè°ƒç”¨global.nativeFlushQueueImmediateæ¥å£ã€‚è¿™é‡Œæˆ‘æŸ¥æ‰¾äº†ä¸‹ä»£ç ï¼Œjsç«¯å’Œnativeç«¯å¹¶æ²¡æœ‰ä¸ºglobal.nativeFlushQueueImmediateï¼Œå¯è§ä¸€èˆ¬ä¸ä¼šè¿›å…¥è¿™ä¸ªæµç¨‹ï¼Œä¸€èˆ¬è¿˜æ˜¯ä½¿ç”¨å‰é¢ä»‹ç»çš„Nativeå®šæ—¶é©±åŠ¨çš„æ–¹å¼æ¥è·å–MessageQueueä¸­çš„è°ƒç”¨ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œæ—¢ç„¶æœ‰è¿™ä¸ªå€¼ï¼Œè¯´æ˜æ˜¯æ”¯æŒjsä¸»åŠ¨è°ƒç”¨åˆ°nativeç«¯çš„ï¼Œé‚£åˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>
<p>åœ¨RCTJSCExecutor.mæ–‡ä»¶ä¸­çš„setUpæ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™æ ·ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[self addSynchronousHookWithName:@&quot;nativeFlushQueueImmediate&quot; usingBlock:^(NSArray&lt;NSArray *&gt; *calls)&#123;</div><div class="line">    RCTJSCExecutor *strongSelf = weakSelf;</div><div class="line">    if (!strongSelf.valid || !calls) &#123;</div><div class="line">      return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    RCT_PROFILE_BEGIN_EVENT(0, @&quot;nativeFlushQueueImmediate&quot;, nil);</div><div class="line">    [strongSelf-&gt;_bridge handleBuffer:calls batchEnded:NO];</div><div class="line">    RCT_PROFILE_END_EVENT(0, @&quot;js_call&quot;, nil);</div><div class="line">  &#125;];</div></pre></td></tr></table></figure>
<p>å†çœ‹addSynchronousHookWithNameçš„å®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (void)addSynchronousHookWithName:(NSString *)name usingBlock:(id)block</div><div class="line">&#123;</div><div class="line">  __weak RCTJSCExecutor *weakSelf = self;</div><div class="line">  [self executeBlockOnJavaScriptQueue:^&#123;</div><div class="line">    weakSelf.context.context[name] = block;</div><div class="line">  &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œæ˜¯å°†nativeçš„æ–¹æ³•æŒ‚åˆ°jsè§£é‡Šå™¨çš„å…¨å±€ä¸Šä¸‹æ–‡ä¸Šï¼Œè¿™æ ·jsç«¯å°±å¯ä»¥ç›´æ¥è°ƒç”¨è¿™äº›nativeæ–¹æ³•ã€‚é™¤äº†nativeFlushQueueImmediateä»¥å¤–ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›å…¨å±€æ–¹æ³•ã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†JSç«¯å¦‚ä½•è°ƒç”¨ç»„ç»‡æ•°æ®å‘é€ç»™Nativeç«¯ï¼Œé‚£Nativeç«¯æ‹¿åˆ°æ•°æ®ä¹‹åæ˜¯å¦‚ä½•å¤„ç†çš„å‘¢ï¼Ÿ</p>
<p>æˆ‘è·Ÿè¸ªäº†JSè°ƒç”¨åˆ›å»ºUIViewçš„è¿‡ç¨‹(é€šè¿‡hook UIViewçš„initWithFrameæ–¹æ³•ï¼ŒåŠ æ–­ç‚¹è¿›è¡Œæµ‹è¯•)ï¼Œå…¶å¯¼å‡ºçš„Nativeæ–¹æ³•åœ¨RCTUIManager.mä¸­ï¼Œæ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">createView:(nonnull NSNumber *)reactTag</div><div class="line">                  viewName:(NSString *)viewName</div><div class="line">                  rootTag:(__unused NSNumber *)rootTag</div><div class="line">                  props:(NSDictionary *)props</div></pre></td></tr></table></figure>
<p>åˆ›å»ºUIViewçš„æµç¨‹å¦‚ä¸‹ï¼š<br>Nativeç«¯æ¥æ”¶åˆ°æ•°æ®ï¼Œä¼ ç»™RCTBatchedBridge.mä¸­çš„handleBufferå‡½æ•°å¤„ç†ï¼Œä»ä¸­è§£æå‡ºå¤šç»„ä¿¡æ¯ï¼Œæ¯ç»„ä¿¡æ¯åŒ…æ‹¬æ¨¡å—id,æ–¹æ³•id,å‚æ•°,ä»¥åŠå¯èƒ½çš„å›è°ƒidï¼Œç”¨åŒ¿åblockå°†æ¯ç»„ä¿¡æ¯åŒ…èµ·æ¥ï¼ˆè¿™é‡Œæˆ‘ä»¬å–ä¸ªåå«block1ï¼‰ï¼Œæ”¾åˆ°moduleIDæ‰€å¯¹åº”çš„RCTModuleDataçš„methodQueueä¸­å¼‚æ­¥æ‰§è¡Œï¼ŒRCTModuleDataæ˜¯å¯¹moduleç¤ºä¾‹çš„åŒ…è£…ï¼ŒmethodQueueæ˜¯ç”±moduleå®ä¾‹è¿”å›ï¼Œç”±äºiOSå¯¹UIçš„æ“ä½œä¸€èˆ¬éœ€è¦æ”¾åœ¨è¿™çº¿ç¨‹ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°ï¼ŒUIç›¸å…³çš„moduleçš„methodçš„queueçš„å®ç°è¿”å›çš„éƒ½æ˜¯ä¸»çº¿ç¨‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//RCTActionSheet.m</div><div class="line">- (dispatch_queue_t)methodQueue</div><div class="line">&#123;</div><div class="line">  return dispatch_get_main_queue();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åŒæ—¶ï¼Œè¿˜ä¼šå¾€methodQueueä¸­æ·»åŠ åŒ¿åblockï¼ˆè¿™é‡Œæˆ‘ä»¬å–ä¸ªåå«block2ï¼‰çš„å¼‚æ­¥æ“ä½œã€‚block1æ‰§è¡Œæ—¶ï¼Œé¦–å…ˆæ ¹æ®moduleIDåœ¨å…¨å±€è¡¨ä¸­æŸ¥æ‰¾åˆ°å¯¹åº”çš„Moduleï¼ˆRCTModuleDataï¼ŒModuleDataçš„åˆ›å»ºä¼šæ ¹æ®å‰é¢æåˆ°çš„RCTModuleClassesä¸­çš„Classä¸€ä¸€å¯¹åº”åˆ›å»ºï¼Œä¿å­˜åœ¨RCTBatchedBridge.mä¸­çš„<code>NSArray&lt;RCTModuleData *&gt; *_moduleDataByID;</code>ä¸­ï¼‰ï¼Œç„¶åå†æ ¹æ®methodIDåœ¨Moduleä¸­æ‰¾åˆ°ç›¸åº”çš„æ–¹æ³•RCTBridgeMethodï¼ˆRCTBridgeMethodæ˜¯å¯¹nativeæ–¹æ³•çš„å°è£…ï¼Œå†…éƒ¨ä¼šæŒæœ‰ä¸€ä¸ªNSInvocationï¼‰ï¼Œä¸ºå†…éƒ¨çš„_invocationè®¾ç½®å‚æ•°å¹¶è°ƒç”¨ã€‚è¿™æ—¶å®é™…è°ƒç”¨çš„å°±æ˜¯æˆ‘ä»¬å¯¼å‡ºçš„Natvieæ–¹æ³•äº†ï¼ˆä¹Ÿå°±æ˜¯å‰é¢çš„createView: viewName:rootTag:props:ï¼‰ï¼Œä»–ä¼šå°†åˆ›å»ºUIçš„æ“ä½œå†æ¬¡å°è£…æˆä¸€ä¸ªä¸ªblockï¼ˆè¿™é‡Œæˆ‘ä»¬å–ä¸ªåå«block3ï¼‰ï¼Œæ”¾åˆ°ä¸€ä¸ªé›†åˆ<code>NSMutableArray&lt;dispatch_block_t&gt; *_pendingUIBlocks;</code>ä¸­ï¼Œå½“block2æ‰§è¡Œæ—¶ï¼Œä¼šä»_pendingUIBlocksä¸­é€ä¸ªå–å‡ºblock3å¹¶æ‰§è¡Œï¼Œä»è€Œåˆ›å»ºå‡ºç›¸åº”çš„Natvie UIã€‚</p>
<p>å¦‚æœè°ƒç”¨Natvieä¹‹åï¼ŒJSç«¯éœ€è¦CallBackè¢«è°ƒç”¨ï¼Œä¼šå°†CallBackIDé€šè¿‡å‚æ•°ä¼ ç»™Nativeï¼ŒNativeå‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¼šé€šè¿‡å‘é€jsonå­—ç¬¦ä¸²çš„å½¢å¼å‘é€ç»™JSè°ƒç”¨ç»“æœï¼Œå…¶ä¸­ä¼šå¸¦ä¸ŠCallBackIDä»¥åŠæ­¤æ¬¡å‘é€æ¶ˆæ¯çš„IDã€‚</p>
<p>åœ¨æŸ¥çœ‹ReactNativeæºç ä¹‹å‰ï¼Œæœ¬ä»¥ä¸ºJSä¸OCä¹‹å‰çš„é€šä¿¡æ˜¯é€šè¿‡åˆ©ç”¨JavaScriptCoreè¿›è¡ŒJSBindingè¿™ç§é™æ€ç»‘å®šçš„æ–¹å¼ï¼ŒæŸ¥çœ‹æºç ä¹‹åæ‰å‘ç°ä¸æ˜¯è¿™æ ·ã€‚é€šè¿‡ä¸Šé¢å¯¹æºç çš„åˆ†æï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒRNè‡ªå·±å®ç°ä»¥ä¸€å¥—é€šä¿¡æ¨¡å¼ï¼ŒJSä¸OCä¹‹é—´çš„è°ƒç”¨é‡‡ç”¨åŠ¨æ€æŸ¥æ‰¾çš„æ–¹å¼æ¥å®ç°ï¼ŒJSå’ŒNativeå·¥ä½œäºç‹¬ç«‹çš„çº¿ç¨‹ï¼Œçº¿ç¨‹é—´æ ¹æ®ä¸€å¥—åŸºäºIDæ˜ å°„åè®®çš„æ–¹å¼æ¥è¿›è¡Œé€šä¿¡ï¼Œè¿™æ ·çš„åŠ¨æ€æŸ¥æ‰¾çš„æ–¹å¼é€šä¿¡æˆæœ¬ä¼šé«˜ä¸€äº›ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰ç”¨JSBindingçš„æ–¹å¼ï¼Œä¸ªäººç†è§£ä¸»è¦æœ‰ä¸€ä¸‹ä¸¤ç‚¹åŸå› ã€‚</p>
<ol>
<li>ReactNative çš„ç›®æ ‡æ˜¯è·¨å¹³å°ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰å¹³å°éƒ½é‡‡ç”¨JavaScriptCoreå¼•æ“ï¼Œå¦å¤–ï¼ŒiOS7ä¹‹å‰ JavaScriptCoreä¹Ÿæ²¡æœ‰å¼€å‘å‡ºæ¥ã€‚</li>
<li>ReactNative çš„ JS ä»£ç å·¥ä½œåœ¨ç‹¬ç«‹çº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰ï¼Œå¦‚æœé‡‡ç”¨é™æ€ç»‘å®šçš„æ–¹å¼ï¼Œæ— æ³•æˆ–è€…å¾ˆéš¾ä¿è¯å¯¹UIçš„æ“ä½œå·¥ä½œåœ¨ä¸»çº¿ç¨‹ã€‚</li>
</ol>
<h3 id="æ€§èƒ½æµ‹è¯•"><a href="#æ€§èƒ½æµ‹è¯•" class="headerlink" title="æ€§èƒ½æµ‹è¯•"></a>æ€§èƒ½æµ‹è¯•</h3><p>(1)Native</p>
<p><img src="ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/p-native.gif" alt=""></p>
<p>(2)ReactNative</p>
<p><img src="ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/p-rn.gif" alt=""></p>
<p>æ€§èƒ½æµ‹è¯•é‡‡ç”¨ RN v0.38.0ï¼Œæµ‹è¯•ç¯å¢ƒï¼šiphone6,iOS9.3.2ï¼Œæµ‹è¯•ç”¨ä¾‹ï¼Œç‚¹å‡»â€˜GOâ€™æŒ‰é’®ï¼Œpush(å¸¦åŠ¨ç”»)ä¸€ä¸ªæ–°é¡µé¢ï¼Œæ–°é¡µé¢åŒ…å«ä¸€ä¸ªåˆ—è¡¨ï¼Œé¦–å±å±•ç¤º6é¡¹ï¼Œå‘ä¸Šæ»‘åŠ¨ï¼Œæ€»å…±å±•ç¤º20é¡¹ï¼Œåˆ—è¡¨ä½¿ç”¨çš„æ•°æ®æ˜¯æœ¬åœ°æ•°æ®ã€‚æµ‹è¯•æ•°æ®å¦‚ä¸‹ï¼Œå…¶ä¸­</p>
<ul>
<li>å“åº”æ—¶é—´ï¼šä»ç‚¹å‡»buttonå¼€å§‹æ„å»ºé¡µé¢ï¼Œåˆ°é¡µé¢å®Œå…¨æ„å»ºå®Œæˆï¼ˆviewDidAppearï¼‰çš„æ—¶é—´</li>
<li>é¡µé¢æ„å»ºå†…å­˜å¼€é”€ï¼šä»ç‚¹å‡»buttonå¼€å§‹æ„å»ºé¡µé¢ï¼Œåˆ°é¡µé¢æ„å»ºå®Œæˆå†…å­˜çš„å¢é‡</li>
<li>é¡µé¢æ»šåŠ¨ä¹‹åå†…å­˜å¼€é”€ï¼šå‘ä¸‹æ»‘åŠ¨ï¼ŒåŠ è½½æ‰€æœ‰çš„cellä¹‹åçš„å†…å­˜å¢é‡</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">æµ‹è¯•æ•°æ®</th>
<th style="text-align:center">å“åº”æ—¶é—´(ms)</th>
<th style="text-align:center">é¡µé¢æ„å»ºå†…å­˜å¼€é”€(MB)</th>
<th style="text-align:center">é¡µé¢æ»šåŠ¨ä¹‹åå†…å­˜å¼€é”€(MB)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">React Native</td>
<td style="text-align:center">831</td>
<td style="text-align:center">2.56</td>
<td style="text-align:center">0.50</td>
</tr>
<tr>
<td style="text-align:center">Native</td>
<td style="text-align:center">555</td>
<td style="text-align:center">1.29</td>
<td style="text-align:center">1.36</td>
</tr>
</tbody>
</table>
<p>ä»ä½“éªŒä¸Šç‚¹å‡»å“åº”çš„é¡ºæ»‘ç¨‹åº¦æ˜æ˜¾nativeè¦é¡ºæ»‘å¾ˆå¤šï¼Œä»ä¸Šé¢çš„gifå›¾ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºã€‚å¦å¤–ï¼Œå†…å­˜å¼€é”€ä¸ŠRNé¦–å±åˆ—è¡¨å¼€é”€æ˜æ˜¾é«˜äºNativeã€‚è¿™é‡Œéœ€è¦è¡¥å……è¯´æ˜ï¼šReact Nativeçš„ListViewå¹¶ä¸æ˜¯ä½¿ç”¨UITableViewå®ç°ï¼Œè€Œæ˜¯è‡ªå·±é‡‡ç”¨UIViewå®ç°çš„ï¼Œè¿™ä¸€ç‚¹å¯ä»¥ä»è§†å›¾å±‚çº§ä¸­çœ‹å‡ºï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/reactnative-scrollview.png" alt=""></p>
<p>ListViewçš„ç¼“å­˜ç­–ç•¥ä¹Ÿæ˜¯è‡ªå·±åšçš„ï¼Œä»<a href="https://github.com/facebook/react-native/issues/499" target="_blank" rel="external">è¿™é‡Œ</a>å¾—çŸ¥ï¼ŒReact Nativeçš„ListViewçš„â€Cellâ€æ¯æ¬¡éƒ½æ˜¯é‡æ–°åˆ›å»ºï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆåšåŸå› æ˜¯RNè®¤ä¸ºUITableView<br>çš„å¤ç”¨å­˜åœ¨â€œè„æ•°æ®â€çš„é—®é¢˜ï¼Œè€Œä¸”ï¼Œåœ¨ç°åœ¨çš„æ‰‹æœºè®¾å¤‡ä¸Šï¼Œåˆ›å»ºæ–°çš„cellå·²ç»è¶³å¤Ÿå¿«ã€‚å½“â€Cellâ€åˆ’å‡ºå±å¹•ï¼Œç›¸åº”çš„â€œCellâ€ä¼šè¢«ä»view treeä¸Šå–ä¸‹æ¥ï¼Œä½†å¹¶ä¸ä¼šé”€æ¯ï¼Œåªæœ‰å½“å†…å­˜è­¦å‘Šæˆ–è€…åˆ—è¡¨é¡¹å¤ªå¤šæ—¶ï¼Œä¼šæœ‰Cellçš„é”€æ¯å·¥ä½œï¼Œä¸‹æ¬¡ä½¿ç”¨ï¼Œå†é‡æ–°æ„å»ºå‡ºæ¥ã€‚</p>
<p>å…¶å®ï¼ŒListViewåœ¨RNä¸­æ— æ³•ç”¨UITableViewå®ç°ï¼ŒåŸå› æ˜¯ï¼Œå¦‚å‰é¢æ‰€ä»‹ç»ï¼ŒJSå¯¹Nativeçš„è°ƒç”¨æ˜¯å¼‚æ­¥æ“ä½œï¼Œè€Œä¸”æ¶ˆæ¯æ´¾å‘çš„é©±åŠ¨æ˜¯Nativeç«¯åšçš„ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœé‡‡ç”¨UITableViewæ¥åšï¼Œåœ¨åˆ—è¡¨é¡µå¿«é€Ÿæ»šåŠ¨çš„æ—¶å€™ï¼ŒJSç«¯æ˜¯ä¸èƒ½ç«‹åˆ»åŒæ­¥è·å–ä¸‹ä¸€ä¸ªCellæ¥å±•ç¤ºçš„ã€‚RNç°åœ¨çš„å®ç°æ–¹å¼æ˜¯ç”¨ScrollViewæ¥å®ç°ï¼Œå¹¶ä¸”ä¼šé¢„å…ˆåˆ›å»ºè‹¥å¹²ä¸ªCellæ¥ç”¨æˆ·å¿«é€Ÿæ»‘åŠ¨æ—¶ï¼Œä¸‹ä¸€ä¸ªCellçš„å±•ç¤ºã€‚æµ‹è¯•å‘ç°ï¼Œå¯¹äºDataSourceæœ‰20ä¸ªæ•°æ®ï¼Œé¦–å±åªèƒ½æ˜¾ç¤º6ä¸ªcellçš„æƒ…å†µä¸‹ï¼ŒNativeç«¯é¦–å±ä¼šåˆ›å»º6ä¸ªcellï¼Œæ€»å…±ä¼šåˆ›å»º7ä¸ªï¼ˆç¼“é€Ÿçš„æ»‘åŠ¨ï¼‰ï¼›React Nativeé¦–å±ä¼šåˆ›å»º17ä¸ªcellï¼ˆç”¨äºå¿«é€Ÿæ»‘åŠ¨å±•ç¤ºè€Œé¢„åˆ›å»ºï¼‰ï¼Œæ€»å…±ä¼šåˆ›å»º20ä¸ªã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>JSä¸nativeçš„å¼‚æ­¥é€šä¿¡ï¼Œè„šæœ¬ä¸ä¼šå¡ä½ä¸»çº¿ç¨‹</li>
<li>åŸç”Ÿçš„æ§ä»¶+åŸç”Ÿçš„ä½“éªŒ</li>
<li>çƒ­è°ƒè¯•èƒ½åŠ›</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>JSä¸nativeçš„å¼‚æ­¥é€šä¿¡</li>
<li>é—¨æ§›è¾ƒé«˜</li>
<li>ä»…é¢å‘Reactå‰ç«¯å¼€å‘</li>
</ul>
<h2 id="samurai-native"><a href="#samurai-native" class="headerlink" title="samurai-native"></a>samurai-native</h2><p>samurai-nativeçš„æ€è·¯è·ŸReactNatvieçš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæ˜¯å°†nativeçš„æ¥å£å¯¼ç»™webç«¯ä½¿ç”¨ï¼Œè€Œç•Œé¢çš„æ¸²æŸ“é‡‡ç”¨natvieæ§ä»¶ï¼Œå®ƒä¸RNåŒºåˆ«ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š</p>
<p>(1)è¡¨è¾¾è¯­æ³•æ˜¯HTML+CSS;</p>
<p>(2)æ ‡ç­¾åç§°ä¸Nativeçš„Viewçš„åç§°å¯¹åº”ï¼ŒRNä¸­ç”±äºå¯¹æ ‡ç­¾è¿›è¡Œäº†æŠ½è±¡ï¼Œæœ‰äº›æ ‡ç­¾ä¸Nativeç±»åç§°ä¸Šå¹¶ä¸èƒ½å¯¹åº”ï¼ŒReact Nativeä¹¦å†™ä¸€ä¸ªtableview cellå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹å‡ºï¼Œå’ŒåŸç”Ÿçš„å†™æ³•çš„å‘½åæœ‰å·®å¼‚ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;TouchableHighlight onPress=&#123;() =&gt; this.rowPressed(rowData.guid)&#125;</div><div class="line">                underlayColor=&apos;#dddddd&apos;&gt;</div><div class="line">              &lt;View&gt;</div><div class="line">                &lt;View style=&#123;styles.rowContainer&#125;&gt;</div><div class="line">                  &lt;Image style=&#123;styles.thumb&#125; source=&#123;&#123; uri: rowData.img_url &#125;&#125; /&gt;</div><div class="line">                  &lt;View  style=&#123;styles.textContainer&#125;&gt;</div><div class="line">                    &lt;Text style=&#123;styles.price&#125;&gt;Â£&#123;price&#125;&lt;/Text&gt;</div><div class="line">                    &lt;Text style=&#123;styles.title&#125;</div><div class="line">                          numberOfLines=&#123;1&#125;&gt;&#123;rowData.title&#125;&lt;/Text&gt;</div><div class="line">                  &lt;/View&gt;</div><div class="line">                &lt;/View&gt;</div><div class="line">                &lt;View style=&#123;styles.separator&#125;/&gt;</div><div class="line">              &lt;/View&gt;</div><div class="line">            &lt;/TouchableHighlight&gt;</div></pre></td></tr></table></figure>
<p>å…³äºsamurai-nativeçš„ä»‹ç»å¯ä»¥å‚è€ƒä»–åœ¨infoqä¸Šçš„<a href="http://www.infoq.com/cn/presentations/semi-hybrid-app-framework" target="_blank" rel="external">æ¼”è®²</a>ã€‚</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ios/">ios</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/æ··åˆå¼€å‘æ¡†æ¶/">æ··åˆå¼€å‘æ¡†æ¶</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://NEYouFan.github.io/2016/12/02/ios/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/" data-title="èŠèŠç§»åŠ¨ç«¯é‚£äº›æ··åˆå¼€å‘æ¡†æ¶ä»¬ | ç½‘æ˜“æ­å·å‰ç«¯æŠ€æœ¯éƒ¨" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/12/09/android/Jenkins-ciå®¹å™¨åŒ–åœ¨Androidé¡¹ç›®æ„å»ºä¸­çš„åº”ç”¨ï¼ˆå…¬ä¼—å·ç‰ˆï¼‰/" title="Jenkins-ciå®¹å™¨åŒ–åœ¨Androidé¡¹ç›®æ„å»ºä¸­çš„åº”ç”¨">
  <strong>ä¸Šä¸€ç¯‡ï¼š</strong><br/>
  <span>
  Jenkins-ciå®¹å™¨åŒ–åœ¨Androidé¡¹ç›®æ„å»ºä¸­çš„åº”ç”¨</span>
</a>
</div>


<div class="next">
<a href="/2016/11/25/android/ç½‘æ˜“ Android å·¥ç¨‹æ¨¡æ¿åŒ–å®è·µ/"  title="ç½‘æ˜“Androidå·¥ç¨‹æ¨¡æ¿åŒ–å®è·µ">
 <strong>ä¸‹ä¸€ç¯‡ï¼š</strong><br/> 
 <span>ç½‘æ˜“Androidå·¥ç¨‹æ¨¡æ¿åŒ–å®è·µ
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/12/02/ios/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/" data-title="èŠèŠç§»åŠ¨ç«¯é‚£äº›æ··åˆå¼€å‘æ¡†æ¶ä»¬" data-url="http://NEYouFan.github.io/2016/12/02/ios/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/ç§»åŠ¨ç«¯æ··åˆç¼–ç¨‹/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="æ˜¾ç¤ºä¾§è¾¹æ "></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web-amp-Native"><span class="toc-number">2.</span> <span class="toc-text">Web & Native</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#é‚£äº›æ··åˆç¼–ç¨‹ä»¬"><span class="toc-number">3.</span> <span class="toc-text">é‚£äº›æ··åˆç¼–ç¨‹ä»¬</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PhoneGap-Cordova"><span class="toc-number">3.1.</span> <span class="toc-text">PhoneGap/Cordova</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SuperWebView"><span class="toc-number">3.2.</span> <span class="toc-text">SuperWebView</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SuperWebViewä¸­JSä¸Nativeé€šä¿¡çš„å®ç°åŸç†"><span class="toc-number">3.2.1.</span> <span class="toc-text">SuperWebViewä¸­JSä¸Nativeé€šä¿¡çš„å®ç°åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å…³äºSuperWebViewæ‰€æŒ‡çš„æ··åˆæ¸²æŸ“çš„è¯´æ˜"><span class="toc-number">3.2.2.</span> <span class="toc-text">å…³äºSuperWebViewæ‰€æŒ‡çš„æ··åˆæ¸²æŸ“çš„è¯´æ˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Runtime-amp-Native-js"><span class="toc-number">3.3.</span> <span class="toc-text">5+Runtime & Native.js</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Native-jsé€šä¿¡æ–¹å¼å®ç°åˆ†æ"><span class="toc-number">3.3.1.</span> <span class="toc-text">Native.jsé€šä¿¡æ–¹å¼å®ç°åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Titanium"><span class="toc-number">3.4.</span> <span class="toc-text">Titanium</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-Native"><span class="toc-number">3.5.</span> <span class="toc-text">React Native</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#React-Nativeé€šä¿¡æœºåˆ¶æºç åˆ†æ"><span class="toc-number">3.5.1.</span> <span class="toc-text">React Nativeé€šä¿¡æœºåˆ¶æºç åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ€§èƒ½æµ‹è¯•"><span class="toc-number">3.5.2.</span> <span class="toc-text">æ€§èƒ½æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#samurai-native"><span class="toc-number">3.6.</span> <span class="toc-text">samurai-native</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="éšè—ä¾§è¾¹æ "></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">åˆ†ç±»</p>
		<ul>
		
		  
			<li><a href="/categories/android/" title="android">android<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/ios/" title="ios">ios<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">æ ‡ç­¾</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Jenkins/" title="Jenkins">Jenkins<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ciå®¹å™¨/" title="ciå®¹å™¨">ciå®¹å™¨<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/androidå·¥ç¨‹æ¨¡æ¿/" title="androidå·¥ç¨‹æ¨¡æ¿">androidå·¥ç¨‹æ¨¡æ¿<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/LLVM/" title="LLVM">LLVM<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Jså¼•æ“/" title="Jså¼•æ“">Jså¼•æ“<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/NeteaseAPM/" title="NeteaseAPM">NeteaseAPM<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/æ··åˆå¼€å‘æ¡†æ¶/" title="æ··åˆå¼€å‘æ¡†æ¶">æ··åˆå¼€å‘æ¡†æ¶<sup>1</sup></a></li>
			
		
		</ul>
</div>


  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS è®¢é˜…</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">å¾®ä¿¡å…±ä¼—å·</p>
  <div class="barcode">
    <img src="/img/barcode.jpg" alt="">
  </div>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
		<p class="copyright">
		cpryright Â© 2017
		
		<a href="/about" target="_blank" title="ç½‘æ˜“å‰ç«¯æŠ€æœ¯éƒ¨">ç½‘æ˜“å‰ç«¯æŠ€æœ¯éƒ¨</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="å¾®ä¿¡"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="äººäºº"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="å¾®åš"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"neyoufan"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="è¿”å›é¡¶éƒ¨"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
